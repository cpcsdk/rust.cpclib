<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/basic.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/booster.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/chars_control.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/chars_name.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/common.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/demosystem_config.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/linker_common.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/private.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/public.asm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar (Table of Contents) */
        .sidebar {
            width: 300px;
            background-color: #fff;
            border-right: 1px solid #e0e0e0;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .sidebar h1 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .sidebar h2 {
            font-size: 0.95em;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar ul {
            list-style: none;
            margin-left: 0;
        }

        .sidebar li {
            margin: 4px 0;
        }

        .sidebar a {
            color: #3498db;
            text-decoration: none;
            display: block;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s, color 0.2s;
            font-size: 0.9em;
        }

        .sidebar a:hover {
            background-color: #e8f4f8;
            color: #2980b9;
        }

        .sidebar a code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
        }

        /* Main content */
        .main-content {
            margin-left: 300px;
            flex: 1;
            padding: 40px 60px;
            background-color: #fff;
            max-width: calc(100% - 300px);
        }

        .main-content h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .main-content h2 {
            font-size: 2em;
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .main-content h3 {
            font-size: 1.5em;
            color: #555;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .main-content h4 {
            font-size: 1.2em;
            color: #666;
            margin-top: 25px;
            margin-bottom: 12px;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 3px;
        }

        .main-content code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
            color: #e74c3c;
        }

        .main-content pre {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .main-content pre code {
            background-color: transparent;
            padding: 0;
            color: #333;
        }

        .main-content p {
            margin-bottom: 15px;
        }

        .main-content ul, .main-content ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .main-content li {
            margin-bottom: 8px;
        }

        /* Tables from markdown */
        .main-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .main-content table th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
            padding: 12px;
            text-align: left;
            border: 1px solid #2980b9;
        }

        .main-content table td {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
        }

        .main-content table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .main-content table tr:hover {
            background-color: #e8f4f8;
        }

        /* Markdown content inside items */
        .item > div h1,
        .item > div h2,
        .item > div h3 {
            font-size: 1.1em;
            margin-top: 15px;
            margin-bottom: 10px;
            color: #555;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 5px;
        }

        .item > div h1:first-child,
        .item > div h2:first-child,
        .item > div h3:first-child {
            margin-top: 0;
        }

        .item > div ul,
        .item > div ol {
            margin-left: 20px;
        }

        .item > div blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
            font-style: italic;
        }

        .file-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .file-header h1 {
            border: none;
            color: white;
            margin: 0;
        }

        .file-name {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 10px;
        }

        .section {
            margin-top: 40px;
        }

        .item {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #fafafa;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .item h4 {
            margin-top: 0;
        }

        /* Collapsible source code */
        .macro-source {
            margin-top: 15px;
        }

        .macro-source-toggle {
            background-color: #3498db;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .macro-source-toggle:hover {
            background-color: #2980b9;
        }

        .macro-source-toggle::before {
            content: "â–¶";
            display: inline-block;
            transition: transform 0.2s;
        }

        .macro-source-toggle.active::before {
            transform: rotate(90deg);
        }

        .macro-source-content {
            display: none;
            margin-top: 10px;
            background-color: #282c34;
            border-radius: 4px;
            overflow: hidden;
        }

        .macro-source-content.show {
            display: block;
        }

        .macro-source-content pre {
            margin: 0;
            padding: 15px;
            background-color: transparent;
            border: none;
            color: #abb2bf;
            font-size: 0.85em;
            line-height: 1.5;
        }

        .macro-source-content code {
            color: #abb2bf;
            background-color: transparent;
        }

        /* Override main-content code styling for macro source */
        .macro-source-content pre code {
            color: #abb2bf !important;
            background-color: transparent !important;
            padding: 0;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }

            .main-content {
                margin-left: 250px;
                padding: 20px 30px;
                max-width: calc(100% - 250px);
            }
        }

        @media (max-width: 600px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
                padding: 20px;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Anchor offset for fixed sidebar */
        .anchor-offset {
            padding-top: 20px;
            margin-top: -20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar with Table of Contents -->
        <aside class="sidebar">
            <h1>ðŸ“š Documentation</h1>
            <div class="file-name">/home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/basic.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/booster.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/chars_control.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/chars_name.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/common.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/demosystem_config.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/linker_common.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/private.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/public.asm</div>

            
            <h2>Labels</h2>
            <ul>
                
                <li><a href="#label_ds_basic_first_comment_char_address"><code>ds_basic_first_comment_char_address</code></a></li>
                
                <li><a href="#label_ds_basic_get_crtc_selection"><code>ds_basic_get_crtc_selection</code></a></li>
                
                <li><a href="#label_ds_basic_get_integer_param"><code>ds_basic_get_integer_param</code></a></li>
                
                <li><a href="#label_ds_search_end_of_substring"><code>ds_search_end_of_substring</code></a></li>
                
            </ul>
            

            
            <h2>Macros</h2>
            <ul>
                
                <li><a href="#macro_DS_PRODUCE_KEYSPACE_ROUTINE"><code>DS_PRODUCE_KEYSPACE_ROUTINE</code></a></li>
                
                <li><a href="#macro_DS_KEYSPACE"><code>DS_KEYSPACE</code></a></li>
                
                <li><a href="#macro_DS_PRODUCE_STOP_SOUND_ROUTINE"><code>DS_PRODUCE_STOP_SOUND_ROUTINE</code></a></li>
                
                <li><a href="#macro_DS_PRODUCE_SECURE_WAIT_VSYNC_ROUTINE"><code>DS_PRODUCE_SECURE_WAIT_VSYNC_ROUTINE</code></a></li>
                
                <li><a href="#macro_DS_SECURE_WAIT_VSYNC"><code>DS_SECURE_WAIT_VSYNC</code></a></li>
                
                <li><a href="#macro_DS_PRODUCE_WAIT_VSYNC_ROUTINE"><code>DS_PRODUCE_WAIT_VSYNC_ROUTINE</code></a></li>
                
                <li><a href="#macro_DS_WAIT_VSYNC"><code>DS_WAIT_VSYNC</code></a></li>
                
                <li><a href="#macro_DS_WAIT_MICROSEG"><code>DS_WAIT_MICROSEG</code></a></li>
                
                <li><a href="#macro_WAIT_CYCLES"><code>WAIT_CYCLES</code></a></li>
                
                <li><a href="#macro_LONG_WAIT_CYCLES"><code>LONG_WAIT_CYCLES</code></a></li>
                
                <li><a href="#macro_DS_WRITE_CRTC"><code>DS_WRITE_CRTC</code></a></li>
                
                <li><a href="#macro_DS_CRTC_HORIZONTAL_TRANSITION_ONLY"><code>DS_CRTC_HORIZONTAL_TRANSITION_ONLY</code></a></li>
                
                <li><a href="#macro_DS_CRTC_VERTICAL_TRANSITION_ONLY"><code>DS_CRTC_VERTICAL_TRANSITION_ONLY</code></a></li>
                
                <li><a href="#macro_MOVE_CRUNCHED_DATA"><code>MOVE_CRUNCHED_DATA</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_PRELUDE_NOT_BACKWARD"><code>UNCRUNCH_PRELUDE_NOT_BACKWARD</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_PRELUDE_BACKWARD"><code>UNCRUNCH_PRELUDE_BACKWARD</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_STANDARD_BACKWARD"><code>UNCRUNCH_STANDARD_BACKWARD</code></a></li>
                
                <li><a href="#macro_INDIRECT_UNCRUNCH_STANDARD_BACKWARD"><code>INDIRECT_UNCRUNCH_STANDARD_BACKWARD</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_STANDARD_NOT_BACKWARD"><code>UNCRUNCH_STANDARD_NOT_BACKWARD</code></a></li>
                
                <li><a href="#macro_INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD"><code>INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_LZ4"><code>UNCRUNCH_LZ4</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_UPKR"><code>UNCRUNCH_UPKR</code></a></li>
                
                <li><a href="#macro_UNCRUNCH_SHRINKLER"><code>UNCRUNCH_SHRINKLER</code></a></li>
                
                <li><a href="#macro_INSTALL_EXOMIZER"><code>INSTALL_EXOMIZER</code></a></li>
                
                <li><a href="#macro_INSTALL_APLIB"><code>INSTALL_APLIB</code></a></li>
                
                <li><a href="#macro_INSTALL_UPKR"><code>INSTALL_UPKR</code></a></li>
                
                <li><a href="#macro_INSTALL_LZ4"><code>INSTALL_LZ4</code></a></li>
                
                <li><a href="#macro_INSTALL_LZ48"><code>INSTALL_LZ48</code></a></li>
                
                <li><a href="#macro_INSTALL_LZ49"><code>INSTALL_LZ49</code></a></li>
                
                <li><a href="#macro_INSTALL_LZSA1"><code>INSTALL_LZSA1</code></a></li>
                
                <li><a href="#macro_INSTALL_LZSA2"><code>INSTALL_LZSA2</code></a></li>
                
                <li><a href="#macro_INSTALL_SHRINKLER"><code>INSTALL_SHRINKLER</code></a></li>
                
                <li><a href="#macro_INSTALL_ZX0"><code>INSTALL_ZX0</code></a></li>
                
                <li><a href="#macro_INSTALL_ZX0_BACKWARD"><code>INSTALL_ZX0_BACKWARD</code></a></li>
                
                <li><a href="#macro_INSTALL_ZX7"><code>INSTALL_ZX7</code></a></li>
                
                <li><a href="#macro_LOAD_N_CRUNCH"><code>LOAD_N_CRUNCH</code></a></li>
                
                <li><a href="#macro_UNCRUNCH"><code>UNCRUNCH</code></a></li>
                
                <li><a href="#macro_INDIRECT_UNCRUNCH"><code>INDIRECT_UNCRUNCH</code></a></li>
                
                <li><a href="#macro_INSTALL_UNCRUNCHER"><code>INSTALL_UNCRUNCHER</code></a></li>
                
                <li><a href="#macro_DS_INITIALIZATION"><code>DS_INITIALIZATION</code></a></li>
                
                <li><a href="#macro_DS_SELECT_A_MEMORY_SPACE"><code>DS_SELECT_A_MEMORY_SPACE</code></a></li>
                
                <li><a href="#macro_DS_LOAD_FILE_IN_EXTRA_PAGE"><code>DS_LOAD_FILE_IN_EXTRA_PAGE</code></a></li>
                
                <li><a href="#macro___DS_LOAD_FILE_IN_EXTRA_PAGE_INNER__"><code>__DS_LOAD_FILE_IN_EXTRA_PAGE_INNER__</code></a></li>
                
                <li><a href="#macro_DS_LOAD_FILE_IN_MAIN_PAGE"><code>DS_LOAD_FILE_IN_MAIN_PAGE</code></a></li>
                
                <li><a href="#macro_DS_LOAD_AND_RUN_FILE_IN_MAIN_PAGE"><code>DS_LOAD_AND_RUN_FILE_IN_MAIN_PAGE</code></a></li>
                
                <li><a href="#macro_DS_MAKE_FIRMWARE_QUIET"><code>DS_MAKE_FIRMWARE_QUIET</code></a></li>
                
                <li><a href="#macro_DS_COPY_MEMORY_FROM_EXTRA_PAGE_TO_MAIN_PAGE"><code>DS_COPY_MEMORY_FROM_EXTRA_PAGE_TO_MAIN_PAGE</code></a></li>
                
                <li><a href="#macro_DS_BACKUP_FIRMWARE"><code>DS_BACKUP_FIRMWARE</code></a></li>
                
            </ul>
            

            
            <h2>Equs</h2>
            <ul>
                
                <li><a href="#equ_CHAR_CTRL_NUL"><code>CHAR_CTRL_NUL</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_SOH"><code>CHAR_CTRL_SOH</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_STX"><code>CHAR_CTRL_STX</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_ETX"><code>CHAR_CTRL_ETX</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_EOT"><code>CHAR_CTRL_EOT</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_ENQ"><code>CHAR_CTRL_ENQ</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_ACK"><code>CHAR_CTRL_ACK</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_BEL"><code>CHAR_CTRL_BEL</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_BS"><code>CHAR_CTRL_BS</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_TAB"><code>CHAR_CTRL_TAB</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_LF"><code>CHAR_CTRL_LF</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_VT"><code>CHAR_CTRL_VT</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_FF"><code>CHAR_CTRL_FF</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_CR"><code>CHAR_CTRL_CR</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_SO"><code>CHAR_CTRL_SO</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_SI"><code>CHAR_CTRL_SI</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_DLE"><code>CHAR_CTRL_DLE</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_DC1"><code>CHAR_CTRL_DC1</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_DC2"><code>CHAR_CTRL_DC2</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_DC3"><code>CHAR_CTRL_DC3</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_DC4"><code>CHAR_CTRL_DC4</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_NAK"><code>CHAR_CTRL_NAK</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_SYN"><code>CHAR_CTRL_SYN</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_ETB"><code>CHAR_CTRL_ETB</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_CAN"><code>CHAR_CTRL_CAN</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_EM"><code>CHAR_CTRL_EM</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_SUB"><code>CHAR_CTRL_SUB</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_ESC"><code>CHAR_CTRL_ESC</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_FS"><code>CHAR_CTRL_FS</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_GS"><code>CHAR_CTRL_GS</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_RS"><code>CHAR_CTRL_RS</code></a></li>
                
                <li><a href="#equ_CHAR_CTRL_US"><code>CHAR_CTRL_US</code></a></li>
                
                <li><a href="#equ_DS_FIRST_AVAILABLE_ADDRESS"><code>DS_FIRST_AVAILABLE_ADDRESS</code></a></li>
                
            </ul>
            
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <div class="file-header">
                <h1>Assembly Documentation</h1>
                <div class="file-name">File: /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/basic.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/booster.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/chars_control.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/chars_name.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/common.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/demosystem_config.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/linker_common.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/private.asm, /home/romain/Perso/CPC/current_projects/demo.bnd5/linking/src/demosystem/public.asm</div>
            </div>

            <!-- Labels section -->
            
            <section class="section">
                <h2 id="labels-section" class="anchor-offset">Labels</h2>
                
                <div class="item">
                    <h4 id="label_ds_basic_first_comment_char_address" class="anchor-offset">ds_basic_first_comment_char_address</h4>
                    <div><p>look for the first character of the first comment in the basic program line
MODIFIED:
RETURNS:</p>
<ul>
<li>HL: address of the first character of the first comment in the basic program line</li>
<li>Z is set if comment found</li>
</ul>
</div>
                </div>
                
                <div class="item">
                    <h4 id="label_ds_basic_get_crtc_selection" class="anchor-offset">ds_basic_get_crtc_selection</h4>
                    <div><p>Look for the crtc version requested by the user in the basic program line
post condition:
Z flag set if found</p>
<ul>
<li>A: crtc version (0-4)</li>
</ul>
</div>
                </div>
                
                <div class="item">
                    <h4 id="label_ds_basic_get_integer_param" class="anchor-offset">ds_basic_get_integer_param</h4>
                    <div><p>Search the named parameter in the basic program line and retrieve its integer value
pre condition</p>
<ul>
<li>HL: address of the first character to search from</li>
<li>A: length of the screen
post condition
Z flag set if an integer parameter is found
A: integer parameter value if any</li>
</ul>
</div>
                </div>
                
                <div class="item">
                    <h4 id="label_ds_search_end_of_substring" class="anchor-offset">ds_search_end_of_substring</h4>
                    <div><p>Prerequisites:</p>
<ul>
<li>HL: address of the first character to search from
.searched_string_length: length of the string to search
.searched_string: the string to search</li>
<li>BC number of bytes to search in (&lt;256)
Postcondition:</li>
<li>HL address of the first character after the searched string if found</li>
<li>Z is set if found</li>
</ul>
</div>
                </div>
                
            </section>
            

            <!-- Macros section -->
            
            <section class="section">
                <h2 id="macros-section" class="anchor-offset">Macros</h2>
                
                <div class="item">
                    <h4 id="macro_DS_PRODUCE_KEYSPACE_ROUTINE" class="anchor-offset">MACRO DS_PRODUCE_KEYSPACE_ROUTINE()</h4>
                    <div><p>Generate the routine to check if the user pressed space</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_PRODUCE_KEYSPACE_ROUTINE_source')">View Source</button>
                        <div id="macro_DS_PRODUCE_KEYSPACE_ROUTINE_source" class="macro-source-content">
                            <pre><code>
    ;;
    ; Check if user pressed space
    ds_keyspace
		DS_KEYSPACE()
		ret

</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_KEYSPACE" class="anchor-offset">MACRO DS_KEYSPACE()</h4>
                    <div><p>Generate the code to check if the user pressed space</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_KEYSPACE_source')">View Source</button>
                        <div id="macro_DS_KEYSPACE_source" class="macro-source-content">
                            <pre><code>
        LD	BC,#F40E
        OUT	(C),C
        LD	BC,#F6C0
        OUT	(C),C
;  XOR	A
;  OUT	(C),A
  		defb &ed,&71
        LD	BC,#F792
        OUT	(C),C
        LD	BC,#F645
        OUT	(C),C
        LD	B,#F4
        IN	A,(C)
        LD	BC,#F782
        OUT	(C),C
;  LD	BC,#F600
;  OUT	(C),C
		dec b
		defb &ed,&71
;		
        RLA	
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_PRODUCE_STOP_SOUND_ROUTINE" class="anchor-offset">MACRO DS_PRODUCE_STOP_SOUND_ROUTINE()</h4>
                    <div><p>Generate the routine to stop any sound.
Direct access to AY is done, not to firmware</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_PRODUCE_STOP_SOUND_ROUTINE_source')">View Source</button>
                        <div id="macro_DS_PRODUCE_STOP_SOUND_ROUTINE_source" class="macro-source-content">
                            <pre><code>
; Stop any sound
; based on the AKM player
; only 4 Registers need to be used
	ds_stop_sound
STOP_SOUND
;
 	ld bc,#f680 
        ld a,&c0
	ld de,#f4f6
        out (c),a
; H= PSG register L=value	
	ld hl,&0700+%00111111                ; &07 = Mixer 
	call SendPsgRegister
	ld hl,&0800			    ; &08 = Volume Voice 1
	call SendPsgRegister
	inc h				    ; &09 = Volume Voice 2
	call SendPsgRegister
	inc h			            ; &10 = Volume Voice 3
;	call SendPsgRegister
        

            ;    ld l,%00111111          ;On CPC, bit 6 must be 0. Other platforms don't care.
SendPsgRegister:
    
        ld b,d
        out (c),h       ;#f400 + register.
        ld b,e
        out (c),0       ;#f600
        ld b,d
        out (c),l       ;#f400 + value.
        ld b,e
        out (c),c       ;#f680
        out (c),a       ;#f6c0
;
	ret	

</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_PRODUCE_SECURE_WAIT_VSYNC_ROUTINE" class="anchor-offset">MACRO DS_PRODUCE_SECURE_WAIT_VSYNC_ROUTINE()</h4>
                    <div><p>Generate the routine to wait the beginning of the next VSYNC,
ensuring we are not already in VSYNC</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_PRODUCE_SECURE_WAIT_VSYNC_ROUTINE_source')">View Source</button>
                        <div id="macro_DS_PRODUCE_SECURE_WAIT_VSYNC_ROUTINE_source" class="macro-source-content">
                            <pre><code>
ds_secure_wait_vsync
	DS_SECURE_WAIT_VSYNC()
	ret
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_SECURE_WAIT_VSYNC" class="anchor-offset">MACRO DS_SECURE_WAIT_VSYNC()</h4>
                    <div><p>Wait the beginning of the next VSYNC, ensuring we are not already in VSYNC</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_SECURE_WAIT_VSYNC_source')">View Source</button>
                        <div id="macro_DS_SECURE_WAIT_VSYNC_source" class="macro-source-content">
                            <pre><code>
	ld b, 0xf5
@wait_novsync
	in a, (c)
	rra
	jr c, @wait_novsync

@wait_vsync
	in a, (c)
	rra
	jr nc, @wait_vsync
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_PRODUCE_WAIT_VSYNC_ROUTINE" class="anchor-offset">MACRO DS_PRODUCE_WAIT_VSYNC_ROUTINE()</h4>
                    <div><p>Generate the routine to wait the beginning of the next VSYNC</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_PRODUCE_WAIT_VSYNC_ROUTINE_source')">View Source</button>
                        <div id="macro_DS_PRODUCE_WAIT_VSYNC_ROUTINE_source" class="macro-source-content">
                            <pre><code>
ds_wait_vsync
	DS_WAIT_VSYNC()
	ret
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_WAIT_VSYNC" class="anchor-offset">MACRO DS_WAIT_VSYNC()</h4>
                    <div><p>Wait VSYNC, even if it is already started</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_WAIT_VSYNC_source')">View Source</button>
                        <div id="macro_DS_WAIT_VSYNC_source" class="macro-source-content">
                            <pre><code>
	ld b, 0xf5
@wait_vsync
	in a, (c)
	rra
	jr nc, @wait_vsync
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_WAIT_MICROSEG" class="anchor-offset">MACRO DS_WAIT_MICROSEG(duration)</h4>
                    <div><p>Wait N microseconds (max wait 1021 ms / length 4 - 7 bytes)
Initial code from @Syx</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_WAIT_MICROSEG_source')">View Source</button>
                        <div id="macro_DS_WAIT_MICROSEG_source" class="macro-source-content">
                            <pre><code>
@k EQU {duration} - 1
		LD   B,@k / 4                      ; (2 = 1 that we subtracted and 1 that is missing from the DJNZ)
		DJNZ $                              ; (4 * [N - 1] + 3 = 4 * N - 1)
		DEFS @k % 4                        ; (1 * [4 * N - 1] % 4)
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_WAIT_CYCLES" class="anchor-offset">MACRO WAIT_CYCLES(cycles)</h4>
                    <div><p>Wait a number of CPU cycles (max wait 1024 cycles)</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_WAIT_CYCLES_source')">View Source</button>
                        <div id="macro_WAIT_CYCLES_source" class="macro-source-content">
                            <pre><code>
		assert {cycles} <= 1024, 'Too many nops'
		assert {cycles} > 0, 'Wait time must be positive'

		; Compute the number of loops and extra nop
	@loops     equ ({cycles}-1)/4 
	@loopsx4   equ @loops*4
	@nops      equ {cycles}-@loopsx4-1

		; Produce a loop only if required
		if @loops != 0
			ld  b, @loops
	@change_waitLoop
			djnz    @change_waitLoop
		endif

		; Produce extra nops
		defs    @nops, 0

    </code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_LONG_WAIT_CYCLES" class="anchor-offset">MACRO LONG_WAIT_CYCLES(cycles)</h4>
                    <div><p>Macro able to wait more than 1024 nops. Relay on WAIT_CYCLES</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_LONG_WAIT_CYCLES_source')">View Source</button>
                        <div id="macro_LONG_WAIT_CYCLES_source" class="macro-source-content">
                            <pre><code>

        if {cycles} <= 1024
            WAIT_CYCLES {cycles}
        else
            WAIT_CYCLES 1024
            LONG_WAIT_CYCLES {eval}({cycles} - 1024)
        endif
    </code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_WRITE_CRTC" class="anchor-offset">MACRO DS_WRITE_CRTC(register,value)</h4>
                    <div><p>WRITE_CRTC: Writes a value to a CRTC register
Corrupts: BC
XXX we need to keep this slow and long code for crunch and duration purpose</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_WRITE_CRTC_source')">View Source</button>
                        <div id="macro_DS_WRITE_CRTC_source" class="macro-source-content">
                            <pre><code>
        LD   BC, &bc00 + {register}
        OUT  (C),C
        LD   BC, &bd00 + {value}
        OUT  (C),C
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_CRTC_HORIZONTAL_TRANSITION_ONLY" class="anchor-offset">MACRO DS_CRTC_HORIZONTAL_TRANSITION_ONLY(from,to)</h4>
                    <div><p>Il doit Ãªtre possible de dÃ©terminer ce qu'il se passe exactement et d'Ã©crire un cas particulier
de la macro si on veut.</p>
<p>Music MUST not play under interruption for timing reasons
XXX no deeply tested yet</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_CRTC_HORIZONTAL_TRANSITION_ONLY_source')">View Source</button>
                        <div id="macro_DS_CRTC_HORIZONTAL_TRANSITION_ONLY_source" class="macro-source-content">
                            <pre><code>
@delta EQU ({to}) - ({from})
		DS_WAIT_MICROSEG(__DS_HT_delay1)

		; START OF CRTC TRANSITION, WRITE TEMP R0 ---------------------------------+
		DS_WRITE_CRTC(0, {eval}63 - @delta)  	; 14 NOPs
		DS_WAIT_MICROSEG(64 - 14 - 14)
		xor a                    		; 1 NOP  XXX initial code of Pulko was tagged 1 NOP but using ld a, 0
		DS_WRITE_CRTC(2, {to})         	; 14 NOPs
		DEC B                    		; 13 remaining NOPs of CRTC write
		OUT (C),A
		LD BC, &bd00+63
		; END OF CRTC TRANSITION, RESTORE R0 exactly 64us later -------------------+
		OUT (C), C
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_CRTC_VERTICAL_TRANSITION_ONLY" class="anchor-offset">MACRO DS_CRTC_VERTICAL_TRANSITION_ONLY(from,to)</h4>
                    <div><p>Vertical CRTC transition from R7=from to R7=to
Music MUST not play under interruption for timing reasons
XXX no deeply tested yet</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_CRTC_VERTICAL_TRANSITION_ONLY_source')">View Source</button>
                        <div id="macro_DS_CRTC_VERTICAL_TRANSITION_ONLY_source" class="macro-source-content">
                            <pre><code>
		DS_WAIT_VSYNC()
		DS_WRITE_CRTC(4, 38 + {from} - {to})
		DS_WRITE_CRTC(7, {to})
		DS_PLAY_MUSIC()

		HALT
		HALT

		DS_WAIT_VSYNC()
		DS_WRITE_CRTC(4, 38)
		DS_PLAY_MUSIC()
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_MOVE_CRUNCHED_DATA" class="anchor-offset">MACRO MOVE_CRUNCHED_DATA(from,to)</h4>
                    <div><p>Sometimes there are conflicts between the crunched data areas and the uncrunched data areas. Mainly because of banks overlap or lack of free memory.
To avoid this, we first move the crunched data to a safe area, then uncrunch from there.</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_MOVE_CRUNCHED_DATA_source')">View Source</button>
                        <div id="macro_MOVE_CRUNCHED_DATA_source" class="macro-source-content">
                            <pre><code>
		ld hl, {from}.start
		ld de, {to}
		ld bc, {from}.length
		ldir
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_PRELUDE_NOT_BACKWARD" class="anchor-offset">MACRO UNCRUNCH_PRELUDE_NOT_BACKWARD(from,to)</h4>
                    <div><p>Add some tests to check that the selected data is valid for non backward crunchers</p>
<p>Parameters:</p>
<p>from: start address of the crunched data (the very first byte)
to:   address where the uncrunched data will be stored (the very first byte)</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_PRELUDE_NOT_BACKWARD_source')">View Source</button>
                        <div id="macro_UNCRUNCH_PRELUDE_NOT_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		ifdef {from}.start
			assert {from} == {from}.start
			assert {to} >= {from}.next | {to} < {from}.start ; BUG does not take into account overlapping areas; use delta for that
		endif
		print "Uncrunch from ", {hex}{from}, " to ", {hex}{to}
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_PRELUDE_BACKWARD" class="anchor-offset">MACRO UNCRUNCH_PRELUDE_BACKWARD(from,to)</h4>
                    <div><p>Add some tests to check that the selected data is valid for backward crunchers</p>
<p>Parameters:</p>
<p>from: start address of the crunched data (the very first byte AND NOT the very last byte)
to:   address where the uncrunched data will be stored (the very first byte AND NOT the very last byte)</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_PRELUDE_BACKWARD_source')">View Source</button>
                        <div id="macro_UNCRUNCH_PRELUDE_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		ifdef {from}.start
			assert {from} == {from}.start
			if {from}.start >= {to}
				assert {to} + {from}.length < {from}.start
			else
				assert {from}.delta != -1, "Delta size must be known for backward crunchers safety"
				assert {to} >= {from.last} + {from}.delta
			endif
		endif
		print "Uncrunch from ", {hex}{from}, " to ", {hex}{to}
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_STANDARD_BACKWARD" class="anchor-offset">MACRO UNCRUNCH_STANDARD_BACKWARD(from,to)</h4>
                    <div><p>Request to uncrunch data from {from} to {to} with the selected cruncher.
Add some tests to check that the selected data is valid.
Parameters:</p>
<ul>
<li>{from}: start address of the crunched data (the very first byte)</li>
<li>{to}:   address where the uncrunched data will be stored (the very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_STANDARD_BACKWARD_source')">View Source</button>
                        <div id="macro_UNCRUNCH_STANDARD_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		UNCRUNCH_PRELUDE_BACKWARD({from}, {to})

		ld hl, {from}.last
		ld de, {to} + {from}.uncrunched_length - 1
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INDIRECT_UNCRUNCH_STANDARD_BACKWARD" class="anchor-offset">MACRO INDIRECT_UNCRUNCH_STANDARD_BACKWARD(moved_from,from,to)</h4>
                    <div><p>Indirect uncrunch is used when the crunched data has been move elsewhere.
As such the from labels are not correct anymore.</p>
<p>Parameters:</p>
<ul>
<li>{moved_from}: address where the crunched data has been moved</li>
<li>{from}: start address of the crunched data (the very first byte) BEFORE it has been moved</li>
<li>{to}:   address where the uncrunched data will be stored (the very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INDIRECT_UNCRUNCH_STANDARD_BACKWARD_source')">View Source</button>
                        <div id="macro_INDIRECT_UNCRUNCH_STANDARD_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		INDIRECT_UNCRUNCH_PRELUDE_BACKWARD({moved_from}, {from}, {to})

		ld hl, {moved_from} +  {from}.length - 1
		ld de, {to} + {from}.uncrunched_length - 1
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_STANDARD_NOT_BACKWARD" class="anchor-offset">MACRO UNCRUNCH_STANDARD_NOT_BACKWARD(from,to)</h4>
                    <div><p>Request to uncrunch data from {from} to {to} with the selected cruncher.
Add some tests to check that the selected data is valid.
Parameters:</p>
<ul>
<li>{from}: start address of the crunched data (the very first byte)</li>
<li>{to}:   address where the uncrunched data will be stored (the very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_STANDARD_NOT_BACKWARD_source')">View Source</button>
                        <div id="macro_UNCRUNCH_STANDARD_NOT_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		UNCRUNCH_PRELUDE_NOT_BACKWARD({from}, {to})

		ld hl, {from}
		ld de, {to}
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD" class="anchor-offset">MACRO INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD(moved_from,from,to)</h4>
                    <div><p>Indirect uncrunch is used when the crunched data has been moved elsewhere.
As such the from labels are not correct anymore.</p>
<p>Parameters:</p>
<ul>
<li>{moved_from}: address where the crunched data has been moved</li>
<li>{from}: start address of the crunched data (the very first byte) BEFORE it has been moved</li>
<li>{to}:   address where the uncrunched data will be stored (the very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD_source')">View Source</button>
                        <div id="macro_INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		INDIRECT_UNCRUNCH_PRELUDE_NOT_BACKWARD({moved_from}, {from}, {to})

		ld hl, {moved_from}
		ld de, {to}
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_LZ4" class="anchor-offset">MACRO UNCRUNCH_LZ4(from,to)</h4>
                    <div><p>Request to uncrunch data from {from} to {to} with LZ4 cruncher.
Add some tests to check that the selected data is valid.
Parameters:</p>
<ul>
<li>{from}: start address of the crunched data (the very first byte)</li>
<li>{to}:   address where the uncrunched data will be stored (The very first byte)v</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_LZ4_source')">View Source</button>
                        <div id="macro_UNCRUNCH_LZ4_source" class="macro-source-content">
                            <pre><code>
		UNCRUNCH_PRELUDE_NOT_BACKWARD({from}, {to})


		ld hl, {from}.start
		ld bc, {from}.length
		ld de, {to}
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_UPKR" class="anchor-offset">MACRO UNCRUNCH_UPKR(from,to)</h4>
                    <div><p>Request to uncrunch data from {from} to {to} with UPKR cruncher.
Add some tests to check that the selected data is valid.
Parameters:</p>
<ul>
<li>{from}: start address of the crunched data (the very first byte)</li>
<li>{to}:   address where the uncrunched data will be stored (The very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_UPKR_source')">View Source</button>
                        <div id="macro_UNCRUNCH_UPKR_source" class="macro-source-content">
                            <pre><code>
		UNCRUNCH_PRELUDE_NOT_BACKWARD({from}, {to})

		ld ix, {from}
		ld de, {to} : exx
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH_SHRINKLER" class="anchor-offset">MACRO UNCRUNCH_SHRINKLER(from,to)</h4>
                    <div><p>Request to uncrunch data from {from} to {to} with SHRINKLER cruncher.
Add some tests to check that the selected data is valid.
Parameters:</p>
<ul>
<li>{from}: start address of the crunched data (the very first byte)</li>
<li>{to}:   address where the uncrunched data will be stored (The very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_SHRINKLER_source')">View Source</button>
                        <div id="macro_UNCRUNCH_SHRINKLER_source" class="macro-source-content">
                            <pre><code>
		UNCRUNCH_PRELUDE_NOT_BACKWARD({from}, {to})

		ld ix, {from}.start
		ld de, {to}
		call uncrunch
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_EXOMIZER" class="anchor-offset">MACRO INSTALL_EXOMIZER()</h4>
                    <div><p>Install the uncruncher for exomizer</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_EXOMIZER_source')">View Source</button>
                        <div id="macro_INSTALL_EXOMIZER_source" class="macro-source-content">
                            <pre><code>
		include once "inner://deexo.asm"
	uncrunch
		Mizoumizeur()
		ret
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_APLIB" class="anchor-offset">MACRO INSTALL_APLIB()</h4>
                    <div><p>Install the uncruncher for aplib</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_APLIB_source')">View Source</button>
                        <div id="macro_INSTALL_APLIB_source" class="macro-source-content">
                            <pre><code>
			include once "inner://unaplib_fast.asm"
	uncrunch
		ApUnpack()
		ret
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_UPKR" class="anchor-offset">MACRO INSTALL_UPKR()</h4>
                    <div><p>Install the uncruncher for upkr</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_UPKR_source')">View Source</button>
                        <div id="macro_INSTALL_UPKR_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://uncrunch/upkr.asm"
		org upkr.probs_e ; we need to skip some space for the upkr probe
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_LZ4" class="anchor-offset">MACRO INSTALL_LZ4()</h4>
                    <div><p>Install the uncruncher for lz4</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_LZ4_source')">View Source</button>
                        <div id="macro_INSTALL_LZ4_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://lz4_docent.asm"
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_LZ48" class="anchor-offset">MACRO INSTALL_LZ48()</h4>
                    <div><p>Install the uncruncher for LZ48</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_LZ48_source')">View Source</button>
                        <div id="macro_INSTALL_LZ48_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://lz48decrunch.asm"
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_LZ49" class="anchor-offset">MACRO INSTALL_LZ49()</h4>
                    <div><p>Install the uncruncher for LZ49</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_LZ49_source')">View Source</button>
                        <div id="macro_INSTALL_LZ49_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://lz49decrunch.asm"
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_LZSA1" class="anchor-offset">MACRO INSTALL_LZSA1()</h4>
                    <div><p>Install the uncruncher for LZSA1</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_LZSA1_source')">View Source</button>
                        <div id="macro_INSTALL_LZSA1_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://unlzsa1_fast.asm"
		DecompressLZSA1(void)
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_LZSA2" class="anchor-offset">MACRO INSTALL_LZSA2()</h4>
                    <div><p>Install the uncruncher for LZSA2</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_LZSA2_source')">View Source</button>
                        <div id="macro_INSTALL_LZSA2_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://unlzsa2_fast.asm"
		DecompressLZSA2(void)
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_SHRINKLER" class="anchor-offset">MACRO INSTALL_SHRINKLER()</h4>
                    <div><p>Install the uncruncher for shrinkler</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_SHRINKLER_source')">View Source</button>
                        <div id="macro_INSTALL_SHRINKLER_source" class="macro-source-content">
                            <pre><code>
		include once "inner://deshrink.asm"
		uncrunch equ shrinkler_decrunch
		org probs + &800
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_ZX0" class="anchor-offset">MACRO INSTALL_ZX0()</h4>
                    <div><p>Install the uncruncher for zx0</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_ZX0_source')">View Source</button>
                        <div id="macro_INSTALL_ZX0_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://dzx0_fast.asm"
		DecompressZX0()
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_ZX0_BACKWARD" class="anchor-offset">MACRO INSTALL_ZX0_BACKWARD()</h4>
                    <div><p>Install the uncruncher for zx0 backward</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_ZX0_BACKWARD_source')">View Source</button>
                        <div id="macro_INSTALL_ZX0_BACKWARD_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://uncrunch/dzx0_turbo_back.asm"
		DecompressZX0TurboBackward()
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_ZX7" class="anchor-offset">MACRO INSTALL_ZX7()</h4>
                    <div><p>Install the uncruncher for zx7</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_ZX7_source')">View Source</button>
                        <div id="macro_INSTALL_ZX7_source" class="macro-source-content">
                            <pre><code>
		uncrunch
		include once "inner://uncrunch/dzx7_turbo.asm"
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_LOAD_N_CRUNCH" class="anchor-offset">MACRO LOAD_N_CRUNCH(label,fname)</h4>
                    <div><p>Load a data file and crunch it with the selected cruncher.
The file is crunched with the selected cruncher at the label <code>label</code>
Sub labels .start is synonyme, .next is the byte after last crunched byte, .length is the crunched size</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_LOAD_N_CRUNCH_source')">View Source</button>
                        <div id="macro_LOAD_N_CRUNCH_source" class="macro-source-content">
                            <pre><code>
		switch SELECTED_CRUNCHER
			case CRUNCHER_EXOMIZER:
				LOAD_N_CRUNCH_WITH(LZEXO, {label}, {fname})
				break
			case CRUNCHER_APLIB
				LOAD_N_CRUNCH_WITH(LZAPU, {label}, {fname})
				break
			case CRUNCHER_UPKR
				LOAD_N_CRUNCH_WITH(LZUPKR, {label}, {fname})
				break
			case CRUNCHER_LZ4
				LOAD_N_CRUNCH_WITH(LZ4, {label}, {fname})
				break
			case CRUNCHER_LZ48
				LOAD_N_CRUNCH_WITH(LZ48, {label}, {fname})
				break
			case CRUNCHER_LZ49
				LOAD_N_CRUNCH_WITH(LZ49, {label}, {fname})
				break
			case CRUNCHER_LZSA1
				LOAD_N_CRUNCH_WITH(LZSA1, {label}, {fname})
				break
			case CRUNCHER_LZSA2
				LOAD_N_CRUNCH_WITH(LZSA2, {label}, {fname})
				break
			case CRUNCHER_SHRINKLER
				LOAD_N_CRUNCH_WITH(LZSHRINKLER, {label}, {fname})
				break
			case CRUNCHER_ZX0
				LOAD_N_CRUNCH_WITH(LZX0, {label}, {fname})
				break
			case CRUNCHER_ZX0_BACKWARD
				LOAD_N_CRUNCH_WITH(LZX0_BACKWARD, {label}, {fname})
				break
			case CRUNCHER_ZX7
				LOAD_N_CRUNCH_WITH(LZX7, {label}, {fname})
				break
			default:
				fail "Unhandled case: ", SELECTED_CRUNCHER
		ends
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_UNCRUNCH" class="anchor-offset">MACRO UNCRUNCH(from,to)</h4>
                    <div><p>Uncrunch data from {from} to {to} with the selected cruncher
Parameters:</p>
<ul>
<li>from: start address of the crunched data (the very first byte). It is better to use a label (with its sublabels) than an address</li>
<li>to: start address where the uncrunched data will be stored (the very first byte)</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_UNCRUNCH_source')">View Source</button>
                        <div id="macro_UNCRUNCH_source" class="macro-source-content">
                            <pre><code>
		switch SELECTED_CRUNCHER
			case CRUNCHER_EXOMIZER:
			case CRUNCHER_APLIB:
			case CRUNCHER_LZ48:
			case CRUNCHER_LZ49:
			case CRUNCHER_LZSA1:
			case CRUNCHER_LZSA2:
			case CRUNCHER_ZX0:
			case CRUNCHER_ZX7:
				UNCRUNCH_STANDARD_NOT_BACKWARD({from}, {to})
				break
			case CRUNCHER_ZX0_BACKWARD:
				UNCRUNCH_STANDARD_BACKWARD({from}, {to})
				break
			case CRUNCHER_UPKR:
				UNCRUNCH_UPKR({from}, {to})
				break
			case CRUNCHER_LZ4:
				UNCRUNCH_LZ4({from}, {to})
				break
			case CRUNCHER_SHRINKLER
				UNCRUNCH_SHRINKLER({from}, {to})
				break
			default:
				fail "Unhandled case: ", SELECTED_CRUNCHER
		ends
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INDIRECT_UNCRUNCH" class="anchor-offset">MACRO INDIRECT_UNCRUNCH(moved_from,from,to)</h4>
                    <div><p>Indirect uncrunch data from {from} to {to} with the selected cruncher
Parameters:</p>
<ul>
<li>moved_from: address where the crunched data has been moved</li>
<li>from: start address of the crunched data (the very first byte) was initially before being moved. It is better to use a label (with its sublabels) than an address</li>
<li>to: start address where the uncrunched data will be stored (the very first byte)</li>
</ul>
<p>TODO: implement all the case. ATM I have only implemented what I used</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INDIRECT_UNCRUNCH_source')">View Source</button>
                        <div id="macro_INDIRECT_UNCRUNCH_source" class="macro-source-content">
                            <pre><code>
		switch SELECTED_CRUNCHER
			case CRUNCHER_EXOMIZER:
			case CRUNCHER_APLIB:
			case CRUNCHER_LZ48:
			case CRUNCHER_LZ49:
			case CRUNCHER_LZSA1:
			case CRUNCHER_LZSA2:
			case CRUNCHER_ZX0:
			case CRUNCHER_ZX7:
				INDIRECT_UNCRUNCH_STANDARD_NOT_BACKWARD({moved_from}, {from}, {to})
				break
			case CRUNCHER_ZX0_BACKWARD:
				INDIRECT_UNCRUNCH_STANDARD_BACKWARD({moved_from}, {from}, {to})
				break
			case CRUNCHER_UPKR:
				INDIRECT_UNCRUNCH_UPKR({moved_from}, {from}, {to})
				break
			case CRUNCHER_LZ4:
				INDIRECT_UNCRUNCH_LZ4({moved_from}, {from}, {to})
				break
			case CRUNCHER_SHRINKLER
				INDIRECT_UNCRUNCH_SHRINKLER({moved_from}, {from}, {to})
				break
			default:
				fail "Unhandled case: ", SELECTED_CRUNCHER
		ends
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_INSTALL_UNCRUNCHER" class="anchor-offset">MACRO INSTALL_UNCRUNCHER()</h4>
                    <div><p>Install the uncruncher for the selected cruncher</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_INSTALL_UNCRUNCHER_source')">View Source</button>
                        <div id="macro_INSTALL_UNCRUNCHER_source" class="macro-source-content">
                            <pre><code>
		switch SELECTED_CRUNCHER
			case CRUNCHER_EXOMIZER:
				INSTALL_EXOMIZER()
				break
			case CRUNCHER_APLIB:
				INSTALL_APLIB()
				break
			case CRUNCHER_UPKR:
				INSTALL_UPKR()
				break
			case CRUNCHER_LZ4
				INSTALL_LZ4()
				break
			case CRUNCHER_LZ48
				INSTALL_LZ48()
				break
			case CRUNCHER_LZ49
				INSTALL_LZ49()
				break
			case CRUNCHER_LZSA1
				INSTALL_LZSA1()
				break
			case CRUNCHER_LZSA2
				INSTALL_LZSA2()
				break
			case CRUNCHER_SHRINKLER
				INSTALL_SHRINKLER()
				break
			case CRUNCHER_ZX0
				INSTALL_ZX0()
				break
			case CRUNCHER_ZX0_BACKWARD
				INSTALL_ZX0_BACKWARD()
				break
			case CRUNCHER_ZX7
				INSTALL_ZX7()
				break
			default:
				fail "Unhandled case: ", SELECTED_CRUNCHER
			ends
	</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_INITIALIZATION" class="anchor-offset">MACRO DS_INITIALIZATION()</h4>
                    <div><p>This macro should be called at the very beginning of the demo.
it aims at checking the kind of device use to load</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_INITIALIZATION_source')">View Source</button>
                        <div id="macro_DS_INITIALIZATION_source" class="macro-source-content">
                            <pre><code>
    DS_PRIVATE_CPCBOOSTER_INIT_COMMUNICATION() ; setup the booster if flag activated
    DS_BACKUP_FIRMWARE()
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_SELECT_A_MEMORY_SPACE" class="anchor-offset">MACRO DS_SELECT_A_MEMORY_SPACE(space)</h4>
                    <div><p>Select a memory space for the demo
Completly relocatable code</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_SELECT_A_MEMORY_SPACE_source')">View Source</button>
                        <div id="macro_DS_SELECT_A_MEMORY_SPACE_source" class="macro-source-content">
                            <pre><code>
    assert {space} >= 0xC0 and {space} <= 0xc7
    ld bc, &7f00 + {space} : out (c),c  
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_LOAD_FILE_IN_EXTRA_PAGE" class="anchor-offset">MACRO DS_LOAD_FILE_IN_EXTRA_PAGE(filename,filename_size,address,loading_options)</h4>
                    <div><p>Request the demosystem to load a file.
This macro must be called when being in space &amp;c0
The process to load a file is the following:</p>
<ul>
<li>memory conf. in &amp;C1</li>
<li>restore the system</li>
<li>memory conf in &amp;C2</li>
<li>load the file</li>
<li>backup the system</li>
<li>memory conf in C1</li>
<li>restore the normal stack</li>
<li>memory conf in &amp;C0</li>
</ul>
<p>In case of failure the program is stucked
In case of success:</p>
<ul>
<li>page 1 contains the loaded file</li>
<li>bc contains the length of the file</li>
<li>de contains the expected destination of the file</li>
</ul>
<p>Input:</p>
<ul>
<li>filename: address to the filename</li>
<li>address: loading address IN THE EXTRA page</li>
</ul>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_LOAD_FILE_IN_EXTRA_PAGE_source')">View Source</button>
                        <div id="macro_DS_LOAD_FILE_IN_EXTRA_PAGE_source" class="macro-source-content">
                            <pre><code>
    __DS_LOAD_FILE_IN_EXTRA_PAGE_INNER__({filename}, {filename_size}, {address}, true, {loading_options})
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro___DS_LOAD_FILE_IN_EXTRA_PAGE_INNER__" class="anchor-offset">MACRO __DS_LOAD_FILE_IN_EXTRA_PAGE_INNER__(filename,filename_size,address,restore_bank,loading_options)</h4>
                    <div><p>Private macro. Do not use directly
Load a file and optionnaly restore &amp;C0</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro___DS_LOAD_FILE_IN_EXTRA_PAGE_INNER___source')">View Source</button>
                        <div id="macro___DS_LOAD_FILE_IN_EXTRA_PAGE_INNER___source" class="macro-source-content">
                            <pre><code>

    assert {filename} < 0xC000, "The filename cannot be in the address space [&C000-&FFFF] because we switch of bank"

    ; TODO add memory check to ensure we do no load in restricted areas

    assert $<0xC000, "You cannot be here as we will switch in &C1 and &C2 configurations" ; TODO use a real filtering adress bacause we do not have to be so pedantic
    assert {filename_size} > 0, "You need a file name"

    DS_SELECT_DS_BOOTSTRAP_SPACE() 

        ld hl, {filename}
        ld de, {address}
        ld bc, {filename_size}*256 + {loading_options}
        call DS_LOAD_ADDRESS

    if {restore_bank}
        push bc
            DS_SELECT_MAIN_SPACE()
        pop bc
    endif
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_LOAD_FILE_IN_MAIN_PAGE" class="anchor-offset">MACRO DS_LOAD_FILE_IN_MAIN_PAGE(filename_addr,filename_size,load_address,loading_options)</h4>
                    <div><p>Load first the file in extra page.
Once done, move it, in the main memory.
This is a slow process as each byte has to pass over a buffer
TODO handle a fast copy for bytes NOT in &amp;4000-&amp;7fff space as they can skip the buffer
TODO handle case where the memory is overriden by the loaded file</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_LOAD_FILE_IN_MAIN_PAGE_source')">View Source</button>
                        <div id="macro_DS_LOAD_FILE_IN_MAIN_PAGE_source" class="macro-source-content">
                            <pre><code>
    ; Load the file and stay in the extra memory configuration
    __DS_LOAD_FILE_IN_EXTRA_PAGE_INNER__({filename_addr}, {filename_size}, DS_FIRST_AVAILABLE_ADDRESS, false, {loading_options})
    
    ; By construction BC contains the number of byte read
    ld hl, DS_FIRST_AVAILABLE_ADDRESS
    ld de, {load_address}
    call __DS_COPY_FROM_EXTRA_TO_MAIN__

    DS_SELECT_MAIN_SPACE()

</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_LOAD_AND_RUN_FILE_IN_MAIN_PAGE" class="anchor-offset">MACRO DS_LOAD_AND_RUN_FILE_IN_MAIN_PAGE(filename,filename_size,load_address,exec_address,loading_options)</h4>
                    <div><p>Load first the file in extra page.
Once done, move it, in the main memory.
This is a slow process as each byte has to pass over a buffer.
Then launch it
TODO handle a fast copy for bytes NOT in &amp;4000-&amp;7fff space as they can skip the buffer
TODO handle case where the memory is overriden by the loaded file</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_LOAD_AND_RUN_FILE_IN_MAIN_PAGE_source')">View Source</button>
                        <div id="macro_DS_LOAD_AND_RUN_FILE_IN_MAIN_PAGE_source" class="macro-source-content">
                            <pre><code>

    DS_LOAD_FILE_IN_MAIN_PAGE( {filename}, {filename_size}, {load_address}, {loading_options})
    jp {exec_address}
	assert $<={load_address}

</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_MAKE_FIRMWARE_QUIET" class="anchor-offset">MACRO DS_MAKE_FIRMWARE_QUIET()</h4>
                    <div><p>Ensure the demosystem will not write anywhere
It is probably mandatory using C1 as any print will destroy the demosystem</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_MAKE_FIRMWARE_QUIET_source')">View Source</button>
                        <div id="macro_DS_MAKE_FIRMWARE_QUIET_source" class="macro-source-content">
                            <pre><code>
    di

        ; Coupe tout son et on s'assure qu'aucun
        ; Ã©vÃ¨nement sonore est en cours de traitement
        call &bca7 ; SOUND RESET
        ; Purge de tout appui de touche en cours de traitement
        call &bd3d ; KM FLUSH
        ; DÃ©sactive complÃ¨tement de la gestion du clavier
        ld a,&c9 ; RET
        ld (&bdf4),a ; KM SCAN KEYS
        ; DÃ©sactive les messages d'erreur disquette
        ; de cette faÃ§on, les erreurs ne sont plus bloquantes
        ; et les messages d'erreur ne sont plus affichÃ©s
        ld a,&ff ; &ff = DÃ©sactivÃ©
        ld (&be78),a
        ; DÃ©sactive le clignotement des couleurs
        ld hl,&b7f9 ; HL = Event block des couleurs
        call &BCDD ; KL_DEL_FRAME_FLY
        ; DÃ©sactive tout affichage (au cas oÃ¹)
        call &BB57 ; TXT_VDU_DISABLE

    ei
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_COPY_MEMORY_FROM_EXTRA_PAGE_TO_MAIN_PAGE" class="anchor-offset">MACRO DS_COPY_MEMORY_FROM_EXTRA_PAGE_TO_MAIN_PAGE(from,to,page,size)</h4>
                    <div><p>Copy something loaded in the extra memory into the main memory</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_COPY_MEMORY_FROM_EXTRA_PAGE_TO_MAIN_PAGE_source')">View Source</button>
                        <div id="macro_DS_COPY_MEMORY_FROM_EXTRA_PAGE_TO_MAIN_PAGE_source" class="macro-source-content">
                            <pre><code>

    @from_until = {from} + {size}
    @to_until = {to} + {size}

    assert {from} >= 0x4000 and {from} < 0x8000 and  @from_until >= 0x4000 and @from_until < 0x8000, "You can copy at maximum 0x4000 bytes, from [0x4000;0x8000["
    assert ({to} < 0x4000 || {to} >= 0x8000) and (@to_until < 0x4000 || @to_until >= 0x8000), "You can paste only outside of [0x4000;0x8000["


    DS_SELECT_A_MEMORY_SPACE({eval}{page})

    ld bc, {size}
    ld de, {to}
    ld hl, {from}
    ldir

    DS_SELECT_MAIN_SPACE()
    

</code></pre>
                        </div>
                    </div>
                    
                </div>
                
                <div class="item">
                    <h4 id="macro_DS_BACKUP_FIRMWARE" class="anchor-offset">MACRO DS_BACKUP_FIRMWARE()</h4>
                    <div><p>Backup the firmware.
Has to be called one time at the beginning of the demo.</p>
</div>
                    
                    <div class="macro-source">
                        <button class="macro-source-toggle" onclick="toggleSource('macro_DS_BACKUP_FIRMWARE_source')">View Source</button>
                        <div id="macro_DS_BACKUP_FIRMWARE_source" class="macro-source-content">
                            <pre><code>
    DS_SELECT_DS_BOOTSTRAP_SPACE() 
        di
            call __DS_BACKUP_FIRMWARE_ROUTINE__
        ei
    DS_SELECT_MAIN_SPACE()
</code></pre>
                        </div>
                    </div>
                    
                </div>
                
            </section>
            

            <!-- Equs section -->
            
            <section class="section">
                <h2 id="equs-section" class="anchor-offset">Equs</h2>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_NUL" class="anchor-offset">CHAR_CTRL_NUL EQU 0</h4>
                    <div><p>No effect. Ignored.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_SOH" class="anchor-offset">CHAR_CTRL_SOH EQU 1</h4>
                    <div><p>Print the symbol given by the parameter value. This allows the symbols in the range 0 to 31 to be displayed.
Parameter 0-255 value of the symbol to print</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_STX" class="anchor-offset">CHAR_CTRL_STX EQU 2</h4>
                    <div><pre><code>Turn off text cursor.</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_ETX" class="anchor-offset">CHAR_CTRL_ETX EQU 3</h4>
                    <div><pre><code>Turn on text cursor. </code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_EOT" class="anchor-offset">CHAR_CTRL_EOT EQU 4</h4>
                    <div><pre><code>Set screen mode.
</code></pre>
<p>Parameter 0,1,2</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_ENQ" class="anchor-offset">CHAR_CTRL_ENQ EQU 5</h4>
                    <div><p>Send the parameter character to the graphics cursor.
Parameter 0-255 value of the symbol to print</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_ACK" class="anchor-offset">CHAR_CTRL_ACK EQU 6</h4>
                    <div><p>Enable Text Screen (see NAK)</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_BEL" class="anchor-offset">CHAR_CTRL_BEL EQU 7</h4>
                    <div><p>Sound Bleeper. Note that this flushes the sound queues.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_BS" class="anchor-offset">CHAR_CTRL_BS EQU 8</h4>
                    <div><p>Move cursor back one character</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_TAB" class="anchor-offset">CHAR_CTRL_TAB EQU 9</h4>
                    <div><p>Move cursor forward one character.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_LF" class="anchor-offset">CHAR_CTRL_LF EQU 10</h4>
                    <div><pre><code>Move cursor down one line</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_VT" class="anchor-offset">CHAR_CTRL_VT EQU 11</h4>
                    <div><pre><code>Move cursor up one line</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_FF" class="anchor-offset">CHAR_CTRL_FF EQU 12</h4>
                    <div><p>Clear text window and move cursor to top left corner.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_CR" class="anchor-offset">CHAR_CTRL_CR EQU 13</h4>
                    <div><p>Move cursor to left edge of window on current line.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_SO" class="anchor-offset">CHAR_CTRL_SO EQU 14</h4>
                    <div><p>Set Paper Ink
parameter paper 0-15</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_SI" class="anchor-offset">CHAR_CTRL_SI EQU 15</h4>
                    <div><p>Set Pen Ink
parameter pen 0-15</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_DLE" class="anchor-offset">CHAR_CTRL_DLE EQU 16</h4>
                    <div><pre><code>Delete current character</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_DC1" class="anchor-offset">CHAR_CTRL_DC1 EQU 17</h4>
                    <div><p>Clear from left edge of window to, and including, the current character position</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_DC2" class="anchor-offset">CHAR_CTRL_DC2 EQU 18</h4>
                    <div><pre><code>Clear from, and including, the current character position to the right edge of window.</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_DC3" class="anchor-offset">CHAR_CTRL_DC3 EQU 19</h4>
                    <div><pre><code>Clear from start of window to, and including, the current character position.</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_DC4" class="anchor-offset">CHAR_CTRL_DC4 EQU 20</h4>
                    <div><pre><code>Clear from, and including, the current character position to the end of window.</code></pre>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_NAK" class="anchor-offset">CHAR_CTRL_NAK EQU 21</h4>
                    <div><p>Turn off text screen. The screen will not react to anything sent to it until after an ACK is sent</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_SYN" class="anchor-offset">CHAR_CTRL_SYN EQU 22</h4>
                    <div><p>Set transparency
Parameter (0 disables, 1 enables)</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_ETB" class="anchor-offset">CHAR_CTRL_ETB EQU 23</h4>
                    <div><pre><code>Set graphics ink mode. 
</code></pre>
<p>Parameter 0 normal (overwrite), 1 XOR, 2 AND, 3 OR</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_CAN" class="anchor-offset">CHAR_CTRL_CAN EQU 24</h4>
                    <div><p>Exchange Pen and Paper Inks, effectively applying the reverse video effect</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_EM" class="anchor-offset">CHAR_CTRL_EM EQU 25</h4>
                    <div><p>Set the matrix for user definable character. The first parameter specifies which character's matrix to set. The next eight specify the matrix.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_SUB" class="anchor-offset">CHAR_CTRL_SUB EQU 26</h4>
                    <div><p>Set Window. The parameters specify left, right, top and bottom edges of the window.
Parameters 1-80, 1-80, 1-25, 1-25</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_ESC" class="anchor-offset">CHAR_CTRL_ESC EQU 27</h4>
                    <div><p>No effect. Ignored.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_FS" class="anchor-offset">CHAR_CTRL_FS EQU 28</h4>
                    <div><p>Set Ink to a pair of colors. The first parameter specifies the Ink, the next two the required colors
Parameters 0-15, 0-31, 0-31</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_GS" class="anchor-offset">CHAR_CTRL_GS EQU 29</h4>
                    <div><p>Set Border to a pair of colors. Equivalent to a BORDER command. The two parameters specify the two colors.
Parameters 0-31, 0-31</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_RS" class="anchor-offset">CHAR_CTRL_RS EQU 30</h4>
                    <div><p>Move cursor to top left hand corner of window.</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_CHAR_CTRL_US" class="anchor-offset">CHAR_CTRL_US EQU 31</h4>
                    <div><p>Move cursor to the given position in the current window. The first parameter gives the column to move to, the second gives the line.
Parameters  	1-80, 1-25</p>
</div>
                </div>
                
                <div class="item">
                    <h4 id="equ_DS_FIRST_AVAILABLE_ADDRESS" class="anchor-offset">DS_FIRST_AVAILABLE_ADDRESS EQU &300</h4>
                    <div><p>The minmum address available to load a file in the main memory.</p>
</div>
                </div>
                
            </section>
            
        </main>
    </div>
    <script>
        function toggleSource(id) {
            const content = document.getElementById(id);
            const button = event.target;
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                button.classList.remove('active');
            } else {
                content.classList.add('show');
                button.classList.add('active');
            }
        }
    </script>
</body>
</html>