<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - </title>
    <!-- Highlight.js for syntax highlighting (embedded for offline use) -->
    <style>
        pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}
    </style>

    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f5f5f5;
}

.container {
    display: flex;
    min-height: 100vh;
}

/* Sidebar (Table of Contents) */
.sidebar {
    width: 300px;
    background-color: #fff;
    border-right: 1px solid #e0e0e0;
    padding: 20px;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    box-shadow: 2px 0 5px rgba(0,0,0,0.05);
}

.sidebar h1 {
    font-size: 1.2em;
    margin-bottom: 10px;
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 8px;
}

.sidebar h2 {
    font-size: 0.95em;
    margin-top: 20px;
    margin-bottom: 10px;
    color: #555;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.sidebar ul {
    list-style: none;
    margin-left: 0;
}

.sidebar li {
    margin: 4px 0;
}

.sidebar a {
    color: #3498db;
    text-decoration: none;
    display: block;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background-color 0.2s, color 0.2s;
    font-size: 0.9em;
}

.sidebar a:hover {
    background-color: #e8f4f8;
    color: #2980b9;
}

.sidebar a code {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.9em;
}

/* Main content */
.main-content {
    margin-left: 300px;
    flex: 1;
    padding: 40px 60px;
    background-color: #fff;
    max-width: calc(100% - 300px);
}

.main-content h1 {
    font-size: 2.5em;
    color: #2c3e50;
    margin-bottom: 10px;
    border-bottom: 3px solid #3498db;
    padding-bottom: 10px;
}

.main-content h2 {
    font-size: 2em;
    color: #34495e;
    margin-top: 40px;
    margin-bottom: 20px;
    border-bottom: 2px solid #ecf0f1;
    padding-bottom: 10px;
}

.main-content h3 {
    font-size: 1.5em;
    color: #555;
    margin-top: 30px;
    margin-bottom: 15px;
}

.main-content h4 {
    font-size: 1.2em;
    color: #666;
    margin-top: 25px;
    margin-bottom: 12px;
    padding: 8px 12px;
    background-color: #f8f9fa;
    border-left: 4px solid #3498db;
    border-radius: 3px;
}

.main-content code {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    background-color: #f5f5f5;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.9em;
    color: #e74c3c;
}

.main-content pre {
    background-color: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    padding: 15px;
    overflow-x: auto;
    margin: 15px 0;
}

.main-content pre code {
    background-color: transparent;
    padding: 0;
    color: #333;
}

/* Custom syntax highlighting colors for BASM template variables */
.hljs-params {
    color: #e06c75 !important; /* Bright red/pink for template variables like {comment} */
    font-weight: 600;
}

.main-content p {
    margin-bottom: 15px;
}

.main-content ul, .main-content ol {
    margin-left: 25px;
    margin-bottom: 15px;
}

.main-content li {
    margin-bottom: 8px;
}

/* Tables from markdown */
.main-content table {
    border-collapse: collapse;
    width: 100%;
    margin: 20px 0;
    background-color: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.main-content table th {
    background-color: #3498db;
    color: white;
    font-weight: 600;
    padding: 12px;
    text-align: left;
    border: 1px solid #2980b9;
}

.main-content table td {
    padding: 10px 12px;
    border: 1px solid #e0e0e0;
}

.main-content table tr:nth-child(even) {
    background-color: #f8f9fa;
}

.main-content table tr:hover {
    background-color: #e8f4f8;
}

/* Markdown content inside items */
.item > div h1,
.item > div h2,
.item > div h3 {
    font-size: 1.1em;
    margin-top: 15px;
    margin-bottom: 10px;
    color: #555;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 5px;
}

.item > div h1:first-child,
.item > div h2:first-child,
.item > div h3:first-child {
    margin-top: 0;
}

.item > div ul,
.item > div ol {
    margin-left: 20px;
}

.item > div blockquote {
    border-left: 4px solid #3498db;
    padding-left: 15px;
    margin: 15px 0;
    color: #666;
    font-style: italic;
}

.file-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 8px;
    margin-bottom: 40px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.file-header h1 {
    border: none;
    color: white;
    margin: 0;
}

.file-name {
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.9em;
    opacity: 0.9;
    margin-top: 10px;
}

.section {
    margin-top: 40px;
}

.item {
    margin-bottom: 30px;
    padding: 20px;
    background-color: #fafafa;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
}

.item h4 {
    margin-top: 0;
}

/* Item header with location info on the right */
.item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
}

.item-name {
    flex: 1;
}

h4.item-header .ref-location {
    flex-shrink: 0;
    font-size: 0.75em !important;
    font-weight: normal !important;
    white-space: nowrap;
}

/* Collapsible source code */
.macro-source {
    margin-top: 15px;
}

.macro-source-toggle {
    background-color: #3498db;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 500;
    transition: background-color 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.macro-source-toggle:hover {
    background-color: #2980b9;
}

.macro-source-toggle::before {
    content: "‚ñ∂";
    display: inline-block;
    transition: transform 0.2s;
}

.macro-source-toggle.active::before {
    transform: rotate(90deg);
}

.macro-source-content {
    display: none;
    margin-top: 10px;
    background-color: #282c34;
    border-radius: 4px;
    overflow: hidden;
}

.macro-source-content.show {
    display: block;
}

.macro-source-content pre {
    margin: 0;
    padding: 15px;
    background-color: transparent;
    border: none;
    color: #abb2bf;
    font-size: 0.85em;
    line-height: 1.5;
}

.macro-source-content code {
    color: #abb2bf;
    background-color: transparent;
}

/* Also style details-based macro/source blocks (used by template) */
.macro-source details .hljs,
.macro-source pre.hljs,
.macro-source pre code.hljs,
.macro-source pre {
    background-color: #282c34 !important;
    color: #abb2bf !important;
    border: none;
}

.macro-source details summary {
    cursor: pointer;
    padding: 8px 10px;
    background-color: #2b3037;
    color: #fff;
    border-radius: 4px;
    display: inline-block;
    margin-bottom: 8px;
}

.source-details pre,
.source-details code {
    background-color: #282c34 !important;
    color: #abb2bf !important;
}

/* Style referenced / highlighted contexts shown in cross-references */
.cross-references .reference-list pre,
.cross-references .reference-item pre,
.cross-references .reference-item pre code,
.cross-references pre,
.reference-list pre {
    background-color: #282c34 !important;
    color: #abb2bf !important;
    border: none;
    padding: 12px;
    border-radius: 4px;
    margin: 8px 0;
    overflow-x: auto;
}

.cross-references .reference-item .ref-location {
    display: block;
    font-size: 0.9em;
    color: #9da5ab;
    margin-bottom: 6px;
}

/* Override main-content code styling for macro source */
.macro-source-content pre code {
    color: #abb2bf !important;
    background-color: transparent !important;
    padding: 0;
}

/* Responsive design */
@media (max-width: 768px) {
    .sidebar {
        width: 250px;
    }

    .main-content {
        margin-left: 250px;
        padding: 20px 30px;
        max-width: calc(100% - 250px);
    }
}

@media (max-width: 600px) {
    .container {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
        position: relative;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
    }

    .main-content {
        margin-left: 0;
        max-width: 100%;
        padding: 20px;
    }
}

/* Smooth scrolling */
html {
    scroll-behavior: smooth;
}

/* Anchor offset for fixed sidebar */
.anchor-offset {
    padding-top: 20px;
    margin-top: -20px;
}

/* Search box */
.search-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.search-box {
    position: relative;
    width: 300px;
    padding: 10px 40px 10px 15px;
    border: 2px solid #3498db;
    border-radius: 20px;
    font-size: 0.95em;
    outline: none;
    transition: box-shadow 0.2s;
    background-color: white;
}

.search-box:focus {
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
}

.search-box::placeholder {
    color: #999;
}

.clear-search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 24px;
    padding: 0;
    background-color: transparent;
    color: #333;
    border: none;
    border-radius: 50%;
    font-size: 0.9em;
    cursor: pointer;
    transition: background-color 0.2s, opacity 0.2s, transform 0.1s;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
}

.clear-search-btn.visible {
    opacity: 0.6;
    pointer-events: auto;
}

.clear-search-btn:hover {
    opacity: 1;
    background-color: #f0f0f0;
    transform: translateY(-50%) scale(1.1);
}

.clear-search-btn:active {
    transform: translateY(-50%) scale(0.9);
}

.item.hidden {
    display: none;
}

.item.filtered {
    display: none;
}

.sidebar-item.filtered {
    display: none;
}

.file-filter-link {
    display: block;
    padding: 6px 10px;
    margin: 2px 0;
    border-radius: 4px;
    transition: background-color 0.2s, color 0.2s;
}

.file-filter-link.active {
    background-color: #3498db;
    color: white;
    font-weight: 600;
}

.file-filter-link:hover {
    background-color: #e8f4f8;
}

.file-filter-link.active:hover {
    background-color: #2980b9;
}

/* File tree styles */
.file-tree {
    margin-top: 10px;
}

.file-tree-toggle {
    cursor: pointer;
    padding: 6px 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
    font-size: 0.9em;
    font-weight: 500;
    color: #555;
    user-select: none;
    transition: background-color 0.2s;
}

.file-tree-toggle:hover {
    background-color: #e8f4f8;
}

.file-tree-header {
    margin-bottom: 8px;
}

.file-tree-header .file-filter-link {
    text-align: center;
    font-weight: 600;
    margin-bottom: 10px;
}

.file-tree-content {
    margin-top: 8px;
}

.file-tree-list {
    list-style: none;
    margin: 0;
    padding-left: 0;
}

.file-tree-item {
    margin: 2px 0;
}

.file-tree-folder > details {
    margin: 2px 0;
}

.file-tree-folder > details > summary {
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    color: #555;
    user-select: none;
    transition: background-color 0.2s;
    list-style: none;
}

.file-tree-folder > details > summary::-webkit-details-marker {
    display: none;
}

.file-tree-folder > details > summary:hover {
    background-color: #f8f9fa;
}

.file-tree-folder > details > .file-tree-list {
    padding-left: 16px;
    margin-top: 4px;
}

.file-tree-file a {
    font-size: 0.85em;
    padding: 4px 8px;
}

.no-results {
    padding: 20px;
    text-align: center;
    color: #666;
    font-style: italic;
    display: none;
}

.no-results.visible {
    display: block;
}

/* Symbol cross-reference links */
.symbol-link {
    color: #3498db;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px dotted #3498db;
}

.symbol-link:hover {
    color: #2980b9;
    border-bottom-style: solid;
}

/* Symbol index styles */
.index-letter {
    font-size: 2em;
    color: #3498db;
    margin-top: 30px;
    margin-bottom: 15px;
    border-bottom: 2px solid #3498db;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.index-jump {
    font-size: 0.5em;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}

.index-jump a {
    padding: 2px 6px;
    background-color: #ecf0f1;
    border-radius: 3px;
    text-decoration: none;
    color: #2c3e50;
    transition: background-color 0.2s;
}

.index-jump a:hover {
    background-color: #3498db;
    color: white;
}

.index-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 10px;
    margin-bottom: 20px;
}

.index-item {
    padding: 8px 12px;
    background-color: #f8f9fa;
    border-left: 3px solid #3498db;
    border-radius: 3px;
}

.index-item a {
    text-decoration: none;
    color: #2c3e50;
    font-weight: 500;
}

.index-item a:hover {
    color: #3498db;
}

.index-item-type {
    font-size: 0.75em;
    color: #7f8c8d;
    margin-left: 5px;
    text-transform: uppercase;
}

/* Copy button styles */
.copy-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    padding: 4px 8px;
    background-color: #95a5a6;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.75em;
    opacity: 0;
    transition: opacity 0.2s, background-color 0.2s;
}

.item:hover .copy-btn,
pre:hover .copy-btn {
    opacity: 1;
}

.copy-btn:hover {
    background-color: #7f8c8d;
}

.copy-btn.copied {
    background-color: #27ae60;
}

.item {
    position: relative;
}

pre {
    position: relative;
}

/* Symbol index specific styles */
.index-jump {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 4px;
}

.index-jump a {
    display: inline-block;
    padding: 5px 10px;
    background-color: white;
    color: #3498db;
    text-decoration: none;
    border: 1px solid #ddd;
    border-radius: 3px;
    font-weight: bold;
    transition: all 0.2s;
}

.index-jump a:hover {
    background-color: #3498db;
    color: white;
    border-color: #3498db;
}

.index-item-type {
    display: inline-block;
    margin-left: 10px;
    padding: 2px 8px;
    font-size: 0.75em;
    background-color: #e8f4f8;
    color: #3498db;
    border-radius: 3px;
    font-weight: normal;
}

.index-item a {
    display: block;
    text-decoration: none;
    color: inherit;
}

.index-item a:hover {
    color: #2c3e50;
}

.index-item code {
    font-weight: 500;
}

.index-item.filtered,
.index-item.hidden {
    display: none;
}

.index-letter.hidden,
.index-items.hidden {
    display: none;
}

.jump-link.hidden {
    display: none;
}

/* Cross-references styling */
.cross-references {
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-left: 3px solid #3498db;
    border-radius: 4px;
}

.cross-references h5 {
    margin: 0 0 10px 0;
    font-size: 0.9em;
    color: #555;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.reference-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.reference-item {
    padding: 8px 0;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.reference-item:last-child {
    border-bottom: none;
}

.ref-location {
    font-size: 0.85em;
    color: #3498db;
    font-weight: 600;
}

.ref-context {
    font-size: 0.85em;
    color: #666;
    background-color: #fff;
    padding: 4px 8px;
    border-radius: 3px;
    display: block;
    overflow-x: auto;
    white-space: nowrap;
}

    </style>
</head>
<body>
    <!-- Macro definitions (must be at the top before usage) -->
    
    <!-- Macro for displaying cross-references -->
    
    
    <!-- Macro for sidebar section -->
    
    
    <!-- Macro for item header -->
    
    
    <!-- Macro for source code toggle -->
    
    
    <!-- Macro for displaying a documented item -->
    

    <div class="search-container">
        <input type="text" id="searchBox" class="search-box" placeholder="üîç Search documentation..." />
        <button id="clearSearchBtn" class="clear-search-btn" title="Clear search">‚úï</button>
    </div>
    <div class="container">
        <!-- Sidebar with Table of Contents -->
        <aside class="sidebar">
            <h1>üìö BASMDoc</h1>
            <!--<div class="file-name"></div>-->

            <!-- Symbol Index link -->
            <div class="sidebar-section" id="sidebar-symbol-index">
                <h2><a href="#symbol-index-section" style="color: inherit; text-decoration: none;">üìë Symbol Index</a></h2>
            </div>

            
            <div class="sidebar-section" id="sidebar-files">
                <h2>Files</h2>
                <div class="file-tree-header">
                    <a href="#" id="all-files-link" class="file-filter-link active" data-file="">All Files</a>
                </div>
                <details class="file-tree" open>
                    <summary class="file-tree-toggle">üìÅ File Structure</summary>
                    <div id="file-tree-root" class="file-tree-content"></div>
                </details>
                <!-- Hidden list to store file data -->
                <ul id="file-filter-list" style="display: none;">
                    
                    <li><a href="#" class="file-filter-link" data-file="intro.asm">intro.asm</a></li>
                    
                    <li><a href="#" class="file-filter-link" data-file="intro_code.asm">intro_code.asm</a></li>
                    
                    <li><a href="#" class="file-filter-link" data-file="intro_faked_link.asm">intro_faked_link.asm</a></li>
                    
                    <li><a href="#" class="file-filter-link" data-file="intro_linked.asm">intro_linked.asm</a></li>
                    
                    <li><a href="#" class="file-filter-link" data-file="intro_loader.asm">intro_loader.asm</a></li>
                    
                    <li><a href="#" class="file-filter-link" data-file="music.asm">music.asm</a></li>
                    
                    <li><a href="#" class="file-filter-link" data-file="rain.asm">rain.asm</a></li>
                    
                </ul>
            </div>
            

            

            

            

            
        </aside>

        <!-- Main content -->
        <main class="main-content">
        
        <!--
            <div class="file-header">
                <h1>Assembly Documentation</h1>
                <div class="file-name">File: </div>
            </div>
            -->

            <!-- Symbol Index section -->
            <section class="section" id="symbol-index-section">
                <h2 class="anchor-offset">Symbol Index</h2>
                <div class="index-jump">
                    
                </div>
                
                
            </section>

            <!-- Files section (file-level documentation) -->
            <section class="section">
                <h2 id="files-section" class="anchor-offset">File Documentation</h2>
                
                    <div class="item" data-source-file="intro.asm">
                        <h4 id="source_intro_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm">
<span class="hljs-comment">;	</span>
    <span class="hljs-built_in">bank</span> <span class="hljs-number">&C0</span>
<span class="hljs-comment">; curves and graphics	</span>
 	<span class="hljs-built_in">org</span> <span class="hljs-number">&800</span>
c0_800_start
TAB_MOVES_B <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/MOVEPBOT.TAB"</span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
TAB_MOVES_T <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/MOVEPTOP.TAB"</span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>	
SPRITE_HL   
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/HVYNZL.WIN"</span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
SPRITE_HR	
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/HVYNZR.WIN"</span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
SPRITE_LL  
	<span class="hljs-comment">;incbin "files/LMODE0I.WIN"</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/LVYNZL4.WIN"</span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
SPRITE_LR
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/LVYNZR4.WIN"</span>
<span class="hljs-comment">;  </span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>  
SPRITE_B  
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/BVYNZ.WIN"</span>
SPRITE_H_LOGO	
    <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/HLOGO.WIN"</span>	
SPRITE_B_LOGO  
    <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/BFINAL.WIN"</span> <span class="hljs-comment">; LOGO.WIN"	</span>
SPRITE_L_LOGO 
    <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/LFINAL.WIN"</span> 
<span class="hljs-comment">;	align 256</span>
LOVERS <span class="hljs-comment">;incbin "files/LOVERS.WIN"</span>
<span class="hljs-comment">;</span>
ORNY    <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/ORNY2.WIN"</span>
YTES    <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/YTES3.WIN"</span>  
OVERS   <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/OVERS3.WIN"</span>  

COEUR5  <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/COEUR5F.WIN"</span>
COEUR6  <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/COEUR6F.WIN"</span>
<span class="hljs-comment">;</span>

    <span class="hljs-built_in">assert</span>  $ <= <span class="hljs-number">0x4000</span>
c0_800_stop
c0_800_length <span class="hljs-built_in">equ</span> c0_800_stop - c0_800_start




	<span class="hljs-built_in">org</span> <span class="hljs-number">&8000</span>
	<span class="hljs-built_in">run</span> <span class="hljs-number">&8000</span>
c0_8000_start
	<span class="hljs-built_in">read</span> <span class="hljs-string">"intro_code.asm"</span>
c0_8000_length <span class="hljs-built_in">equ</span> $-c0_8000_start


	<span class="hljs-built_in">bank</span> <span class="hljs-number">&C4</span>	
<span class="hljs-comment">;	</span>
	<span class="hljs-comment">; BUG there is a bug in BASM in the handling of the BANK directive...</span>
	<span class="hljs-comment">;     in the meanwhile, we have to use a warkaround to ge taccurate size</span>
	<span class="hljs-built_in">org</span> <span class="hljs-number">&4000</span>
c4_start	
	terminok = load(<span class="hljs-string">"files/FINALPIC.SCR"</span>)
	c4_length = list_len(terminok)
	<span class="hljs-built_in">db</span> terminok 
c4_stop = c4_start + c4_length
<span class="hljs-comment">;	incbin "files/TERMINOK.SCR"</span>
<span class="hljs-comment">;	assert $< 0x8000</span>
<span class="hljs-comment">;c4_stop</span>
<span class="hljs-comment">;c4_length equ $ - c4_start</span>
<span class="hljs-comment">;</span>


<span class="hljs-comment">;</span>
	<span class="hljs-built_in">bank</span> <span class="hljs-number">&C6</span>
<span class="hljs-comment">; music	</span>
 	<span class="hljs-built_in">org</span> <span class="hljs-number">&4000</span>
c6_start
	<span class="hljs-built_in">read</span> <span class="hljs-string">"music.asm"</span>
c6_stop
<span class="hljs-comment">; c6_length equ $-c6_start ; XXX this seems buggy</span>
c6_length <span class="hljs-built_in">equ</span> c6_stop - c6_start
<span class="hljs-comment">;</span>

    <span class="hljs-built_in">print</span> <span class="hljs-string">"C4_start="</span>, <span class="hljs-meta">{hex}</span>c4_start
	<span class="hljs-built_in">print</span> <span class="hljs-string">"C4_stop="</span>, <span class="hljs-meta">{hex}</span>c4_stop
	<span class="hljs-built_in">print</span> <span class="hljs-string">"C4 length="</span>, <span class="hljs-meta">{hex}</span>c4_length
	<span class="hljs-built_in">print</span> <span class="hljs-string">"C6 length="</span>, <span class="hljs-meta">{hex}</span>c6_length
	<span class="hljs-built_in">print</span> <span class="hljs-string">"C0_800 length="</span>, <span class="hljs-meta">{hex}</span>c0_800_length
	<span class="hljs-built_in">print</span> <span class="hljs-string">"C0_8000 length="</span>, <span class="hljs-meta">{hex}</span>c0_8000_length

    <span class="hljs-built_in">bank</span> <span class="hljs-number">&C0</span>
	<span class="hljs-built_in">save</span> <span class="hljs-string">"C0.800"</span>, c0_800_start, c0_800_length
	<span class="hljs-built_in">save</span> <span class="hljs-string">"C0.8000"</span>, c0_8000_start, c0_8000_length

    <span class="hljs-built_in">bank</span> <span class="hljs-number">&C4</span>
	<span class="hljs-built_in">save</span> <span class="hljs-string">"C4.4000"</span>, c4_start, c4_length

	<span class="hljs-built_in">bank</span> <span class="hljs-number">&C6</span>
	<span class="hljs-built_in">save</span> <span class="hljs-string">"C6.4000"</span>, c6_start, c6_length


	<span class="hljs-built_in">assert</span> c4_length <= <span class="hljs-number">0x4000</span>
	<span class="hljs-built_in">assert</span> c6_length <= <span class="hljs-number">0x4000</span></code></pre>
                            
                        </details>
                    </div>
                
                    <div class="item" data-source-file="intro_code.asm">
                        <h4 id="source_intro_code_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm">	<span class="hljs-built_in">include</span> once <span class="hljs-string">"../linking/src/demosystem/common.asm"</span> 
	<span class="hljs-built_in">include</span> once <span class="hljs-string">"../linking/src/demosystem/public.asm"</span> 
LOAD_THE_LOADER <span class="hljs-built_in">equ</span> false
SELECTED_CRTC   <span class="hljs-built_in">equ</span> <span class="hljs-number">1</span>
<span class="hljs-comment">; </span>
HEIGHT_HBL_FLASH <span class="hljs-built_in">equ</span> <span class="hljs-number">48</span>
HEIGHT_HBL_MAIN <span class="hljs-built_in">equ</span> <span class="hljs-number">48</span>+<span class="hljs-number">4</span>-<span class="hljs-number">1</span>+<span class="hljs-number">10</span>-<span class="hljs-number">3</span>-<span class="hljs-number">12</span>
HEIGHT_HBL_HORNY <span class="hljs-built_in">equ</span> <span class="hljs-number">22</span>
HEIGHT_HBL_HORNY2 <span class="hljs-built_in">equ</span> <span class="hljs-number">10</span>+<span class="hljs-number">4</span>
HEIGHT_HBL_HORNY3 <span class="hljs-built_in">equ</span> <span class="hljs-number">6</span>+<span class="hljs-number">1</span>
HEIGHT_HBL_BYTES <span class="hljs-built_in">equ</span> <span class="hljs-number">30</span>+<span class="hljs-number">6</span>-<span class="hljs-number">1</span>-<span class="hljs-number">1</span>
HEIGHT_HBL_BYTES2 <span class="hljs-built_in">equ</span> <span class="hljs-number">6</span>-<span class="hljs-number">1</span>
<span class="hljs-comment">; all is displayed in &4000 page</span>
<span class="hljs-comment">;</span>
SPRITE_VIDE <span class="hljs-built_in">equ</span> <span class="hljs-number">&4000</span>
MODE2 <span class="hljs-built_in">equ</span> <span class="hljs-number">&8E</span>
MODE0 <span class="hljs-built_in">equ</span> <span class="hljs-number">&8C</span>
R1 				<span class="hljs-built_in">equ</span> <span class="hljs-number">48</span>
R2 				<span class="hljs-built_in">equ</span>  <span class="hljs-number">&32</span> <span class="hljs-comment">; &32 for fullscreen</span>
R2_LOGO         <span class="hljs-built_in">equ</span> <span class="hljs-number">&2e</span>-<span class="hljs-number">2</span>-<span class="hljs-number">1</span>
SCREEN_WIDTH 	<span class="hljs-built_in">equ</span> R1*<span class="hljs-number">2</span>
TABLINE_96 		<span class="hljs-built_in">equ</span> END_CODE
TABLINE_80 		<span class="hljs-built_in">equ</span> END_CODE+<span class="hljs-number">&200</span>
SPRWIDTH 		<span class="hljs-built_in">equ</span> <span class="hljs-number">16</span>
SPRHEIGHT       <span class="hljs-built_in">equ</span> <span class="hljs-number">48</span>
WIDTH_OVERS     <span class="hljs-built_in">equ</span> <span class="hljs-number">34</span>
<span class="hljs-comment">;</span>

BORDER_TOP		<span class="hljs-built_in">equ</span> <span class="hljs-number">93</span><span class="hljs-comment">; 68  ;69 ;&5D</span>
BORDER_BOTTOM 	<span class="hljs-built_in">equ</span> <span class="hljs-number">88</span>   <span class="hljs-comment">;  71 ; </span>
<span class="hljs-comment">;</span>
INK0 		<span class="hljs-built_in">equ</span> <span class="hljs-number">84</span> <span class="hljs-comment">; 88 </span>
INK1 		<span class="hljs-built_in">equ</span> BORDER_BOTTOM
INK1_FLASH  <span class="hljs-built_in">equ</span> <span class="hljs-number">95</span> <span class="hljs-comment">; 95</span>
<span class="hljs-comment">;INK15       equ 92</span>
BLACK 		<span class="hljs-built_in">equ</span> <span class="hljs-number">84</span>
<span class="hljs-comment">;</span>
COLOR1_BYTES_LOGO <span class="hljs-built_in">equ</span> <span class="hljs-number">91</span>

RASTER_TOP_BOTTOM <span class="hljs-built_in">equ</span> BORDER_TOP*<span class="hljs-number">256</span>+BORDER_BOTTOM <span class="hljs-comment">; &585D</span>
RASTER_BOTTOM_TOP <span class="hljs-built_in">equ</span> BORDER_BOTTOM*<span class="hljs-number">256</span>+BORDER_TOP <span class="hljs-comment">; &5D58</span>
RASTER_TOP_TOP    <span class="hljs-built_in">equ</span> BORDER_TOP*<span class="hljs-number">256</span>+BORDER_TOP <span class="hljs-comment">; &5858</span>

BK_MUSIC <span class="hljs-built_in">equ</span> <span class="hljs-number">&c6</span>
<span class="hljs-comment">;	</span>
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">nolist</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">; code start in &8000</span>
<span class="hljs-comment">; </span>
	<span class="hljs-keyword">di</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&c9fb</span>
	<span class="hljs-keyword">ld</span> (<span class="hljs-number">&0038</span>),<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">im</span> <span class="hljs-number">1</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>, <span class="hljs-number">&c000</span>
<span class="hljs-comment">; </span>
 <span class="hljs-comment">; breakpoint</span>
<span class="hljs-comment">;</span>
   <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">i</span>

   <span class="hljs-keyword">cp</span> <span class="hljs-number">3</span>
   <span class="hljs-keyword">jr</span> z,CRTC_3_4_ADAPTATION
   <span class="hljs-keyword">cp</span> <span class="hljs-number">4</span>
   <span class="hljs-keyword">jr</span> nz,START_AFTER_CRTC_ADAPTATION
<span class="hljs-comment">; 168 lines  </span>
CRTC_3_4_ADAPTATION
<span class="hljs-comment">;</span>
<span class="hljs-comment">; still useful?</span>
<span class="hljs-comment">; </span>
     <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">29</span>
     <span class="hljs-keyword">ld</span> (NB_BGD_LINE1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span> 
     <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">47</span>-<span class="hljs-number">30</span>
     <span class="hljs-keyword">ld</span> (NB_BGD_LINE2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span> 
     <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">61</span>+<span class="hljs-number">1</span>-<span class="hljs-number">30</span>
     <span class="hljs-keyword">ld</span> (NB_BGD_LINE3+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>


  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&5aDD</span>
 <span class="hljs-keyword">ld</span> (HIDE_CORRUPTED_BYTE1+<span class="hljs-number">1</span>),<span class="hljs-variable">HL</span>     <span class="hljs-comment">;  ld hl,&5aDD</span>
  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&4d1d</span>
 <span class="hljs-keyword">ld</span> (HIDE_CORRUPTED_BYTE2+<span class="hljs-number">1</span>),<span class="hljs-variable">HL</span> 

  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&4000</span>
  <span class="hljs-keyword">ld</span> (HIDE_CORRUPTED_BYTE3+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span> 


START_AFTER_CRTC_ADAPTATION
	<span class="hljs-keyword">call</span> generate_line_fullscreen
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&c000</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,TABLINE_80+<span class="hljs-number">2</span>
	<span class="hljs-keyword">ld</span> (TABLINE_80),<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">510</span>
	<span class="hljs-keyword">LDIR</span>

	<span class="hljs-keyword">call</span> generate_line_standart
<span class="hljs-comment">;	</span>
<span class="hljs-comment">;</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f00</span>+BK_MUSIC
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;	</span>
<span class="hljs-comment">;	di			; coz FapInit makes heavy use of SP</span>
 	   <span class="hljs-keyword">ld</span>	<span class="hljs-variable">a</span>,HiFapBuff 	<span class="hljs-comment">; High byte of the decrunch buffer address.</span>
 	   <span class="hljs-keyword">ld</span>	<span class="hljs-variable">bc</span>, FapPlay     <span class="hljs-comment">; Address of the player binary.</span>
 	   <span class="hljs-keyword">ld</span>	<span class="hljs-variable">de</span>, ReturnAddr  <span class="hljs-comment">; Address to jump after playing a song frame.</span>
 	   <span class="hljs-keyword">ld</span>	<span class="hljs-variable">hl</span>, FapData     <span class="hljs-comment">; Address of song data.</span>
 	   <span class="hljs-keyword">call</span>    FapInit

	<span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#7FC0</span>
	<span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>

 	   <span class="hljs-keyword">ei</span>
<span class="hljs-comment">;</span>
	DS_SECURE_WAIT_VSYNC()

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc07</span>		
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bd00</span>+<span class="hljs-number">&1E</span>-<span class="hljs-number">2</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc01</span>		
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bd00</span>+<span class="hljs-number">40</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc02</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bd00</span>+<span class="hljs-number">&2e</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc06</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bd00</span>+<span class="hljs-number">21</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>


<span class="hljs-comment">;</span>
PREPARE_FLASH_SCREENS

            <span class="hljs-keyword">call</span> DISPLAY_BACKGROUND1 <span class="hljs-comment">; _FLASH</span>
			<span class="hljs-keyword">call</span> DISPLAY_BACKGROUND2
			<span class="hljs-keyword">call</span> DISPLAY_BACKGROUND3
			<span class="hljs-keyword">call</span> DISPLAY_BACKGROUND4
			<span class="hljs-keyword">call</span> DISPLAY_BACKGROUND5
			<span class="hljs-keyword">call</span> DISPLAY_BACKGROUND6

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96+<span class="hljs-number">120</span>
	        <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_HL
	        <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">30</span>-<span class="hljs-number">5</span>
			<span class="hljs-keyword">call</span> DISPLAY_SPRITE_SHORT

            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96+<span class="hljs-number">120</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_LR
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">50</span>+<span class="hljs-number">2</span>+<span class="hljs-number">2</span>
	        <span class="hljs-keyword">call</span> DISPLAY_SPRITE_SHORT

            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96+<span class="hljs-number">240</span>-<span class="hljs-number">16</span>+<span class="hljs-number">8</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_B <span class="hljs-comment">; SPRITELL</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">40</span>
	        <span class="hljs-keyword">call</span> DISPLAY_SPRITE_SHORT
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,HBL_ZONE_02
            <span class="hljs-keyword">ld</span> (ROUTINE2+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
	        <span class="hljs-keyword">ld</span> (pokborder+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>

SEQUENCE_SPRITES_FLASH
<span class="hljs-comment">;</span>
<span class="hljs-comment">; FRAME 1 = HBL for MODE 2 / MODE 0</span>
<span class="hljs-comment">;</span>
STATIC_FLASH_FRAME_1
            DS_SECURE_WAIT_VSYNC()
    <span class="hljs-comment">;</span>
 		
        	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_flash1
			<span class="hljs-keyword">call</span> put_crtc
			<span class="hljs-keyword">ei</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
		    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>	
	       	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_FLASH1
	     	<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP
           
            <span class="hljs-keyword">halt</span>
            <span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">36</span>-<span class="hljs-number">2</span>-<span class="hljs-number">1</span>
WAITF1   	<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span> <span class="hljs-comment">; 60 Nops</span>
      		<span class="hljs-keyword">djnz</span> WAITF1 
            <span class="hljs-keyword">call</span> MAIN_HBL_ZONE
<span class="hljs-comment">;       </span>
<span class="hljs-comment">; FRAME 2 = MODE 1 only</span>
<span class="hljs-comment">;</span>
STATIC_FLASH_FRAME_2
            DS_SECURE_WAIT_VSYNC()
<span class="hljs-comment">;</span>
        	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_flash2
			<span class="hljs-keyword">call</span> put_crtc
			<span class="hljs-keyword">ei</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
            <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_FLASH2
	     	<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">halt</span>
            <span class="hljs-keyword">halt</span>
<span class="hljs-comment">;</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">36</span>-<span class="hljs-number">2</span>
WAITF2   	<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span> <span class="hljs-comment">; 60 Nops</span>
      		<span class="hljs-keyword">djnz</span> WAITF2
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8d</span>
            <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0100</span>+INK1_FLASH
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
<span class="hljs-comment">;			</span>
<span class="hljs-comment">; unsused, was useful for the first version without HBL</span>
POK_MODE   <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
<span class="hljs-comment">;          out (c),c</span>
<span class="hljs-comment">;</span>
ALTERNATE_MODE_SPRITE
TIMER_FLASH       <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">1</span>
                  <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
				  <span class="hljs-keyword">ld</span> (TIMER_FLASH+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
				  <span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
				  <span class="hljs-keyword">jr</span> nz,END_SCENARIO

NEXT_SCENARIO_POSITION

POS_TABLE_FLASH    <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLE_FLASHING_MOVES
                    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
					<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
					<span class="hljs-keyword">jr</span> nz,SAME_SCENARIO
RESET_SCENARIO
                 <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLE_FLASHING_MOVES
				 <span class="hljs-keyword">ld</span> (POS_TABLE_FLASH+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
                 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
SAME_SCENARIO     
                 <span class="hljs-keyword">ld</span> (POK_MODE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
                 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
                 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>) 
				 <span class="hljs-keyword">ld</span> (TIMER_FLASH+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
                 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,(<span class="hljs-variable">hl</span>)
				 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,(<span class="hljs-variable">hl</span>)
				 <span class="hljs-keyword">ld</span> (POK_SPRITE_LEFT+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
                 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,(<span class="hljs-variable">hl</span>)
				 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,(<span class="hljs-variable">hl</span>)
				 <span class="hljs-keyword">ld</span> (POK_SPRITE_RIGHT+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
                 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
				 <span class="hljs-keyword">ld</span> (POS_SPRITE_LEFT+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
				 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
				 <span class="hljs-keyword">ld</span> (POS_SPRITE_RIGHT+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
				 <span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
				 <span class="hljs-keyword">ld</span> (POS_TABLE_FLASH+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>

END_SCENARIO
<span class="hljs-comment">;</span>
<span class="hljs-comment">; displays H</span>
                        <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96+<span class="hljs-number">120</span>+<span class="hljs-number">2</span>-<span class="hljs-number">2</span>
POK_SPRITE_LEFT	        <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_HL
POS_SPRITE_LEFT	        <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">30</span>
	                     <span class="hljs-keyword">call</span> DISPLAY_SPRITE_SHORT
<span class="hljs-comment">; displays L</span>
                         <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96+<span class="hljs-number">120</span>-<span class="hljs-number">2</span>
POK_SPRITE_RIGHT	     <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&4000</span> <span class="hljs-comment">; SPRITELL</span>
POS_SPRITE_RIGHT	     <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">50</span>
	                     <span class="hljs-keyword">call</span> DISPLAY_SPRITE_SHORT


TIMER_SPRITES_FLASH <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&150</span> <span class="hljs-comment">; +200</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_SPRITES_FLASH+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
			<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
			<span class="hljs-keyword">jp</span> nz,STATIC_FLASH_FRAME_1
<span class="hljs-comment">;</span>
PREPARE_MOVING_SRITES
<span class="hljs-comment">; </span>
   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,LINE_HBL_MODE1
   <span class="hljs-keyword">ld</span> (POK_MIDDLE_LINE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>

   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,LINE_MODE2_PEN1_MODE0_PEN14 
   <span class="hljs-keyword">ld</span> (POK_BOTTOM_LINE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">; </span>
<span class="hljs-comment">; displays background  </span>
<span class="hljs-comment">; displays B character</span>
<span class="hljs-comment">;</span>
TRANSITION1
            DS_SECURE_WAIT_VSYNC()

         	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_flash1
			<span class="hljs-keyword">call</span> put_crtc
			<span class="hljs-keyword">ei</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
		    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>	
	       	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_FLASH1
	     	<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

SCENARIO_TIMER_TRANSITION1 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">1</span>                  <span class="hljs-comment">; 2</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>                   <span class="hljs-comment">; 1</span>
				<span class="hljs-keyword">ld</span> (SCENARIO_TIMER_TRANSITION1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span> <span class="hljs-comment">; 4</span>
				<span class="hljs-keyword">jp</span> nz,LEAVE_SCENARIO_MANAGEMENT_TRANS1


NEW_SCENARIO1
POS_TAB_SCE1 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_SCENARIO_TRANSITION1
	   		 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	  		  <span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
		    <span class="hljs-keyword">jr</span> nz,PAS_FIN_TAB1
<span class="hljs-comment">;</span>
               <span class="hljs-keyword">jr</span> SEQUENCE_HBL_MOVING_SPRITES
PAS_FIN_TAB1

	    <span class="hljs-keyword">ld</span> (SCENARIO_TIMER_TRANSITION1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>


		<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,(<span class="hljs-variable">hl</span>)
	    <span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	 	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,(<span class="hljs-variable">hl</span>)
		<span class="hljs-keyword">ld</span> (ROUTINE_TRANSITION1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>

		<span class="hljs-keyword">ld</span> (POS_TAB_SCE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
LEAVE_SCENARIO_MANAGEMENT_TRANS1 

ROUTINE_TRANSITION1 <span class="hljs-keyword">call</span> DISPLAY_BACKGROUND1

       <span class="hljs-keyword">jp</span> TRANSITION1
<span class="hljs-comment">;</span>

DISPLAY_B_TRANSITION1
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96+<span class="hljs-number">120</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_B
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">40</span>
	<span class="hljs-keyword">call</span> DISPLAY_SPRITE_SHORT

    <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,HBL_ZONE_012
    <span class="hljs-keyword">ld</span> (ROUTINE2+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,BORDER_BOTTOM
	<span class="hljs-keyword">ld</span> (pokborder+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ret</span>

<span class="hljs-comment">; ****************************************************************************************************</span>
SEQUENCE_HBL_MOVING_SPRITES

            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,HBL_ZONE_012
            <span class="hljs-keyword">ld</span> (ROUTINE2+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
MAIN_LOOP
	DS_SECURE_WAIT_VSYNC()
<span class="hljs-comment">;</span>
   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&5aDD</span>
   <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-number">0</span>
   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&4d1d</span>
   <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-number">0</span>

    <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_moving
	<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;		</span>
	<span class="hljs-keyword">ei</span>
<span class="hljs-comment">;</span>
MODE_TOP <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8C</span>
		<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>	
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_MAIN
		<span class="hljs-keyword">call</span> COLOR
<span class="hljs-comment">;	</span>
POK_RASTER0	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&010f</span>
POK_RASTER0A <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_BOTTOM_TOP <span class="hljs-comment">; &5D58</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&010f</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_TOP_TOP <span class="hljs-comment">; &5858</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>
<span class="hljs-comment">; *************************************</span>
	    	<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-keyword">call</span> SCENARIO

<span class="hljs-comment">;			</span>
ROUTINE1   <span class="hljs-keyword">call</span> DISPLAY_MOVING_SPRITE1

OFFSET_MIDDLE <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&1000</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc0c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-comment">;		dec c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
			<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
		<span class="hljs-comment">;	dec c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>	


		<span class="hljs-keyword">halt</span>
<span class="hljs-comment">;</span>
        <span class="hljs-keyword">call</span> MAIN_HBL_ZONE
<span class="hljs-comment">;</span>
PART       <span class="hljs-keyword">call</span> STATIC_SPRITES
	    	<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">15</span>-<span class="hljs-number">1</span> 
WAIT3     <span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span> <span class="hljs-comment">; 60 Nops</span>
      	 <span class="hljs-keyword">djnz</span> WAIT3


ROUTINE3 <span class="hljs-keyword">call</span> DISPLAY_MOVING_SPRITE2


		<span class="hljs-keyword">EI</span>

   <span class="hljs-keyword">call</span> SPACEKEY_TEST

<span class="hljs-comment">;</span>
		<span class="hljs-keyword">JP</span> NC,EXIT_PART            		

	<span class="hljs-built_in">include</span> once <span class="hljs-string">"../linking/src/limited_duration.asm"</span>
	CHECK_IF_PART_IS_OVER()
	<span class="hljs-keyword">jp</span> z, EXIT_PART
<span class="hljs-comment">;</span>
TIMER_ROTATION <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&260</span>+<span class="hljs-number">&100</span>+<span class="hljs-number">80</span>+<span class="hljs-number">40</span>+<span class="hljs-number">80</span>+<span class="hljs-number">160</span><span class="hljs-comment">; +200</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_ROTATION+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
	     		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
		     	<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
                <span class="hljs-keyword">jp</span> nz,MAIN_LOOP


SEQUENCE_WORDS_DISPLAY
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&8d8c</span>
			<span class="hljs-keyword">ld</span> (POK_M2X+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&7f8e</span>
			<span class="hljs-keyword">ld</span> (POK_M1X+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;</span>
<span class="hljs-comment">; displays H,B, L</span>
                         <span class="hljs-keyword">call</span> DISPLAY_H_LOGO
<span class="hljs-comment">;						</span>
                         <span class="hljs-keyword">call</span> DISPLAY_B_LOGO 

						  <span class="hljs-keyword">call</span> DISPLAY_L_LOGO 

	<span class="hljs-comment">;		breakpoint</span>
MAIN_WAIT_DISPLAY
	
			DS_SECURE_WAIT_VSYNC()
<span class="hljs-comment">;			</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;					</span>
			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAIT_WAIT		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT_WAIT
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO
			<span class="hljs-keyword">ei</span>
           <span class="hljs-keyword">call</span> RASTERS_LOVERS	
TIMER_WAIT      <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&160</span> <span class="hljs-comment">; +200</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_WAIT+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
	     		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
		     	<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
                <span class="hljs-keyword">jp</span> nz,MAIN_WAIT_DISPLAY


MAIN_ORNY_DISPLAY
	
			DS_SECURE_WAIT_VSYNC()
 <span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;					</span>
			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAIT1O		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT1O
<span class="hljs-comment">;  </span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO

            <span class="hljs-keyword">ei</span>
			  <span class="hljs-keyword">call</span> RASTERS_LOVERS	
            <span class="hljs-keyword">call</span> DISPLAY_ORNY

<span class="hljs-comment">;</span>


TIMER_ORNY      <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&120</span> <span class="hljs-comment">; +200</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_ORNY+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
	     		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
		     	<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
                <span class="hljs-keyword">jp</span> nz,MAIN_ORNY_DISPLAY

MAIN_YTES_DISPLAY
	
			DS_SECURE_WAIT_VSYNC()
 <span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;					</span>
			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAIT1Y		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT1Y
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO
            <span class="hljs-keyword">ei</span>
			  
		   <span class="hljs-keyword">call</span> RASTERS_LOVERS	

           <span class="hljs-keyword">call</span> DISPLAY_YTES



TIMER_YTES      <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&120</span> <span class="hljs-comment">; +200</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_YTES+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
	     		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
		     	<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
                <span class="hljs-keyword">jp</span> nz,MAIN_YTES_DISPLAY
<span class="hljs-comment">;</span>
<span class="hljs-comment">; OVERS is displayed with 3 routines!!!</span>
<span class="hljs-comment">;</span>
MAIN_OVERS_DISPLAY1
	
			DS_SECURE_WAIT_VSYNC()
 <span class="hljs-comment">;</span>
 <span class="hljs-comment">;;  breakpoint</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;					</span>
			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAIT1OV		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT1OV
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO

            <span class="hljs-keyword">ei</span>
			  <span class="hljs-keyword">call</span> RASTERS_LOVERS	
			<span class="hljs-keyword">halt</span>
     <span class="hljs-comment">;       halt</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">8</span>+<span class="hljs-number">6</span>+<span class="hljs-number">1</span>+<span class="hljs-number">1</span>+<span class="hljs-number">13</span>
WAIT1OV2		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT1OV2

<span class="hljs-comment">; lOVERS</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,WIDTH_OVERS 
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">45</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">21</span>-<span class="hljs-number">8</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,OVERS
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">220</span>+<span class="hljs-number">40</span>+<span class="hljs-number">12</span>+<span class="hljs-number">2</span>+<span class="hljs-number">4</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES

MAIN_OVERS_DISPLAY2
	
			DS_SECURE_WAIT_VSYNC()
 <span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">; overs2	</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">10</span>+<span class="hljs-number">2</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,OVERS+(<span class="hljs-number">13</span>*WIDTH_OVERS)
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">220</span>+<span class="hljs-number">40</span>+<span class="hljs-number">12</span>+<span class="hljs-number">26</span>+<span class="hljs-number">2</span>+<span class="hljs-number">4</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
 
			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAIT1OV3		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT1OV3
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO

            <span class="hljs-keyword">ei</span>
			  <span class="hljs-keyword">call</span> RASTERS_LOVERS	
<span class="hljs-comment">; overs3</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">58</span>-<span class="hljs-number">21</span>-<span class="hljs-number">10</span>-<span class="hljs-number">1</span>-<span class="hljs-number">2</span>+<span class="hljs-number">6</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,OVERS+(<span class="hljs-number">25</span>*WIDTH_OVERS)
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">220</span>+<span class="hljs-number">40</span>+<span class="hljs-number">12</span>+<span class="hljs-number">26</span>+<span class="hljs-number">24</span>+<span class="hljs-number">2</span>+<span class="hljs-number">4</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES

TIMER_OVERS <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&160</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_OVERS+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
			<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
			<span class="hljs-keyword">jp</span> nz,MAIN_OVERS_DISPLAY2


SEQUENCE_LOGO_DISPLAY

MAIN_LOGO_DISPLAY_RAIN
	
			DS_SECURE_WAIT_VSYNC()
 <span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;					</span>
			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAIT1		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAIT1
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO
           	<span class="hljs-keyword">ei</span>

         
          <span class="hljs-keyword">call</span> RASTERS_LOVERS	
	
<span class="hljs-comment">;     </span>

            <span class="hljs-keyword">di</span>
	        <span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			  <span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			 <span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			 <span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			<span class="hljs-keyword">call</span> RAIN_CODE
			 <span class="hljs-keyword">call</span> RAIN_CODE
		
			<span class="hljs-keyword">ei</span>
		
          <span class="hljs-keyword">call</span> SPACEKEY_TEST

		<span class="hljs-keyword">JP</span> NC,EXIT_PART 

TIMER_LOGO_DISPLAY <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&200</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_LOGO_DISPLAY+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
			<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
			<span class="hljs-keyword">jp</span> nz,MAIN_LOGO_DISPLAY_RAIN
<span class="hljs-comment">;</span>
<span class="hljs-comment">; breakpoint</span>
<span class="hljs-comment">; A- TO REMOVE WHEN SCREEN IS OK</span>
<span class="hljs-comment">; displays H,L</span>
                   <span class="hljs-comment">;      call DISPLAY_H_LOGO</span>
<span class="hljs-comment">;						</span>
                    <span class="hljs-comment">;     call DISPLAY_B_LOGO </span>
  <span class="hljs-comment">; call DISPLAY_ORNY</span>
  <span class="hljs-comment">; call DISPLAY_YTES</span>
<span class="hljs-comment">;   </span>
<span class="hljs-comment">; Z - TO REMOVE WHEN SCREEN IS OK   </span>
<span class="hljs-comment">;</span>

<span class="hljs-comment">;		breakpoint</span>


MAIN_ANIMATION_HEART
	
			DS_SECURE_WAIT_VSYNC()
 <span class="hljs-comment">;</span>
 <span class="hljs-comment">; breakpoint</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_logo
			<span class="hljs-keyword">call</span> put_crtc
<span class="hljs-comment">;	</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f10</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">84</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8c</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>

            <span class="hljs-keyword">call</span> SCENARIO_SPR  

			<span class="hljs-keyword">halt</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">32</span>
WAITH		<span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span><span class="hljs-comment">;</span>
			<span class="hljs-keyword">djnz</span> WAITH
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TCOL_LOGO
			<span class="hljs-keyword">call</span> COLOR
			<span class="hljs-keyword">call</span> PLAY_MUSIC_FAP

			<span class="hljs-built_in">defs</span> <span class="hljs-number">&16</span>-<span class="hljs-number">14</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">call</span> HBL_ZONE_LOGO
           	<span class="hljs-keyword">ei</span>

        <span class="hljs-keyword">call</span> RASTERS_LOVERS	
<span class="hljs-comment">;   </span>
ROUTINE_DISPLAY_HEART <span class="hljs-keyword">call</span> ROUTINE_DISPLAY_HEART
 
          <span class="hljs-keyword">call</span> SPACEKEY_TEST

		<span class="hljs-keyword">JP</span> NC,EXIT_PART 

TIMER_ANIMATION_HEART <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&260</span>+<span class="hljs-number">&260</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (TIMER_ANIMATION_HEART+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>	
<span class="hljs-comment">;		</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">h</span>
			<span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
			<span class="hljs-keyword">jp</span> nz,MAIN_ANIMATION_HEART
      
		<span class="hljs-keyword">jp</span> EXIT_PART



DISPLAY_HEART6
      <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,COEUR6
	  <span class="hljs-keyword">JR</span> DISPLAY_H56

DISPLAY_HEART5
       <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,COEUR5
	   <span class="hljs-keyword">JR</span> DISPLAY_H56

DISPLAY_HEART4
       <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,COEUR4
DISPLAY_H4
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">12</span> 
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">43</span>+<span class="hljs-number">1</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">48</span>-<span class="hljs-number">4</span>-<span class="hljs-number">5</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">220</span>+<span class="hljs-number">40</span>+<span class="hljs-number">12</span>+<span class="hljs-number">12</span>+<span class="hljs-number">2</span>+<span class="hljs-number">8</span>-<span class="hljs-number">6</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>	   
<span class="hljs-comment">;</span>
DISPLAY_H56
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">15</span> 
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">43</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">48</span>-<span class="hljs-number">4</span>+<span class="hljs-number">1</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">220</span>+<span class="hljs-number">40</span>+<span class="hljs-number">12</span>+<span class="hljs-number">12</span>+<span class="hljs-number">2</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>
DISPLAY_HEART3
      <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,COEUR3
	  <span class="hljs-keyword">JR</span> DISPLAY_H123

DISPLAY_HEART2
       <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,COEUR2
	   <span class="hljs-keyword">JR</span> DISPLAY_H123

DISPLAY_HEART1
       <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,COEUR1
<span class="hljs-comment">;</span>
DISPLAY_H123
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">11</span> 
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">43</span>+<span class="hljs-number">1</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>

    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">48</span>-<span class="hljs-number">4</span>-<span class="hljs-number">5</span>+<span class="hljs-number">3</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">220</span>+<span class="hljs-number">40</span>+<span class="hljs-number">12</span>+<span class="hljs-number">12</span>+<span class="hljs-number">2</span>+<span class="hljs-number">8</span>-<span class="hljs-number">6</span>+<span class="hljs-number">6</span>-<span class="hljs-number">2</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;</span>
RASTERS_LOVERS
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f00</span>+<span class="hljs-number">7</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&55</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f00</span>+<span class="hljs-number">9</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">69</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>		
		    <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f00</span>+<span class="hljs-number">1</span> 
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&4d</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>	
			<span class="hljs-keyword">ret</span>

SPACEKEY_TEST

	    <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F40E</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F6C0</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
<span class="hljs-comment">;  XOR	A</span>
<span class="hljs-comment">;  OUT	(C),A</span>
  		<span class="hljs-built_in">defb</span> <span class="hljs-number">&ed</span>,<span class="hljs-number">&71</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F792</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F645</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">B</span>,<span class="hljs-number">#F4</span>
        <span class="hljs-keyword">IN</span>	<span class="hljs-variable">A</span>,(<span class="hljs-variable">C</span>)
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F782</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
<span class="hljs-comment">;  LD	BC,#F600</span>
<span class="hljs-comment">;  OUT	(C),C</span>
		<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">&ed</span>,<span class="hljs-number">&71</span>
<span class="hljs-comment">;		</span>
        <span class="hljs-keyword">RLA</span>	
		<span class="hljs-keyword">ret</span>

<span class="hljs-comment">;</span>

MAIN_HBL_ZONE
           <span class="hljs-built_in">defs</span> <span class="hljs-number">64</span>-<span class="hljs-number">5</span>,<span class="hljs-number">0</span>
			<span class="hljs-built_in">defs</span> <span class="hljs-number">3</span>,<span class="hljs-number">0</span>
	 		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">7</span>
WAIT   		  <span class="hljs-built_in">defs</span> <span class="hljs-number">60</span>,<span class="hljs-number">0</span> <span class="hljs-comment">; 60 Nops</span>
      		 <span class="hljs-keyword">djnz</span> WAIT 
			
<span class="hljs-comment">;</span>
<span class="hljs-comment">; ADAPTATION PLUS avec -1 </span>

       <span class="hljs-keyword">xor</span> <span class="hljs-variable">a</span>
HIDE_CORRUPTED_BYTE1       <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&5504</span> <span class="hljs-comment">; &5aDD</span>
       <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>
  	   
HIDE_CORRUPTED_BYTE2        <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&5504</span>
       <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>

       <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span> <span class="hljs-comment">; a =&ff</span>

HIDE_CORRUPTED_BYTE3        <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&5add</span>
       <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>

ROUTINE2 	<span class="hljs-keyword">call</span> HBL_ZONE_012		


MODE_BOTTOM <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>

pokborder		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&1000</span>+BORDER_BOTTOM
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span> 
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>			
<span class="hljs-comment">;			</span>
            <span class="hljs-keyword">ret</span>   	


put_crtc
	<span class="hljs-keyword">LD</span>	<span class="hljs-variable">bc</span>,<span class="hljs-number">#bd00</span>+<span class="hljs-number">7</span>
reg_crtc
	<span class="hljs-keyword">OUTI</span>	
	<span class="hljs-keyword">INC</span>	<span class="hljs-variable">b</span>
	<span class="hljs-keyword">INC</span>	<span class="hljs-variable">b</span>
	<span class="hljs-keyword">OUTI</span>	
	<span class="hljs-keyword">DEC</span>	<span class="hljs-variable">c</span>
	<span class="hljs-keyword">JR</span>	nz,reg_crtc
	<span class="hljs-keyword">RET</span>	
<span class="hljs-comment">;</span>
ini_crtc_main	<span class="hljs-built_in">DB</span> 	<span class="hljs-number">1</span>,R1 
ini_crtc_load   <span class="hljs-built_in">DB</span>	<span class="hljs-number">2</span>,R2
		  	<span class="hljs-built_in">DB</span>  <span class="hljs-number">6</span>,<span class="hljs-number">21</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">7</span>,<span class="hljs-number">&1E</span>-<span class="hljs-number">2</span>
		    <span class="hljs-built_in">DB</span>	<span class="hljs-number">9</span>,<span class="hljs-number">7</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">12</span>,<span class="hljs-number">&30</span>
            <span class="hljs-built_in">DB</span>  <span class="hljs-number">13</span>,<span class="hljs-number">&00</span>
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>,<span class="hljs-number">0</span>

ini_crtc_moving	<span class="hljs-built_in">DB</span> 	<span class="hljs-number">1</span>,R1 
		       <span class="hljs-built_in">DB</span>	<span class="hljs-number">2</span>,R2
		  	<span class="hljs-built_in">DB</span>  <span class="hljs-number">6</span>,<span class="hljs-number">21</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">7</span>,<span class="hljs-number">&1E</span>-<span class="hljs-number">2</span>
		    <span class="hljs-built_in">DB</span>	<span class="hljs-number">9</span>,<span class="hljs-number">7</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">12</span>,<span class="hljs-number">&10</span>
            <span class="hljs-built_in">DB</span>  <span class="hljs-number">13</span>,<span class="hljs-number">&00</span>

ini_crtc_flash1 	<span class="hljs-built_in">DB</span> 	<span class="hljs-number">1</span>,R1 
		       <span class="hljs-built_in">DB</span>	<span class="hljs-number">2</span>,R2
		  	<span class="hljs-built_in">DB</span>  <span class="hljs-number">6</span>,<span class="hljs-number">14</span>-<span class="hljs-number">1</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">7</span>,<span class="hljs-number">&1E</span>-<span class="hljs-number">2</span>
		    <span class="hljs-built_in">DB</span>	<span class="hljs-number">9</span>,<span class="hljs-number">7</span>
		 <span class="hljs-comment">;   defb 3,&88</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">12</span>,<span class="hljs-number">&10</span>
            <span class="hljs-built_in">DB</span>  <span class="hljs-number">13</span>,<span class="hljs-number">&00</span>

ini_crtc_flash2	<span class="hljs-built_in">DB</span> 	<span class="hljs-number">1</span>,R1 
           <span class="hljs-comment">; defb 3,&88</span>
		     <span class="hljs-built_in">DB</span>	<span class="hljs-number">2</span>,R2
		  	<span class="hljs-built_in">DB</span>  <span class="hljs-number">6</span>,<span class="hljs-number">14</span>-<span class="hljs-number">1</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">7</span>,<span class="hljs-number">&1E</span>-<span class="hljs-number">2</span>
		    <span class="hljs-built_in">DB</span>	<span class="hljs-number">9</span>,<span class="hljs-number">7</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">12</span>,<span class="hljs-number">&11</span>  <span class="hljs-comment">; 12th line</span>
            <span class="hljs-built_in">DB</span>  <span class="hljs-number">13</span>,<span class="hljs-number">&80</span>-<span class="hljs-number">&30</span>
<span class="hljs-comment">;</span>
ini_crtc_logo	<span class="hljs-built_in">DB</span> 	<span class="hljs-number">1</span>,<span class="hljs-number">40</span>
		       <span class="hljs-built_in">DB</span>	<span class="hljs-number">2</span>,R2_LOGO
		  	<span class="hljs-built_in">DB</span>  <span class="hljs-number">6</span>,<span class="hljs-number">25</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">7</span>,<span class="hljs-number">&1E</span>-<span class="hljs-number">2</span>-<span class="hljs-number">2</span>
		    <span class="hljs-built_in">DB</span>	<span class="hljs-number">9</span>,<span class="hljs-number">7</span>
			<span class="hljs-built_in">DB</span>  <span class="hljs-number">12</span>,<span class="hljs-number">&30</span>
            <span class="hljs-built_in">DB</span>  <span class="hljs-number">13</span>,<span class="hljs-number">&00</span>

PLAY_MUSIC_FAP	
<span class="hljs-comment">; 620 NOPS for INTRO</span>
		<span class="hljs-keyword">di</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f00</span>+BK_MUSIC
		<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
    	<span class="hljs-keyword">ld</span>	(RestoreSp), <span class="hljs-variable">sp</span>	<span class="hljs-comment">; Save our precious stack-pointer</span>
    	<span class="hljs-keyword">jp</span>	FapPlay		<span class="hljs-comment">; Jump into the replay-routine</span>
ReturnAddr:		<span class="hljs-comment">; Return address the replay-routine will jump back to</span>
RestoreSp <span class="hljs-built_in">equ</span> $+<span class="hljs-number">1</span>

    	<span class="hljs-keyword">ld</span>	<span class="hljs-variable">sp</span>, <span class="hljs-number">0</span>	 	<span class="hljs-comment">; Restore our precious stack-pointer</span>
        <span class="hljs-keyword">ei</span>			<span class="hljs-comment">; We may enable the maskable interrupts again</span>
  		<span class="hljs-built_in">nop</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7fc0</span>
		<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
		<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">; ******************************************************************</span>
<span class="hljs-comment">;</span>
SCENARIO
               
SCENARIO_TIMER 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">1</span>                  <span class="hljs-comment">; 2</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>                   <span class="hljs-comment">; 1</span>
				<span class="hljs-keyword">ld</span> (SCENARIO_TIMER+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span> <span class="hljs-comment">; 4</span>
				<span class="hljs-keyword">jp</span> nz,LEAVE_SCENARIO_MANAGEMENT   <span class="hljs-comment">; 2</span>
<span class="hljs-comment">;</span>
NEW_SCENARIO
POS_TAB_SCE 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_SCENARIO
	   		 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	  		  <span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
		    <span class="hljs-keyword">jr</span> nz,PAS_FIN_TAB
<span class="hljs-comment">;</span>
	 		   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_SCENARIO_LOOP
	  			  <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)	
PAS_FIN_TAB


	    <span class="hljs-keyword">ld</span> (SCENARIO_TIMER+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>


		<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,(<span class="hljs-variable">hl</span>)
	    <span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	 	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,(<span class="hljs-variable">hl</span>)
		<span class="hljs-keyword">ld</span> (PART+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>

		<span class="hljs-keyword">ld</span> (POS_TAB_SCE+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
    

LEAVE_SCENARIO_MANAGEMENT

<span class="hljs-comment">;</span>
		<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;</span>
SCENARIO_SPR
               
SCENARIO_SPR_TIMER 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">1</span>                  <span class="hljs-comment">; 2</span>
				<span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>                   <span class="hljs-comment">; 1</span>
				<span class="hljs-keyword">ld</span> (SCENARIO_SPR_TIMER+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span> <span class="hljs-comment">; 4</span>
				<span class="hljs-keyword">jp</span> nz,LEAVE_SCENARIO_SPR_MANAGEMENT   <span class="hljs-comment">; 2</span>
<span class="hljs-comment">;</span>
NEW_SCENARIO_SPR
POS_TAB_SCE_SPR 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_SCENARIO_SPR
	   		 <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	  		  <span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
		    <span class="hljs-keyword">jr</span> nz,PAS_FIN_TAB_SPR
<span class="hljs-comment">;</span>
	 		   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_SCENARIO_SPR
	  			  <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)	
      	<span class="hljs-comment">;	  jr PAS_FIN_TAB+7	</span>
<span class="hljs-comment">;</span>
PAS_FIN_TAB_SPR


	    <span class="hljs-keyword">ld</span> (SCENARIO_SPR_TIMER+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,(<span class="hljs-variable">hl</span>)
	    <span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	 	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,(<span class="hljs-variable">hl</span>)
		<span class="hljs-keyword">ld</span> (ROUTINE_DISPLAY_HEART+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
		<span class="hljs-keyword">ld</span> (POS_TAB_SCE_SPR+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
    

LEAVE_SCENARIO_SPR_MANAGEMENT

<span class="hljs-comment">;</span>
		<span class="hljs-keyword">ret</span>

<span class="hljs-comment">; </span>
generate_line_fullscreen <span class="hljs-keyword">LD</span> <span class="hljs-variable">HL</span>,<span class="hljs-number">#C000</span> 
	    <span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,<span class="hljs-number">#C000</span>+SCREEN_WIDTH 
	    <span class="hljs-keyword">LD</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">#0800</span> 
	    <span class="hljs-keyword">LD</span> <span class="hljs-variable">iy</span>,TABLINE_96
<span class="hljs-comment">;        LD ix,TABLINE_96+&100</span>
<span class="hljs-comment">; </span>
	    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">170</span> <span class="hljs-comment">; XOR A  ; a=256 lines</span>
<span class="hljs-comment">;</span>
loop    <span class="hljs-keyword">LD</span> (<span class="hljs-variable">iy</span>+<span class="hljs-number">#00</span>),<span class="hljs-variable">l</span>
        <span class="hljs-keyword">res</span> <span class="hljs-number">7</span>,<span class="hljs-variable">h</span>       <span class="hljs-comment">; all addresses in page &4000</span>
	    <span class="hljs-keyword">LD</span> (<span class="hljs-variable">iy</span>+<span class="hljs-number">#01</span>) ,<span class="hljs-variable">h</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">iyl</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">iy</span>
        <span class="hljs-keyword">set</span> <span class="hljs-number">7</span>,<span class="hljs-variable">h</span>
<span class="hljs-comment">;</span>
		<span class="hljs-keyword">ADD</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span> 
		<span class="hljs-keyword">JR</span> nc,nocarry 
<span class="hljs-comment">;	</span>
		<span class="hljs-keyword">ADD</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span> 
nocarry<span class="hljs-comment">; INC ixl</span>
<span class="hljs-comment">;	INC iyl </span>
		<span class="hljs-keyword">DEC</span> <span class="hljs-variable">a</span>
		<span class="hljs-keyword">JR</span> nz,loop 
		<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;		</span>
generate_line_standart <span class="hljs-keyword">LD</span> <span class="hljs-variable">HL</span>,<span class="hljs-number">#C000</span> 
	    <span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,<span class="hljs-number">#C000</span>+<span class="hljs-number">80</span>
	    <span class="hljs-keyword">LD</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">#0800</span> 
	    <span class="hljs-keyword">LD</span> <span class="hljs-variable">iy</span>,TABLINE_80
<span class="hljs-comment">;</span>
	    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">200</span> <span class="hljs-comment">; XOR A  ; a=256 lines</span>
<span class="hljs-comment">;</span>
.loop    <span class="hljs-keyword">LD</span> (<span class="hljs-variable">iy</span>+<span class="hljs-number">#00</span>),<span class="hljs-variable">l</span>
<span class="hljs-comment">;        res 7,h       ; all addresses in page &4000</span>
	    <span class="hljs-keyword">LD</span> (<span class="hljs-variable">iy</span>+<span class="hljs-number">#01</span>) ,<span class="hljs-variable">h</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">iyl</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">iy</span>
<span class="hljs-comment">;        set 7,h</span>
<span class="hljs-comment">;</span>
		<span class="hljs-keyword">ADD</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span> 
		<span class="hljs-keyword">JR</span> nc,.nocarry 
<span class="hljs-comment">;	</span>
		<span class="hljs-keyword">ADD</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span> 
.nocarry<span class="hljs-comment">; INC ixl</span>
<span class="hljs-comment">;	INC iyl </span>
		<span class="hljs-keyword">DEC</span> <span class="hljs-variable">a</span>
		<span class="hljs-keyword">JR</span> nz,.loop 
		<span class="hljs-keyword">ret</span>

HACK_BACK
	    <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F40E</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F6C0</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
<span class="hljs-comment">;  XOR	A</span>
<span class="hljs-comment">;  OUT	(C),A</span>
  		<span class="hljs-built_in">defb</span> <span class="hljs-number">&ed</span>,<span class="hljs-number">&71</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F792</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F645</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">B</span>,<span class="hljs-number">#F4</span>
        <span class="hljs-keyword">IN</span>	<span class="hljs-variable">A</span>,(<span class="hljs-variable">C</span>)
        <span class="hljs-keyword">LD</span>	<span class="hljs-variable">BC</span>,<span class="hljs-number">#F782</span>
        <span class="hljs-keyword">OUT</span>	(<span class="hljs-variable">C</span>),<span class="hljs-variable">C</span>
<span class="hljs-comment">;  LD	BC,#F600</span>
<span class="hljs-comment">;  OUT	(C),C</span>
		<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">&ed</span>,<span class="hljs-number">&71</span>
<span class="hljs-comment">;		</span>
        <span class="hljs-keyword">RLA</span>	
<span class="hljs-comment">;</span>
		<span class="hljs-keyword">JP</span> <span class="hljs-variable">C</span>,GO_HACK


		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,BYTEX+<span class="hljs-number">1</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">a</span>
		<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>


GO_HACK

		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;		</span>
		<span class="hljs-keyword">ld</span> (STORE_SPX+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96+<span class="hljs-number">100</span>+<span class="hljs-number">8</span>
<span class="hljs-comment">;</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">50</span>-<span class="hljs-number">3</span>
BYTEX		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">36</span>
LOOP_FILLX
	

		<span class="hljs-keyword">pop</span> <span class="hljs-variable">hl</span> 
		<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span>
		<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>	
	<span class="hljs-comment">;	exx	</span>
		<span class="hljs-keyword">djnz</span> LOOP_FILLX

STORE_SPX <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>

<span class="hljs-comment">;</span>
DISPLAY_BACKGROUND1
		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;		</span>
		<span class="hljs-keyword">ld</span> (STORE_SP1+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96

NB_BGD_LINE1		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">30</span>
LOOP_FILL1
		<span class="hljs-keyword">exx</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,LINE_MODE2_PEN1_MODE0_PEN14
		<span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">96</span>		
		<span class="hljs-keyword">ldir</span>
		<span class="hljs-keyword">exx</span>	
		<span class="hljs-keyword">djnz</span> LOOP_FILL1
<span class="hljs-comment">;</span>
      <span class="hljs-keyword">ld</span> (POK_SP2+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;</span>
STORE_SP1 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;		</span>
DISPLAY_BACKGROUND2
		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;		</span>
		<span class="hljs-keyword">ld</span> (STORE_SP2+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
POK_SP2		<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96
<span class="hljs-comment">;	</span>
<span class="hljs-comment">;</span>
     		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">30</span>
LOOP_FILL2
		<span class="hljs-keyword">exx</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,LINE_MODE2_PEN1_MODE0_PEN14
		<span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">96</span>		
		<span class="hljs-keyword">ldir</span>
		<span class="hljs-keyword">exx</span>	
		<span class="hljs-keyword">djnz</span> LOOP_FILL2
        <span class="hljs-keyword">ld</span> (POK_SP3+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>

STORE_SP2 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>

DISPLAY_BACKGROUND3
		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;		</span>
		<span class="hljs-keyword">ld</span> (STORE_SP3+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
POK_SP3	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96
<span class="hljs-comment">;	</span>

NB_BGD_LINE2		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">47</span>-<span class="hljs-number">30</span>
LOOP_FILL3
		<span class="hljs-keyword">exx</span>
POK_MIDDLE_LINE1		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,LINE_MODE2_PEN1_MODE0_PEN14 <span class="hljs-comment">; LINE_HBL_MODE1 when HBL are ON</span>
 		<span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span> 
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">96</span>		
		<span class="hljs-keyword">ldir</span>
		<span class="hljs-keyword">exx</span>	
		<span class="hljs-keyword">djnz</span> LOOP_FILL3
<span class="hljs-comment">;		</span>
        <span class="hljs-keyword">ld</span> (POK_SP4+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;</span>
STORE_SP3 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>		

DISPLAY_BACKGROUND4
		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;		</span>
		<span class="hljs-keyword">ld</span> (STORE_SP4+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
POK_SP4	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96
<span class="hljs-comment">;	</span>
  		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">30</span>
LOOP_FILL4
		<span class="hljs-keyword">exx</span>

        <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,(POK_MIDDLE_LINE1+<span class="hljs-number">1</span>) 
  		<span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span> 
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">96</span>		
		<span class="hljs-keyword">ldir</span>
		<span class="hljs-keyword">exx</span>	
		<span class="hljs-keyword">djnz</span> LOOP_FILL4
<span class="hljs-comment">;		</span>
        <span class="hljs-keyword">ld</span> (POK_SP5+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;</span>
STORE_SP4 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>		

DISPLAY_BACKGROUND5
		<span class="hljs-keyword">di</span>
		<span class="hljs-keyword">ld</span> (STORE_SP5+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;		</span>
POK_SP5	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96
<span class="hljs-comment">;</span>
NB_BGD_LINE3		<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">31</span>
LOOP_FILL5
		<span class="hljs-keyword">exx</span>
POK_BOTTOM_LINE1	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,LINE_MODE1_EMPTY_PEN0   <span class="hljs-comment">;  LINE_MODE2_PEN1_MODE0_PEN14 when HBL are ON</span>
		<span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">96</span>		
		<span class="hljs-keyword">ldir</span>
		<span class="hljs-keyword">exx</span>	
		<span class="hljs-keyword">djnz</span> LOOP_FILL5
<span class="hljs-comment">;</span>
         <span class="hljs-keyword">ld</span> (POK_SP6+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;		 </span>
STORE_SP5 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;</span>
DISPLAY_BACKGROUND6
		<span class="hljs-keyword">di</span>
		<span class="hljs-keyword">ld</span> (STORE_SP6+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
<span class="hljs-comment">;		</span>
POK_SP6	 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,TABLINE_96

<span class="hljs-comment">;</span>
<span class="hljs-comment">;NB_BGD_LINE5		</span>
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">30</span>
LOOP_FILL6
		<span class="hljs-keyword">exx</span>
        <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,(POK_BOTTOM_LINE1+<span class="hljs-number">1</span>) 
<span class="hljs-comment">;		</span>
		<span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">96</span>		
		<span class="hljs-keyword">ldir</span>
		<span class="hljs-keyword">exx</span>	
		<span class="hljs-keyword">djnz</span> LOOP_FILL6
<span class="hljs-comment">;</span>
STORE_SP6 <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">&1000</span>
		<span class="hljs-keyword">ei</span>
		<span class="hljs-keyword">ret</span>


<span class="hljs-comment">;</span>
LINE_MODE1_EMPTY_PEN0  <span class="hljs-built_in">defs</span> <span class="hljs-number">96</span>,<span class="hljs-number">0</span>
LINE_MODE2_PEN1_MODE0_PEN14 <span class="hljs-built_in">defs</span> <span class="hljs-number">96</span>,<span class="hljs-number">255</span>
LINE_HBL_MODE1 <span class="hljs-built_in">defs</span> <span class="hljs-number">34</span>,<span class="hljs-number">255</span>
					<span class="hljs-built_in">defs</span> <span class="hljs-number">30</span>,<span class="hljs-number">0</span>
					<span class="hljs-built_in">defs</span> <span class="hljs-number">32</span>,<span class="hljs-number">255</span><span class="hljs-comment">; &3F</span>
<span class="hljs-comment">;					</span>

DISPLAY_SPRITE_80BYTES

	<span class="hljs-keyword">di</span>
<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; hl = SPRITE </span>
<span class="hljs-comment">; bc = ADDRESSES TABLE</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">ld</span> (STORE_SPZ+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-variable">b</span>
<span class="hljs-comment">;</span>

LOOP_SPRITE    
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">ex</span> <span class="hljs-variable">de</span>,<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">pop</span> <span class="hljs-variable">hl</span>

POSX_SPRITE <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">00</span>
	<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>	
	<span class="hljs-keyword">ex</span> <span class="hljs-variable">de</span>,<span class="hljs-variable">hl</span>

WIDTH_SPRITE <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">20</span>

	<span class="hljs-keyword">ldir</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,LOOP_SPRITE 
<span class="hljs-comment">;</span>
STORE_SPZ <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">000</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">ei</span>
	<span class="hljs-keyword">ret</span>

DISPLAY_SPRITE_SHORT
	<span class="hljs-keyword">di</span>
<span class="hljs-comment">; hl = SPRITE </span>
<span class="hljs-comment">; bc = ADDRESSES TABLE</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">ld</span> (STORE_SP+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-variable">b</span>
    <span class="hljs-keyword">jp</span> SHORT
 

DISPLAY_SPRITE
	<span class="hljs-keyword">di</span>
<span class="hljs-comment">; hl = SPRITE </span>
<span class="hljs-comment">; bc = ADDRESSES TABLE</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">ld</span> (STORE_SP+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-variable">b</span>
<span class="hljs-comment">;	</span>
    <span class="hljs-built_in">repeat</span> <span class="hljs-number">2</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">ex</span> <span class="hljs-variable">de</span>,<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">pop</span> <span class="hljs-variable">hl</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>	
	<span class="hljs-keyword">ex</span> <span class="hljs-variable">de</span>,<span class="hljs-variable">hl</span>
	
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">repeat</span> SPRWIDTH
	<span class="hljs-keyword">ldi</span>
	<span class="hljs-built_in">rend</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-built_in">rend</span> 
SHORT
<span class="hljs-comment">;	</span>
	<span class="hljs-built_in">repeat</span> SPRHEIGHT-<span class="hljs-number">2</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">ex</span> <span class="hljs-variable">de</span>,<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">pop</span> <span class="hljs-variable">hl</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>	
	<span class="hljs-keyword">ex</span> <span class="hljs-variable">de</span>,<span class="hljs-variable">hl</span>

<span class="hljs-comment">;</span>
	<span class="hljs-built_in">repeat</span> SPRWIDTH
	<span class="hljs-keyword">ldi</span>
	<span class="hljs-built_in">rend</span>

	<span class="hljs-built_in">rend</span>

STORE_SP <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">000</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">ei</span>
	<span class="hljs-keyword">ret</span>

DISPLAY_MOVING_SPRITE1
MOVE_SPR_H 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_MOVES_T+<span class="hljs-number">&200</span>+<span class="hljs-number">&ff</span> <span class="hljs-comment">; </span>
STOP_MOVH	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
			<span class="hljs-keyword">ld</span> (MOVE_SPR_H+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
			<span class="hljs-keyword">exx</span>
			<span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-number">0</span>
						
SPRITE1		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_HL
			<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>
			<span class="hljs-keyword">ld</span> (SPRITE1_FINAL+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			<span class="hljs-keyword">exx</span>

			<span class="hljs-keyword">dec</span> <span class="hljs-variable">h</span>

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
			<span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,<span class="hljs-number">0</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">dec</span> <span class="hljs-variable">h</span>                 <span class="hljs-comment">; table X</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
<span class="hljs-comment">;</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">0</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96
			<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span>
			<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>
<span class="hljs-comment">;</span>
SPRITE1_FINAL		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_HL
		<span class="hljs-keyword">call</span> DISPLAY_SPRITE

		<span class="hljs-keyword">ret</span>

DISPLAY_MOVING_SPRITE2

MOVE_SPR_L 	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_MOVES_B+<span class="hljs-number">&200</span> <span class="hljs-comment">; +&ff+1 ; table Y</span>
STOP_MOVL			<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
			<span class="hljs-keyword">ld</span> (MOVE_SPR_L+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
<span class="hljs-comment">;</span>
			<span class="hljs-keyword">exx</span>
			<span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-number">0</span>
						
SPRITE2		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_LL
			<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>
			<span class="hljs-keyword">ld</span> (SPRITE2_FINAL+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			<span class="hljs-keyword">exx</span>
	     	<span class="hljs-keyword">dec</span> <span class="hljs-variable">h</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
			<span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,<span class="hljs-variable">a</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,<span class="hljs-number">0</span>
<span class="hljs-comment">;			</span>
			<span class="hljs-keyword">dec</span> <span class="hljs-variable">h</span>                 <span class="hljs-comment">; table X</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>) 

			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">72</span>+<span class="hljs-number">16</span>+<span class="hljs-number">16</span>+<span class="hljs-number">4</span>+<span class="hljs-number">2</span>+<span class="hljs-number">6</span>+<span class="hljs-number">2</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_96
			<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span>
			<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">bc</span>
<span class="hljs-comment">;</span>
SPRITE2_FINAL			<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_LL

		<span class="hljs-keyword">call</span> DISPLAY_SPRITE
		<span class="hljs-keyword">ret</span>

			<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
<span class="hljs-comment">;	</span>
TAB_SCENARIO   
<span class="hljs-comment">;			</span>
           <span class="hljs-built_in">defb</span> <span class="hljs-number">128</span> 
           <span class="hljs-built_in">defw</span> STATIC_SPRITES
TAB_SCENARIO_LOOP 
<span class="hljs-comment">;			</span>
			<span class="hljs-built_in">defb</span> <span class="hljs-number">&98</span>
			<span class="hljs-built_in">defw</span> PART3
<span class="hljs-comment">;			</span>
			<span class="hljs-built_in">defb</span> <span class="hljs-number">256</span>-<span class="hljs-number">&98</span>-<span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> PART4
<span class="hljs-comment">;			</span>
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> PART5
<span class="hljs-comment">;	</span>
			<span class="hljs-built_in">defb</span> <span class="hljs-number">&98</span>+<span class="hljs-number">5</span> <span class="hljs-comment">; +5-2</span>
			<span class="hljs-built_in">defw</span> PART1
<span class="hljs-comment">;</span>
			<span class="hljs-built_in">defb</span> <span class="hljs-number">256</span>-<span class="hljs-number">&98</span>-<span class="hljs-number">5</span>-<span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> PART2
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> PART6

	<span class="hljs-comment">;		defb &98</span>
	<span class="hljs-comment">;		defw PART3</span>
<span class="hljs-comment">;			</span>
<span class="hljs-comment">;			defb 256-&98-1</span>
<span class="hljs-comment">;			defw PART4</span>
<span class="hljs-comment">;			</span>
<span class="hljs-comment">;			defb 1</span>
<span class="hljs-comment">;			defw PART5</span>
<span class="hljs-comment">;	</span>
<span class="hljs-comment">;			defb &98+5 ; +5-2</span>
<span class="hljs-comment">;			defw PART1</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">;			defb 256-&98-5-1</span>
<span class="hljs-comment">;			defw PART2</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">;           defb 1</span>
<span class="hljs-comment">;			defw PART6</span>

            <span class="hljs-built_in">defb</span> <span class="hljs-number">&98</span>/<span class="hljs-number">2</span>+<span class="hljs-number">20</span>-<span class="hljs-number">10</span>
			<span class="hljs-built_in">defw</span> PART3

           <span class="hljs-built_in">defb</span> <span class="hljs-number">128</span> 
           <span class="hljs-built_in">defw</span> STATIC_SPRITES2
			<span class="hljs-built_in">defb</span> <span class="hljs-number">0</span>

TAB_SCENARIO_SPR 
 <span class="hljs-comment">;</span>
              <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART4
               <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART5
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART6
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART5
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART4
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART3
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART2
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART1
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART2
			   <span class="hljs-built_in">defb</span> <span class="hljs-number">3</span>
              <span class="hljs-built_in">defw</span> DISPLAY_HEART3
<span class="hljs-comment">;			  </span>
			  <span class="hljs-built_in">defb</span> <span class="hljs-number">0</span>


TAB_SCENARIO_TRANSITION1   
			
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_BACKGROUND1
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_BACKGROUND2			
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_BACKGROUND3
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_BACKGROUND4
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_BACKGROUND5
            <span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_BACKGROUND6
			<span class="hljs-built_in">defb</span> <span class="hljs-number">1</span>
			<span class="hljs-built_in">defw</span> DISPLAY_B_TRANSITION1
<span class="hljs-comment">;			</span>

			<span class="hljs-built_in">defb</span> <span class="hljs-number">0</span>			
PART1 	

MODE_TOP_1 			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8c</span>  <span class="hljs-comment">; 			</span>
					<span class="hljs-keyword">ld</span> (MODE_TOP+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

MODE_BOTTOM_1 		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8e</span>
					<span class="hljs-keyword">ld</span> (MODE_BOTTOM+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
			<span class="hljs-comment">;		ld (POK_M2+1),a	</span>


		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&69</span> <span class="hljs-comment">; out (c),l</span>
		<span class="hljs-keyword">ld</span> (PATCH1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&59</span> <span class="hljs-comment">; out (c),e</span>
		<span class="hljs-keyword">ld</span> (PATCH2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
<span class="hljs-comment">;</span>
SPR1_1		<span class="hljs-keyword">LD</span> <span class="hljs-variable">hl</span>,SPRITE_HL
SPR2_1		<span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,SPRITE_LL

				<span class="hljs-keyword">ld</span> (SPRITE1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
				<span class="hljs-keyword">ld</span> (SPRITE2+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>

switch_raster2_1 <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1A+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
switch_pens1_1  <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&010f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>	

				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&1</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER2+<span class="hljs-number">2</span>),<span class="hljs-variable">a</span>			
<span class="hljs-comment">;????</span>
switch_raster1_1  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER0A+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>


<span class="hljs-comment">; ?????				</span>
switch_pens2_1  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f01</span>	
				<span class="hljs-keyword">ld</span> (POK_RASTER0+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>   <span class="hljs-comment">; out c,(l)   </span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>
POKE2_1
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,POK_OUT_L+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">c</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,POK_OUT_R+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">de</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ret</span>

PART2 	

MODE_TOP_2 			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8c</span>  <span class="hljs-comment">; </span>
					<span class="hljs-keyword">ld</span> (POK_M1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
					<span class="hljs-keyword">ld</span> (MODE_TOP+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

MODE_BOTTOM_2		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8e</span>
					<span class="hljs-keyword">ld</span> (MODE_BOTTOM+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&59</span>
		<span class="hljs-keyword">ld</span> (PATCH1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&69</span> 
		<span class="hljs-keyword">ld</span> (PATCH2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	


<span class="hljs-comment">;</span>
SPR1_2		<span class="hljs-keyword">LD</span> <span class="hljs-variable">hl</span>,SPRITE_HL
SPR2_2		<span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,SPRITE_LL

				<span class="hljs-keyword">ld</span> (SPRITE1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
				<span class="hljs-keyword">ld</span> (SPRITE2+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>

switch_raster2_2 <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_BOTTOM_TOP <span class="hljs-comment">; &5D58</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1A+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
switch_pens1_2  <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&010f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>		

				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER2+<span class="hljs-number">2</span>),<span class="hljs-variable">a</span>			
<span class="hljs-comment">;????</span>
switch_raster1_2  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER0A+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">; ?????				</span>
switch_pens2_2  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f01</span>	
				<span class="hljs-keyword">ld</span> (POK_RASTER0+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&69</span>   <span class="hljs-comment">; out c,(l)   </span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>
POKE2_2
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,POK_OUT_L+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">c</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,POK_OUT_R+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">de</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ret</span>

STATIC_SPRITES2
    <span class="hljs-keyword">xor</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> (STOP_MOVH),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> (STOP_MOVL),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> PART3


STATIC_SPRITES
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_MOVES_T+<span class="hljs-number">&200</span>+<span class="hljs-number">&ff</span>
	<span class="hljs-keyword">ld</span> (MOVE_SPR_H+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TAB_MOVES_B+<span class="hljs-number">&200</span> 
    <span class="hljs-keyword">ld</span> (MOVE_SPR_L+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
PART3

MODE_TOP_3 			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8e</span>  <span class="hljs-comment">; 			</span>
					<span class="hljs-keyword">ld</span> (MODE_TOP+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

MODE_BOTTOM_3 		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8c</span>
					<span class="hljs-keyword">ld</span> (MODE_BOTTOM+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>

<span class="hljs-comment">;			</span>

      	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&69</span> <span class="hljs-comment">; out (c),l</span>
		<span class="hljs-keyword">ld</span> (PATCH1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&59</span> <span class="hljs-comment">; out (c),e</span>
		<span class="hljs-keyword">ld</span> (PATCH2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
SPR1_3		<span class="hljs-keyword">LD</span> <span class="hljs-variable">hl</span>,SPRITE_HL
SPR2_3		<span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,SPRITE_LL

				<span class="hljs-keyword">ld</span> (SPRITE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (SPRITE2+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>

switch_raster2_3 <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1A+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
switch_pens1_3  <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&0f01</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>	

				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER2+<span class="hljs-number">2</span>),<span class="hljs-variable">a</span>				
<span class="hljs-comment">;????</span>
switch_raster1_3  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RASTER_TOP_BOTTOM  <span class="hljs-comment">;&585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER0A+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>


<span class="hljs-comment">; ?????				</span>
switch_pens2_3  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f01</span>	
				<span class="hljs-keyword">ld</span> (POK_RASTER0+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>   
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>
POKE2_3
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,POK_OUT_L+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">c</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,POK_OUT_R+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">de</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ret</span>

PART4

MODE_TOP_4 			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8e</span>  <span class="hljs-comment">; 			</span>
					<span class="hljs-keyword">ld</span> (MODE_TOP+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

MODE_BOTTOM_4 		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8c</span>
					<span class="hljs-keyword">ld</span> (MODE_BOTTOM+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
			<span class="hljs-comment">;		ld (POK_M2+1),a	</span>
<span class="hljs-comment">;			</span>
SPR1_4		<span class="hljs-keyword">LD</span> <span class="hljs-variable">hl</span>,SPRITE_HL
SPR2_4		<span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,SPRITE_LL

				<span class="hljs-keyword">ld</span> (SPRITE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (SPRITE2+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>

switch_raster2_4 <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1A+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
switch_pens1_4  <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&010f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>


				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER2+<span class="hljs-number">2</span>),<span class="hljs-variable">a</span>	

switch_raster1_4  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RASTER_TOP_BOTTOM  <span class="hljs-comment">;&585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER0A+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			
switch_pens2_4  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f01</span>	
				<span class="hljs-keyword">ld</span> (POK_RASTER0+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&69</span>   
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>
POKE2_4
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,POK_OUT_L+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">c</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,POK_OUT_R+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">de</span>),<span class="hljs-variable">a</span>
				<span class="hljs-keyword">ret</span>

PART5
 <span class="hljs-comment">;kpoint</span>
MODE_TOP_5 			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8e</span>  <span class="hljs-comment">; 			</span>
					<span class="hljs-keyword">ld</span> (MODE_TOP+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

MODE_BOTTOM_5 		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8c</span>
					<span class="hljs-keyword">ld</span> (MODE_BOTTOM+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
			<span class="hljs-comment">;		ld (POK_M2+1),a	</span>
<span class="hljs-comment">;			</span>
SPR1_5		<span class="hljs-keyword">LD</span> <span class="hljs-variable">hl</span>,SPRITE_LL <span class="hljs-comment">;  SPRITEHL</span>
SPR2_5		<span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,SPRITE_HL

				<span class="hljs-keyword">ld</span> (SPRITE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (SPRITE2+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>

switch_raster2_5 <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1A+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
switch_pens1_5  <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&010f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>


				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER2+<span class="hljs-number">2</span>),<span class="hljs-variable">a</span>	

switch_raster1_5  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RASTER_TOP_BOTTOM  <span class="hljs-comment">;&585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER0A+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
			
switch_pens2_5  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f01</span>	
				<span class="hljs-keyword">ld</span> (POK_RASTER0+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&69</span>   
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>
POKE2_5
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,POK_OUT_L+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">c</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,POK_OUT_R+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">de</span>),<span class="hljs-variable">a</span>
				<span class="hljs-keyword">ret</span>



PART6

MODE_TOP_6			<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8e</span>  <span class="hljs-comment">; 			</span>
					<span class="hljs-keyword">ld</span> (MODE_TOP+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	

MODE_BOTTOM_6 		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&8c</span>
					<span class="hljs-keyword">ld</span> (MODE_BOTTOM+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
					<span class="hljs-keyword">ld</span> (POK_M1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
			<span class="hljs-comment">;		ld (POK_M2+1),a	</span>
<span class="hljs-comment">;			</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&69</span> <span class="hljs-comment">; out (c),l</span>
		<span class="hljs-keyword">ld</span> (PATCH1+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&59</span> <span class="hljs-comment">; out (c),e</span>
		<span class="hljs-keyword">ld</span> (PATCH2+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>	
SPR1_6		<span class="hljs-keyword">LD</span> <span class="hljs-variable">hl</span>,SPRITE_HL
SPR2_6		<span class="hljs-keyword">LD</span> <span class="hljs-variable">de</span>,SPRITE_LL

				<span class="hljs-keyword">ld</span> (SPRITE1+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
				<span class="hljs-keyword">ld</span> (SPRITE2+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>

switch_raster2_6 <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_TOP_BOTTOM <span class="hljs-comment">; &585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1A+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>
switch_pens1_6  <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&0f01</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER1+<span class="hljs-number">1</span>),<span class="hljs-variable">de</span>	

				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&f</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER2+<span class="hljs-number">2</span>),<span class="hljs-variable">a</span>	

switch_raster1_6  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RASTER_TOP_BOTTOM  <span class="hljs-comment">;&585D</span>
				<span class="hljs-keyword">ld</span> (POK_RASTER0A+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>

		
switch_pens2_6  <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f01</span>	
				<span class="hljs-keyword">ld</span> (POK_RASTER0+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&49</span>   
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">&49</span>
POKE2_6
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,POK_OUT_L+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">c</span>
				<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,POK_OUT_R+<span class="hljs-number">1</span>
				<span class="hljs-keyword">ld</span> (<span class="hljs-variable">de</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
				<span class="hljs-keyword">ret</span>

COLOR
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f00</span>
BOUCOLOR
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> 
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>  
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)  
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)  
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ret</span>	
<span class="hljs-comment">;</span>
HBL_ZONE_02

		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">; IMPORTANT *****************************</span>
<span class="hljs-comment">; start at HCC = &1C</span>

<span class="hljs-comment">;	NOP</span>

	<span class="hljs-keyword">exx</span>

POK_M1X		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
POK_RASTER1X	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&010f</span>
POK_RASTER1AX <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&5454</span> <span class="hljs-comment">;RASTER_BOTTOM_TOP ;&5D58</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
<span class="hljs-comment">;						</span>
POK_M2X		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&8d8c</span>
		<span class="hljs-comment">;	ld a,h</span>
<span class="hljs-comment">;			</span>
PATCH1X			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>  <span class="hljs-comment">; </span>
		<span class="hljs-keyword">exx</span>
PATCH_LOGO1	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&1932</span>
<span class="hljs-comment">; was 	ld de,&1F07</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&1f08</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc03</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
<span class="hljs-comment">;	dec c    ; &bd02</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">27</span>-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>

	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>   <span class="hljs-comment">; R3=&08</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span> <span class="hljs-comment">; &8c</span>
	<span class="hljs-keyword">exx</span>
PATCH2X 	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; mode 0</span>
  <span class="hljs-comment">;   defs 4,0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;	defs 5,0</span>


   <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_FLASH
HBL_FLASH
<span class="hljs-comment">;	repeat 48</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">; was out (c),c ; R3= 2	</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">exx</span> <span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>

	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_FLASH
<span class="hljs-comment">;	</span>
<span class="hljs-comment">;	rend	</span>
<span class="hljs-comment">; *****************************************	</span>
<span class="hljs-comment">; last line </span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span> <span class="hljs-comment">; mode </span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &12</span>
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">8</span>-<span class="hljs-number">2</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,<span class="hljs-number">&8e</span>-<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>   <span class="hljs-comment">; R2 = &22</span>
	<span class="hljs-keyword">exx</span> 
POK_OUT_RX	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode </span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">exx</span>
POK_OUT_LX 	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>    <span class="hljs-comment">; dernier mode</span>
<span class="hljs-comment">;	defs 4,0</span>
	
	<span class="hljs-keyword">exx</span>

<span class="hljs-comment">; breakpoint</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &A</span>

			<span class="hljs-keyword">exx</span>
POK_RASTER2X 
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f54</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-number">&F</span>		
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>	
		<span class="hljs-comment">;	exx </span>

	<span class="hljs-keyword">ret</span>

DISPLAY_H_LOGO
<span class="hljs-comment">; H</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">14</span>
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">20</span>-<span class="hljs-number">14</span>+<span class="hljs-number">2</span>+<span class="hljs-number">2</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>

<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">44</span>-<span class="hljs-number">1</span>-<span class="hljs-number">3</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_H_LOGO
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">16</span>-<span class="hljs-number">8</span>
    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>
<span class="hljs-comment">;</span>


DISPLAY_ORNY
<span class="hljs-comment">; hORNY</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">25</span>
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">20</span>+<span class="hljs-number">1</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>

<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">44</span> 
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,ORNY
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80
    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>


DISPLAY_B_LOGO   
<span class="hljs-comment">; bYTES</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">15</span>-<span class="hljs-number">1</span>
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">48</span>-<span class="hljs-number">4</span>-<span class="hljs-number">4</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_B_LOGO
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">60</span>+<span class="hljs-number">50</span>-<span class="hljs-number">20</span>-<span class="hljs-number">2</span>-<span class="hljs-number">2</span>+<span class="hljs-number">4</span>+<span class="hljs-number">2</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>
DISPLAY_YTES   
<span class="hljs-comment">; bYTES</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">23</span>
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">10</span>+<span class="hljs-number">4</span>-<span class="hljs-number">2</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">; a = HEIGHT	</span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">48</span>-<span class="hljs-number">6</span>-<span class="hljs-number">1</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,YTES
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">60</span>+<span class="hljs-number">50</span>-<span class="hljs-number">20</span>-<span class="hljs-number">2</span>-<span class="hljs-number">2</span>+<span class="hljs-number">4</span>-<span class="hljs-number">2</span>

    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
<span class="hljs-comment">;</span>
<span class="hljs-comment">; MODE 0 patch for the first line of S</span>
<span class="hljs-comment">; which is supposed to be in MODE 1</span>
<span class="hljs-comment">;</span>
       <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">64</span>  
PATCH <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&E1AF</span>
       <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>
	   <span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
	   <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">192</span>
	   <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>
<span class="hljs-comment">;	   inc l</span>
<span class="hljs-comment">;	   ld (hl),a</span>
	<span class="hljs-keyword">ret</span>


DISPLAY_L_LOGO


	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">16</span>
    <span class="hljs-keyword">ld</span> (WIDTH_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">35</span>+<span class="hljs-number">2</span>
	<span class="hljs-keyword">ld</span> (POSX_SPRITE+<span class="hljs-number">1</span>),<span class="hljs-variable">a</span>

<span class="hljs-comment">; a = HEIGHT	 </span>
<span class="hljs-comment">; bc = SPRITE </span>
<span class="hljs-comment">; hl = ADDRESSES TABLE</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-number">45</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,SPRITE_L_LOGO
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80+<span class="hljs-number">300</span>-<span class="hljs-number">2</span>
    <span class="hljs-keyword">call</span> DISPLAY_SPRITE_80BYTES
	<span class="hljs-keyword">ret</span>


HBL_ZONE_LOGO
		<span class="hljs-keyword">di</span>
<span class="hljs-comment">; IMPORTANT *****************************</span>
<span class="hljs-comment">; start at HCC = &1C</span>
	    <span class="hljs-keyword">exx</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>					
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&8d8c</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&1800</span>+R2_LOGO
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&1f08</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc03</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">27</span>-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>   <span class="hljs-comment">; R3=&08</span>
	<span class="hljs-keyword">exx</span>
    <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; mode 0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span> <span class="hljs-comment">; &8c</span>
<span class="hljs-comment">;</span>
  <span class="hljs-built_in">nop</span>
  <span class="hljs-built_in">nop</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_HORNY
HBL_HORNY1
<span class="hljs-comment">;	repeat 20</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_HORNY1
		<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
<span class="hljs-comment">;	dec h</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">9</span>+<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">3</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_HORNY2
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">h</span>
<span class="hljs-comment">;	</span>
HBL_HORNY2
<span class="hljs-comment">;	repeat 20</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">9</span>+<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_HORNY2
<span class="hljs-comment">;	rend	</span>
<span class="hljs-comment">; *****************************************	</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">9</span>+<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span> 
    <span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">3</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_HORNY3+<span class="hljs-number">1</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">h</span>

HBL_HORNY3
<span class="hljs-comment">;	repeat 20</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">9</span>+<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_HORNY3
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>

	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; mode 0 for the transition line</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-number">&14</span>+<span class="hljs-number">1</span>
	<span class="hljs-keyword">exx</span>
 
<span class="hljs-comment">; 64NOPS</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f01</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,COLOR1_BYTES_LOGO
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">64</span>-<span class="hljs-number">13</span>-<span class="hljs-number">32</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
<span class="hljs-comment">; end of the line</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">&8d</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">32</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">4</span>-<span class="hljs-number">2</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_BYTES
HBL_BYTES

	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>

	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_BYTES	
<span class="hljs-comment">;	</span>

	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>

	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
<span class="hljs-comment">;</span>
    <span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">2</span>,<span class="hljs-number">0</span> 
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-number">&10</span>

    <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_BYTES2
HBL_BYTES2

	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>

	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>-<span class="hljs-number">4</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_BYTES2	

	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &1F</span>

	<span class="hljs-built_in">defs</span> <span class="hljs-number">10</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode 2</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
<span class="hljs-comment">;</span>
     <span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span> <span class="hljs-comment">; MODE 0</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;	</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &12</span>
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">8</span>-<span class="hljs-number">2</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,<span class="hljs-number">&8e</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>   <span class="hljs-comment">; R2 = &22</span>
	<span class="hljs-keyword">exx</span> 
<span class="hljs-comment">; out (c),c ; mode </span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">exx</span>
  <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>    <span class="hljs-comment">; dernier mode</span>
<span class="hljs-comment">;	defs 4,0</span>
	
	<span class="hljs-keyword">exx</span>

	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &A</span>

			<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">ret</span>


HBL_ZONE_012
		<span class="hljs-keyword">di</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">; IMPORTANT *****************************</span>
<span class="hljs-comment">; start at HCC = &1C</span>

<span class="hljs-comment">;	NOP</span>

	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">; preload the 2 MODEs</span>
<span class="hljs-comment">; H=left mode</span>
<span class="hljs-comment">; L=right mode  </span>
<span class="hljs-comment">;</span>

POK_M1		<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7f8e</span>
POK_RASTER1	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&010f</span>
POK_RASTER1A <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,RASTER_BOTTOM_TOP <span class="hljs-comment">;&5D58</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
<span class="hljs-comment">;						</span>
POK_M2		<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&8d8c</span>
		<span class="hljs-comment">;	ld a,h</span>
<span class="hljs-comment">;			</span>
PATCH1			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>
		<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&1132</span>
<span class="hljs-comment">; was 	ld de,&1F07</span>
   <span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>,<span class="hljs-number">&1f08</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&bc03</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
<span class="hljs-comment">;	dec c    ; &bd02</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">27</span>-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>

	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>   <span class="hljs-comment">; </span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span> <span class="hljs-comment">; &8c</span>
	<span class="hljs-keyword">exx</span>
PATCH2	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;	defs 5,0</span>

  <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,HEIGHT_HBL_MAIN
   <span class="hljs-built_in">nop</span>
   <span class="hljs-built_in">nop</span>
HBL_LOOP_012
<span class="hljs-comment">;	repeat 48+4-1+10-3-12</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">; was out (c),c ; R3= 2	</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span> <span class="hljs-comment">; mode </span>
	<span class="hljs-keyword">exx</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &11</span>
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">8</span>-<span class="hljs-number">2</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>   <span class="hljs-comment">; R2 = &1F</span>
	<span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode </span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &7</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">c</span>        
<span class="hljs-comment">;</span>
	<span class="hljs-comment">;defs 4,0	</span>
    <span class="hljs-keyword">dec</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jr</span> nz,HBL_LOOP_012
	<span class="hljs-built_in">nop</span>
	<span class="hljs-comment">;rend	</span>
<span class="hljs-comment">; last line </span>
    <span class="hljs-keyword">exx</span> 
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span> <span class="hljs-comment">; mode </span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R3= 2</span>
<span class="hljs-comment">;</span>
	
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; R2 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>   <span class="hljs-comment">; R2 = &12</span>
<span class="hljs-comment">;</span>
	<span class="hljs-built_in">defs</span> <span class="hljs-number">8</span>-<span class="hljs-number">2</span>,<span class="hljs-number">0</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,<span class="hljs-number">&8e</span>-<span class="hljs-number">2</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">d</span>   <span class="hljs-comment">; R2 = &22</span>
	<span class="hljs-keyword">exx</span> 
POK_OUT_R	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span> <span class="hljs-comment">; mode </span>
	<span class="hljs-keyword">exx</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>   <span class="hljs-comment">; R2 = &32 = 50</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>   <span class="hljs-comment">; R3 selected</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span>
	<span class="hljs-keyword">exx</span>
POK_OUT_L 	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>    <span class="hljs-comment">; dernier mode</span>
<span class="hljs-comment">;	defs 4,0</span>
	
	<span class="hljs-keyword">exx</span>

	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">e</span>    <span class="hljs-comment">; R3 = &A</span>
<span class="hljs-comment">;</span>

			<span class="hljs-keyword">exx</span>
POK_RASTER2 <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,<span class="hljs-number">&0f00</span>+BORDER_BOTTOM
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>
			<span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-number">&F</span>		
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">h</span>
			<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">l</span>	
			<span class="hljs-keyword">exx</span> 
	        <span class="hljs-keyword">ret</span>
<span class="hljs-comment">; 			</span>
	<span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
<span class="hljs-comment">; 	</span>
<span class="hljs-comment">; PEN 7 is set to BORDER_TOP to hide the post-HBL parasite</span>
<span class="hljs-comment">; from MODE 1 to MODE 0 	</span>
TCOL_MAIN <span class="hljs-built_in">defb</span> INK0,BORDER_BOTTOM
	<span class="hljs-built_in">defb</span> <span class="hljs-number">91</span>,BORDER_TOP
	<span class="hljs-built_in">defb</span> <span class="hljs-number">&4d</span>,BORDER_TOP,<span class="hljs-number">84</span>
	<span class="hljs-built_in">defb</span> BORDER_TOP
	<span class="hljs-built_in">defb</span> <span class="hljs-number">&4f</span>,<span class="hljs-number">&45</span>,<span class="hljs-number">&5d</span>,<span class="hljs-number">&4b</span>
	<span class="hljs-built_in">defb</span> <span class="hljs-number">67</span> <span class="hljs-comment">; &59 ; 91 </span>
	<span class="hljs-built_in">defb</span> <span class="hljs-number">&5f</span>,<span class="hljs-number">&55</span>,BORDER_TOP
<span class="hljs-comment">;	</span>
	<span class="hljs-built_in">defb</span> BORDER_TOP
<span class="hljs-comment">;	</span>
<span class="hljs-comment">; PEN 7 is set to BLACK to hide the post-HBL parasite</span>
<span class="hljs-comment">; from MODE 2 to MODE 0 	   </span>
TCOL_FLASH1 <span class="hljs-built_in">defb</span> <span class="hljs-number">75</span>,<span class="hljs-number">84</span>,<span class="hljs-number">79</span>,<span class="hljs-number">77</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">&4d</span>,<span class="hljs-number">84</span>,<span class="hljs-number">84</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">84</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">&4f</span>,<span class="hljs-number">&45</span>,<span class="hljs-number">&5d</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">75</span>,<span class="hljs-number">67</span>,<span class="hljs-number">&5f</span>,<span class="hljs-number">&55</span>,<span class="hljs-number">84</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">84</span>

TCOL_FLASH2 <span class="hljs-built_in">defb</span> <span class="hljs-number">84</span>,<span class="hljs-number">84</span>,<span class="hljs-number">75</span>,<span class="hljs-number">91</span>
	    <span class="hljs-built_in">defb</span> <span class="hljs-number">&4d</span>,<span class="hljs-number">84</span>,<span class="hljs-number">84</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">84</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">&4f</span>,<span class="hljs-number">&45</span>,<span class="hljs-number">&5d</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">75</span>,<span class="hljs-number">67</span>,<span class="hljs-number">&5f</span>,<span class="hljs-number">&55</span>,<span class="hljs-number">84</span>
		<span class="hljs-built_in">defb</span> <span class="hljs-number">84</span>
<span class="hljs-comment">;		</span>
TCOL_LOGO 
    <span class="hljs-built_in">defb</span> <span class="hljs-number">&54</span>,<span class="hljs-number">88</span> <span class="hljs-comment">; &55</span>
	<span class="hljs-built_in">defb</span> <span class="hljs-number">&5f</span>,<span class="hljs-number">&5d</span> <span class="hljs-comment">; &45</span>
	<span class="hljs-built_in">defb</span> <span class="hljs-number">&47</span>,<span class="hljs-number">&5e</span>,<span class="hljs-number">69</span>,<span class="hljs-number">&46</span>,<span class="hljs-number">&4f</span>,<span class="hljs-number">&40</span>,<span class="hljs-number">&43</span>,<span class="hljs-number">&4b</span>,<span class="hljs-number">&4a</span>,<span class="hljs-number">&44</span>,<span class="hljs-number">&5c</span>,<span class="hljs-number">&4e</span>
	<span class="hljs-built_in">defb</span> <span class="hljs-number">&54</span>
     <span class="hljs-comment">;   DB	#54,#5C,#43,#4B,#47,#5E,#4c,#5f,#44,#40,#4e,#4f,#5d,#4a,#5B,#46,#54</span>




<span class="hljs-comment">;defb 84,&4B,&n43,&5c</span>
          <span class="hljs-comment">; defb &47,&5e,&44,&5f,&4e,&4c,&4f,&5d,&4a,&40,&5b,&54</span>

POSXH    <span class="hljs-built_in">equ</span> <span class="hljs-number">30</span>-<span class="hljs-number">5</span>
POSXL    <span class="hljs-built_in">equ</span> <span class="hljs-number">50</span>+<span class="hljs-number">4</span>
TABLE_FLASHING_MOVES
  
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span> 
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH,POSXL
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>  
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH,POSXL            
<span class="hljs-comment">;</span>
   <span class="hljs-built_in">repeat</span> <span class="hljs-number">20</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH,POSXL
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH,POSXL 

		<span class="hljs-built_in">rend</span>	
<span class="hljs-comment">; </span>
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>  
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">1</span>,POSXL+<span class="hljs-number">1</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">1</span>,POSXL+<span class="hljs-number">1</span>        
<span class="hljs-comment">;</span>
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">2</span>,POSXL+<span class="hljs-number">2</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">2</span>,POSXL+<span class="hljs-number">2</span>          
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">3</span>,POSXL+<span class="hljs-number">3</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">3</span>,POSXL+<span class="hljs-number">3</span>       
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">4</span>,POSXL+<span class="hljs-number">4</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">4</span>,POSXL+<span class="hljs-number">4</span>     
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">5</span>,POSXL+<span class="hljs-number">5</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">5</span>,POSXL+<span class="hljs-number">5</span>        			
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">6</span>,POSXL+<span class="hljs-number">6</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">6</span>,POSXL+<span class="hljs-number">6</span>        
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">7</span>,POSXL+<span class="hljs-number">7</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">7</span>,POSXL+<span class="hljs-number">7</span>       
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">8</span>,POSXL+<span class="hljs-number">8</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">8</span>,POSXL+<span class="hljs-number">8</span>      
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">9</span>,POSXL+<span class="hljs-number">9</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">9</span>,POSXL+<span class="hljs-number">9</span>     
<span class="hljs-comment">;</span>
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">10</span>,POSXL+<span class="hljs-number">10</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">10</span>,POSXL+<span class="hljs-number">10</span>     
<span class="hljs-comment">;</span>
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">11</span>,POSXL+<span class="hljs-number">11</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">11</span>,POSXL+<span class="hljs-number">11</span>   
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">12</span>,POSXL+<span class="hljs-number">12</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">12</span>,POSXL+<span class="hljs-number">12</span>  
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">13</span>,POSXL+<span class="hljs-number">13</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">13</span>,POSXL+<span class="hljs-number">13</span>  
<span class="hljs-comment">;</span>
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">14</span>,POSXL+<span class="hljs-number">14</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">14</span>,POSXL+<span class="hljs-number">14</span>  
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">15</span>,POSXL+<span class="hljs-number">15</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">15</span>,POSXL+<span class="hljs-number">15</span>  
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">16</span>,POSXL+<span class="hljs-number">16</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">16</span>,POSXL+<span class="hljs-number">16</span>  
<span class="hljs-comment">; --</span>
            <span class="hljs-built_in">defb</span> MODE2,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HR,SPRITE_LL
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">17</span>,POSXL+<span class="hljs-number">17</span>
<span class="hljs-comment">;</span>
            <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">1</span>   
            <span class="hljs-built_in">defw</span> SPRITE_HL,SPRITE_LR
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">17</span>,POSXL+<span class="hljs-number">17</span> <span class="hljs-comment">;</span>
<span class="hljs-comment">;</span>
		    <span class="hljs-built_in">defb</span> MODE0,<span class="hljs-number">10</span>   
            <span class="hljs-built_in">defw</span> SPRITE_VIDE,SPRITE_VIDE
			<span class="hljs-built_in">defb</span> POSXH-<span class="hljs-number">17</span>,POSXL+<span class="hljs-number">17</span> <span class="hljs-comment">;</span>
 

            <span class="hljs-built_in">defb</span> <span class="hljs-number">0</span>		
<span class="hljs-comment">;						</span>
COEUR4  <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/COEUR4F.WIN"</span>
COEUR3  <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/COEUR3F.WIN"</span>
COEUR2  <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/COEUR2F.WIN"</span>
COEUR1  <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/COEUR1F.WIN"</span>
<span class="hljs-comment">;</span>
CRTC_TYPE <span class="hljs-built_in">defb</span> SELECTED_CRTC		   
<span class="hljs-comment">;</span>
  <span class="hljs-built_in">read</span> <span class="hljs-string">"rain.asm"</span>
	<span class="hljs-built_in">list</span> 
	<span class="hljs-built_in">nop</span>

EXIT_PART

	DS_SECURE_WAIT_VSYNC()
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,ini_crtc_load
	<span class="hljs-keyword">call</span> put_crtc

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0x7f54</span>
	<span class="hljs-keyword">xor</span> <span class="hljs-variable">a</span>
.black_loop
		<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">a</span>
		<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-variable">a</span>
		<span class="hljs-keyword">cp</span> <span class="hljs-number">18</span>
	<span class="hljs-keyword">jr</span> nz, .black_loop
<span class="hljs-comment">;</span>
	
	<span class="hljs-keyword">call</span> ds_stop_sound


<span class="hljs-built_in">if</span> LOAD_THE_LOADER
	NEXT_STEP_ADDRESS <span class="hljs-built_in">equ</span> <span class="hljs-number">0x100</span>
<span class="hljs-built_in">else</span>
	NEXT_STEP_ADDRESS <span class="hljs-built_in">equ</span> <span class="hljs-number">0x180</span>
<span class="hljs-built_in">endif</span>

    <span class="hljs-keyword">di</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, start_loader
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>, NEXT_STEP_ADDRESS
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, stop_loader - start_loader
	<span class="hljs-keyword">ldir</span>
    <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>, NEXT_STEP_ADDRESS
    <span class="hljs-keyword">jp</span> NEXT_STEP_ADDRESS
start_loader
	<span class="hljs-built_in">if</span> LOAD_THE_LOADER
		<span class="hljs-built_in">rorg</span> <span class="hljs-number">0x100</span>
		<span class="hljs-built_in">include</span> <span class="hljs-string">"../linking/src/load_outer_space_loader.asm"</span>
		<span class="hljs-built_in">rend</span>
	<span class="hljs-built_in">else</span>
		<span class="hljs-built_in">incbin</span> <span class="hljs-string">"../polar_dots/POLAR.LOA"</span>
	<span class="hljs-built_in">endif</span>
stop_loader
<span class="hljs-comment">;</span>

	DS_PRODUCE_STOP_SOUND_ROUTINE()

  <span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
END_CODE    
	<span class="hljs-built_in">assert</span> $<<span class="hljs-number">0xBC000</span></code></pre>
                            
                        </details>
                    </div>
                
                    <div class="item" data-source-file="intro_faked_link.asm">
                        <h4 id="source_intro_faked_link_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm">	<span class="hljs-built_in">run</span> <span class="hljs-number">&1000</span>

<span class="hljs-comment">/*
	; a basm bug forbids to write that
	bank &C6
 	org &4000
	incbin "C6.4000"
*/</span>

	<span class="hljs-built_in">bank</span> <span class="hljs-number">&c6</span>
	<span class="hljs-built_in">org</span> <span class="hljs-number">&4000</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"C6.4000"</span>

	<span class="hljs-built_in">bank</span> <span class="hljs-number">&c0</span>
	<span class="hljs-built_in">org</span> <span class="hljs-number">&1000</span>
	<span class="hljs-built_in">BREAKPOINT</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"C0.1000"</span></code></pre>
                            
                        </details>
                    </div>
                
                    <div class="item" data-source-file="intro_linked.asm">
                        <h4 id="source_intro_linked_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm">


	<span class="hljs-built_in">include</span> <span class="hljs-string">"../linking/src/demosystem/linker_common.asm"</span>
	<span class="hljs-built_in">include</span> once <span class="hljs-string">"../linking/src/demosystem/common.asm"</span>

	<span class="hljs-comment">; the backward cruncher is almost always the best choice</span>
	<span class="hljs-comment">; as it virtually needs less memory</span>
SELECTED_CRUNCHER=CRUNCHER_ZX0_BACKWARD


	<span class="hljs-built_in">org</span> <span class="hljs-number">0x200</span>
	<span class="hljs-built_in">run</span> $

	
	<span class="hljs-keyword">di</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, <span class="hljs-number">0xc9fb</span>
	<span class="hljs-keyword">ld</span> (<span class="hljs-number">0x38</span>), <span class="hljs-variable">hl</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>, $

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0x7fc6</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>
	UNCRUNCH(C6_4000, <span class="hljs-number">0x4000</span>)
	<span class="hljs-built_in">assert</span> C6_4000.uncrunched_length < <span class="hljs-number">0x4000</span>, <span class="hljs-string">"there is an issue we smash crunched data here"</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0x7fc4</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>
	UNCRUNCH(C4_4000, <span class="hljs-number">0x4000</span>)
	<span class="hljs-built_in">assert</span> C4_4000.uncrunched_length <= <span class="hljs-number">0x4000</span>, <span class="hljs-string">"there is an issue we smash crunched data here"</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0x7fc0</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>
	UNCRUNCH(C0_8000, <span class="hljs-number">0x8000</span>)

	UNCRUNCH(C0_800, <span class="hljs-number">0x800</span>)


	<span class="hljs-comment">; launch the intro</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>, <span class="hljs-number">0xc000</span>
	<span class="hljs-keyword">ei</span>

	DS_CRTC_VERTICAL_TRANSITION_ONLY_NO_MUSIC(<span class="hljs-number">0x1e</span>, <span class="hljs-number">0x1e</span>-<span class="hljs-number">2</span>)
	<span class="hljs-keyword">halt</span> : DS_CRTC_HORIZONTAL_TRANSITION_ONLY(<span class="hljs-number">0x2e</span>,  <span class="hljs-number">&30</span>+<span class="hljs-number">2</span>) <span class="hljs-comment">; Seems to be OK</span>
	<span class="hljs-keyword">jp</span> <span class="hljs-number">0x8000</span>

	INSTALL_UNCRUNCHER()


	<span class="hljs-built_in">assert</span> $<<span class="hljs-number">0x800</span>
	
	LOAD_N_CRUNCH(C6_4000, <span class="hljs-string">"C6.4000"</span>)
    LOAD_N_CRUNCH(C4_4000, <span class="hljs-string">"C4.4000"</span>)
	<span class="hljs-built_in">assert</span> $<<span class="hljs-number">0x4000</span>
	LOAD_N_CRUNCH(C0_8000, <span class="hljs-string">"C0.8000"</span>)
    LOAD_N_CRUNCH(C0_800, <span class="hljs-string">"C0.800"</span>)
	<span class="hljs-built_in">save</span> <span class="hljs-string">"INTRO.LNK"</span></code></pre>
                            
                        </details>
                    </div>
                
                    <div class="item" data-source-file="intro_loader.asm">
                        <h4 id="source_intro_loader_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm"><span class="hljs-built_in">include</span> once <span class="hljs-string">"../linking/src/demosystem/public.asm"</span>


	<span class="hljs-built_in">org</span> <span class="hljs-number">0x200</span>
	<span class="hljs-built_in">run</span> $

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, <span class="hljs-number">0xc9fb</span> : <span class="hljs-keyword">ld</span> (<span class="hljs-number">0x38</span>), <span class="hljs-variable">hl</span>

	<span class="hljs-keyword">jp</span> show_image
loader_start
	<span class="hljs-built_in">rorg</span> <span class="hljs-number">0x50</span>
load_next
	<span class="hljs-built_in">include</span> <span class="hljs-string">"../linking/src/load_intro.asm"</span>
	<span class="hljs-comment">;include "../linking/src/load_make_it_easy.asm"</span>
	<span class="hljs-built_in">rend</span>
loader_stop

show_image
	<span class="hljs-built_in">include</span> <span class="hljs-string">"../linking/src/demosystem/linker_common.asm"</span>
	SELECTED_CRUNCHER=CRUNCHER_EXOMIZER



	<span class="hljs-comment">; CRTC input state</span>
	<span class="hljs-comment">; R4=38</span>
	<span class="hljs-comment">; R7=0</span>
	<span class="hljs-comment">; R1=0</span>

	<span class="hljs-comment">; DO the CRTC transition</span>
	<span class="hljs-comment">; DS_CRTC_VERTICAL_AND_HORIZONTAL_TRANSITIONS_NO_MUSIC(0, 0x1e, 0x32, 0x2e)</span>
	<span class="hljs-keyword">ei</span>
	DS_CRTC_VERTICAL_TRANSITION_ONLY_NO_MUSIC(<span class="hljs-number">0x1c</span>, <span class="hljs-number">0x1e</span>) <span class="hljs-comment">; this is ok</span>

<span class="hljs-comment">; no need to do a R2 trnasition !</span>
<span class="hljs-comment">;	halt : DS_CRTC_HORIZONTAL_TRANSITION_ONLY(0x32,  &2e) ; Seems to be OK</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbc01</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span> 
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbd00</span> + <span class="hljs-number">96</span>/<span class="hljs-number">2</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>

<span class="hljs-comment">;	ld bc, 0xbc02 : out (c), c </span>
<span class="hljs-comment">;	ld bc, 0xbd00 + 0x32 : out (c), c</span>

<span class="hljs-comment">;	ld bc, 0xbc07 : out (c), c </span>
<span class="hljs-comment">;	ld bc, 0xbd00 + 0x1e : out (c), c</span>


	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbc06</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span> 
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbd00</span> + <span class="hljs-number">25</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>


	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbc03</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span> 
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbd00</span> + <span class="hljs-number">0x8e</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>


	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, palette_fadein.data
	<span class="hljs-keyword">call</span> palette_fadein.set_palette

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0x7f10</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0x7f54</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>

    UNCRUNCH C000, <span class="hljs-number">0xc000</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, <span class="hljs-number">0xbc00</span> + <span class="hljs-number">12</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, <span class="hljs-number">0x3000</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span> : <span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">h</span> : <span class="hljs-keyword">dec</span> <span class="hljs-variable">b</span> : <span class="hljs-keyword">inc</span> <span class="hljs-variable">c</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span> : <span class="hljs-keyword">inc</span> <span class="hljs-variable">b</span> : <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">l</span>

palette_fadein

.loop
	DS_SECURE_WAIT_VSYNC()

	<span class="hljs-comment">; select the right palette</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, .data
.palette_address <span class="hljs-built_in">equ</span> $-<span class="hljs-number">2</span>
	<span class="hljs-keyword">call</span> .set_palette

	<span class="hljs-comment">; change the palette every x frames</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>, <span class="hljs-number">4</span>
.wait <span class="hljs-built_in">equ</span> $-<span class="hljs-number">1</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">a</span> : <span class="hljs-keyword">and</span> <span class="hljs-number">%11</span>
	<span class="hljs-keyword">ld</span> (.wait), <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jp</span> nz, .loop

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, (.palette_address)
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>, <span class="hljs-number">4</span>
	<span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>, <span class="hljs-variable">de</span>
	<span class="hljs-keyword">ld</span> (.palette_address), <span class="hljs-variable">hl</span>

	<span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>, (<span class="hljs-variable">hl</span>) : <span class="hljs-keyword">or</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">jp</span> nz, .loop

	<span class="hljs-keyword">di</span>
		<span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>, <span class="hljs-number">0xc000</span>
	<span class="hljs-keyword">ei</span>
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>, loader_start
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">de</span>, load_next
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>, loader_stop-loader_start
    <span class="hljs-keyword">ldir</span>

	<span class="hljs-keyword">jp</span> load_next
	
.set_palette
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>, <span class="hljs-number">0x7f</span> : <span class="hljs-keyword">xor</span> <span class="hljs-variable">a</span>
.ga_loop
	<span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>, (<span class="hljs-variable">hl</span>)
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">a</span>
	<span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>), <span class="hljs-variable">c</span>

	<span class="hljs-keyword">inc</span> <span class="hljs-variable">hl</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-variable">a</span>
	<span class="hljs-keyword">cp</span> <span class="hljs-number">4</span> : <span class="hljs-keyword">jp</span> nz, .ga_loop
	<span class="hljs-keyword">ret</span>

.data
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"loading_fadeout.ga"</span>, <span class="hljs-number">4</span>*<span class="hljs-number">16</span>, <span class="hljs-number">4</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"loading_fadeout.ga"</span>, <span class="hljs-number">3</span>*<span class="hljs-number">16</span>, <span class="hljs-number">4</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"loading_fadeout.ga"</span>, <span class="hljs-number">2</span>*<span class="hljs-number">16</span>, <span class="hljs-number">4</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"loading_fadeout.ga"</span>, <span class="hljs-number">1</span>*<span class="hljs-number">16</span>, <span class="hljs-number">4</span>
	<span class="hljs-built_in">incbin</span> <span class="hljs-string">"loading_fadeout.ga"</span>, <span class="hljs-number">0</span>*<span class="hljs-number">16</span>, <span class="hljs-number">4</span>
	<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>


	INSTALL_UNCRUNCHER()



	LOAD_N_CRUNCH C000, <span class="hljs-string">"loading.scr"</span>



	<span class="hljs-built_in">SAVE</span> <span class="hljs-string">"INTRO.LOA"</span></code></pre>
                            
                        </details>
                    </div>
                
                    <div class="item" data-source-file="music.asm">
                        <h4 id="source_music_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm">   BuffSize	<span class="hljs-built_in">equ</span> <span class="hljs-number">#B42</span>		<span class="hljs-comment">; Size of replay buffer given by the cruncher.</span>

    FapBuff	<span class="hljs-built_in">equ</span> <span class="hljs-number">#6000</span>       	<span class="hljs-comment">; Address of the decrunch buffers (low order byte MUST BE 0).</span>
    HiFapBuff <span class="hljs-built_in">equ</span> hi(FapBuff)

FapPlay
     <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/fap-play.bin"</span>
FapData
PlayerSize <span class="hljs-built_in">equ</span> FapData - FapPlay
    
   <span class="hljs-comment">;  incbin   "files/vertexzeta.fap"</span>
      <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/intro.fap"</span>
   
<span class="hljs-comment">;     org	FapInit</span>
 
FapInit     <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/fap-init.bin"</span>

   <span class="hljs-built_in">assert</span> $<=FapBuff
<span class="hljs-comment">;   </span>
 <span class="hljs-comment">;    print "FapInit ", {hex}FapInit</span>
 <span class="hljs-comment">;    print "FapPlay ", {hex}FapPlay</span>
 <span class="hljs-comment">;    print "FapData ", {hex}FapData</span>
 <span class="hljs-comment">;    print "After FapData ", {hex}$</span></code></pre>
                            
                        </details>
                    </div>
                
                    <div class="item" data-source-file="rain.asm">
                        <h4 id="source_rain_asm" class="anchor-offset">Full Source</h4>
                        <details class="source-details">
                            <summary>Show Source</summary>
                            
                                <pre><code class="hljs language-basm">             <span class="hljs-built_in">align</span> <span class="hljs-number">256</span>
RAINX             
             <span class="hljs-built_in">incbin</span> <span class="hljs-string">"files/RAIN.DAT"</span>
STORE_POS_RAIN <span class="hljs-built_in">defs</span> <span class="hljs-number">160</span>,<span class="hljs-number">0</span>             
RAIN_CODE    
    <span class="hljs-comment">;         ld sp,TABLINE_80</span>
<span class="hljs-comment">;</span>
      <span class="hljs-keyword">ld</span> (SAUVE_SP_RAIN+<span class="hljs-number">1</span>),<span class="hljs-variable">sp</span>

       <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7fc4</span>
       <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>
<span class="hljs-comment">;</span>


 <span class="hljs-comment">; breakpoint</span>
POS_RAINX    <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RAINX+<span class="hljs-number">79</span>
             <span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
<span class="hljs-comment">;             </span>
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">l</span>
             <span class="hljs-keyword">cp</span> <span class="hljs-number">80</span>
             <span class="hljs-keyword">jr</span> nz,NO_LOOP_POSRAINX  
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RAINX
NO_LOOP_POSRAINX <span class="hljs-keyword">ld</span> (POS_RAINX+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>               

<span class="hljs-comment">;  read the pixel X position to read </span>
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>) 
<span class="hljs-comment">; </span>
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,STORE_POS_RAIN/<span class="hljs-number">256</span> 
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-variable">a</span>
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">c</span>,<span class="hljs-variable">a</span>
<span class="hljs-comment">; read the relative Y position </span>
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">e</span>,(<span class="hljs-variable">hl</span>)   
             <span class="hljs-keyword">ld</span> <span class="hljs-variable">d</span>,<span class="hljs-number">0</span>
<span class="hljs-comment">;</span>
NB_ITERATION_RAIN 
<span class="hljs-comment">;               inc h</span>
               <span class="hljs-keyword">exx</span>
VARIO_TABLE_RANDOM   <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,RAINX+<span class="hljs-number">&100</span>              
               <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
     <span class="hljs-comment">;          and %0001111 </span>
  <span class="hljs-comment">;    inc a</span>
               <span class="hljs-keyword">inc</span> <span class="hljs-variable">l</span>
               <span class="hljs-keyword">ld</span> (VARIO_TABLE_RANDOM+<span class="hljs-number">1</span>),<span class="hljs-variable">hl</span>
               <span class="hljs-keyword">exx</span>
               <span class="hljs-keyword">ld</span> <span class="hljs-variable">b</span>,<span class="hljs-variable">a</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">;              dec h</span>
              <span class="hljs-keyword">add</span> <span class="hljs-variable">a</span>,<span class="hljs-variable">e</span>
              <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>                                                     
<span class="hljs-comment">;</span>
            <span class="hljs-keyword">ld</span> <span class="hljs-variable">hl</span>,TABLINE_80
            <span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span>
            <span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span>
<span class="hljs-comment">;            </span>
           <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-variable">hl</span> 


       <span class="hljs-comment">;        ld a,c</span>
LOOP_DISPLAY_RAIN
          <span class="hljs-keyword">pop</span> <span class="hljs-variable">de</span>  
<span class="hljs-comment">;</span>
         <span class="hljs-keyword">res</span> <span class="hljs-number">7</span>,<span class="hljs-variable">d</span>
         <span class="hljs-keyword">ld</span> <span class="hljs-variable">l</span>,<span class="hljs-variable">c</span>
         <span class="hljs-keyword">ld</span> <span class="hljs-variable">h</span>,<span class="hljs-number">0</span>
         <span class="hljs-keyword">add</span> <span class="hljs-variable">hl</span>,<span class="hljs-variable">de</span>
 <span class="hljs-comment">;        </span>
        <span class="hljs-keyword">ld</span> <span class="hljs-variable">a</span>,(<span class="hljs-variable">hl</span>)
        <span class="hljs-keyword">set</span> <span class="hljs-number">7</span>,<span class="hljs-variable">h</span>
        <span class="hljs-keyword">ld</span> (<span class="hljs-variable">hl</span>),<span class="hljs-variable">a</span>

        <span class="hljs-keyword">djnz</span> LOOP_DISPLAY_RAIN

 <span class="hljs-comment">; breakpoint</span>


  <span class="hljs-keyword">ld</span> <span class="hljs-variable">bc</span>,<span class="hljs-number">&7fc0</span>
  <span class="hljs-keyword">out</span> (<span class="hljs-variable">c</span>),<span class="hljs-variable">c</span>

SAUVE_SP_RAIN <span class="hljs-keyword">ld</span> <span class="hljs-variable">sp</span>,<span class="hljs-number">0000</span>
     <span class="hljs-keyword">ret</span>

<span class="hljs-comment">; DE = address to display</span>

             <span class="hljs-keyword">bit</span> <span class="hljs-number">0</span>,<span class="hljs-variable">a</span>
<span class="hljs-comment">;              </span>
             <span class="hljs-keyword">jr</span> z,PAIR 
IMPAIR





PAIR</code></pre>
                            
                        </details>
                    </div>
                
            </section>

            <!-- Labels section -->
            

            <!-- Macros section -->
            

            <!-- Functions section -->
            

            <!-- Equs section -->
            
        </main>
    </div>
    <script>// Build file tree from flat file list
function buildFileTree(files) {
    const root = {};
    
    files.forEach(file => {
        const parts = file.split('/');
        let current = root;
        
        parts.forEach((part, index) => {
            if (!current[part]) {
                current[part] = {
                    name: part,
                    fullPath: parts.slice(0, index + 1).join('/'),
                    isFile: index === parts.length - 1,
                    realFile: index === parts.length - 1 ? file : null,  // Store original file path for leaf nodes
                    children: {}
                };
            }
            current = current[part].children;
        });
    });
    
    return root;
}

// Render file tree HTML
function renderFileTree(node, isRoot = false) {
    let html = '';
    const entries = Object.values(node);
    
    if (entries.length === 0) return html;
    
    if (!isRoot) html += '<ul class="file-tree-list">';
    else html = '<ul class="file-tree-list">';
    
    entries.sort((a, b) => {
        // Folders first, then files
        if (a.isFile !== b.isFile) return a.isFile ? 1 : -1;
        return a.name.localeCompare(b.name);
    }).forEach(entry => {
        if (entry.isFile) {
            html += `<li class="file-tree-item file-tree-file">
                <a href="#" class="file-filter-link" data-file="${entry.realFile || entry.fullPath}">
                    üìÑ ${entry.name}
                </a>
            </li>`;
        } else {
            const hasChildren = Object.keys(entry.children).length > 0;
            html += `<li class="file-tree-item file-tree-folder">
                <details open>
                    <summary class="file-tree-folder-name">üìÅ ${entry.name}</summary>
                    ${renderFileTree(entry.children, false)}
                </details>
            </li>`;
        }
    });
    
    html += '</ul>';
    return html;
}

// Toggle source code visibility
function toggleSource(id) {
    const content = document.getElementById(id);
    const button = event.target;
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        button.classList.remove('active');
    } else {
        content.classList.add('show');
        button.classList.add('active');
        // Mark code as ready - syntax highlighting is done server-side in Rust
        const codeBlock = content.querySelector('code');
        if (codeBlock && !codeBlock.dataset.highlighted) {
            codeBlock.dataset.highlighted = 'true';
        }
    }
}

// File filtering functionality
function filterByFile(fileName) {
    console.debug('[doc] filterByFile called with', fileName);
    const items = document.querySelectorAll('.item');
    const sections = document.querySelectorAll('.section');
    const fileLinks = document.querySelectorAll('.file-filter-link');
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    const sidebarSections = document.querySelectorAll('.sidebar-section');
    const indexItems = document.querySelectorAll('.index-item');
    const indexLetters = document.querySelectorAll('.index-letter');
    const allFilesLink = document.getElementById('all-files-link');
    
    // Update active link
    fileLinks.forEach(link => {
        if (link.dataset.file === fileName) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
    
    // Update "All Files" link active state
    if (allFilesLink) {
        if (fileName === '') {
            allFilesLink.classList.add('active');
        } else {
            allFilesLink.classList.remove('active');
        }
    }
    
    // Scroll to file documentation if filtering by specific file
    if (fileName !== '') {
        const fileAnchorId = 'file_' + fileName.replace(/[\/\\.]/g, '_');
        const fileAnchor = document.getElementById(fileAnchorId);
        if (fileAnchor) {
            setTimeout(() => {
                fileAnchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
    }
    
    // Filter symbol index items
    indexItems.forEach(item => {
        const itemFile = item.dataset.sourceFile;
        // debug: show item mapping
        // console.debug('[doc] index-item', itemFile);
        
        if (fileName === '' || itemFile === fileName) {
            item.classList.remove('filtered');
        } else {
            item.classList.add('filtered');
        }
    });
    
    // Hide/show index letter headers based on visible items
    indexLetters.forEach(letterHeader => {
        const letterDiv = letterHeader.nextElementSibling; // The index-items div
        if (letterDiv && letterDiv.classList.contains('index-items')) {
            const visibleItems = letterDiv.querySelectorAll('.index-item:not(.filtered)');
            const letterId = letterHeader.id; // e.g., "index-A"
            const letter = letterId.replace('index-', '');
            const jumpLink = document.querySelector(`.jump-link[data-letter="${letter}"]`);
            
            if (visibleItems.length === 0) {
                letterHeader.classList.add('hidden');
                letterDiv.classList.add('hidden');
                if (jumpLink) jumpLink.classList.add('hidden');
            } else {
                letterHeader.classList.remove('hidden');
                letterDiv.classList.remove('hidden');
                if (jumpLink) jumpLink.classList.remove('hidden');
            }
        }
    });
    
    // Hide/show entire symbol index section if no items are visible
    const allVisibleIndexItems = document.querySelectorAll('.index-item:not(.filtered):not(.hidden)');
    const symbolIndexSection = document.getElementById('symbol-index-section');
    const symbolIndexSidebar = document.getElementById('sidebar-symbol-index');
    
    if (allVisibleIndexItems.length === 0) {
        if (symbolIndexSection) symbolIndexSection.style.display = 'none';
        if (symbolIndexSidebar) symbolIndexSidebar.style.display = 'none';
    } else {
        if (symbolIndexSection) symbolIndexSection.style.display = 'block';
        if (symbolIndexSidebar) symbolIndexSidebar.style.display = 'block';
    }
    
    // Filter sidebar items and hide empty sections
    sidebarSections.forEach(sidebarSection => {
        // Skip symbol index sidebar - it's handled above
        // Skip files sidebar - it should always be visible for navigation
        if (sidebarSection.id === 'sidebar-symbol-index' || sidebarSection.id === 'sidebar-files') {
            return;
        }
        
        let visibleSidebarCount = 0;
        const sidebarSectionItems = sidebarSection.querySelectorAll('.sidebar-item');
        
        sidebarSectionItems.forEach(item => {
            const itemFile = item.dataset.sourceFile;
            
            if (fileName === '' || itemFile === fileName) {
                item.classList.remove('filtered');
                visibleSidebarCount++;
            } else {
                item.classList.add('filtered');
            }
        });
        
        // Hide sidebar section if no visible items
        if (visibleSidebarCount === 0) {
            sidebarSection.style.display = 'none';
        } else {
            sidebarSection.style.display = 'block';
        }
    });
    
    // Filter main content items
    sections.forEach(section => {
        // Skip symbol index section - it's handled above
        if (section.id === 'symbol-index-section') {
            return;
        }
        
        let visibleCount = 0;
        const sectionItems = section.querySelectorAll('.item');
        
        sectionItems.forEach(item => {
            const itemFile = item.dataset.sourceFile;
            // debug: show main item file mapping
            // console.debug('[doc] main-item', itemFile);
            
            if (fileName === '' || itemFile === fileName) {
                item.classList.remove('filtered');
                visibleCount++;
            } else {
                item.classList.add('filtered');
            }
        });
        
        // Show/hide section based on whether it has visible items
        if (visibleCount === 0) {
            section.style.display = 'none';
        } else {
            section.style.display = 'block';
        }
    });

    // Fallback: if no main items matched this file, try finding items by ref-location
    const visibleMainItems = document.querySelectorAll('.item:not(.filtered)');
    if (fileName !== '' && visibleMainItems.length === 0) {
        const refSpans = document.querySelectorAll('.ref-location');
        const baseName = fileName.split('/').pop();
        for (const span of refSpans) {
            const txt = (span.textContent || '').trim();
            // Match patterns like "IntroHBL/src/intro_code.asm:419" or just basename
            if (txt.startsWith(fileName + ':') || (baseName && txt.startsWith(baseName + ':')) || txt.includes('/' + fileName + ':')) {
                const target = span.closest('.item') || span.closest('.index-item') || span.closest('.section');
                if (target) {
                    target.classList.remove('filtered');
                    // ensure the section is visible
                    const parentSection = target.closest('.section');
                    if (parentSection) parentSection.style.display = 'block';
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    break;
                }
            }
        }
    }
}

// Copy-to-clipboard functionality
function copyToClipboard(text, button) {
    navigator.clipboard.writeText(text).then(function() {
        const originalText = button.textContent;
        button.textContent = '‚úì Copied!';
        button.classList.add('success');
        
        setTimeout(function() {
            button.textContent = originalText;
            button.classList.remove('success');
        }, 2000);
    }).catch(function(err) {
        console.error('Failed to copy:', err);
        button.textContent = '‚úó Failed';
        setTimeout(function() {
            button.textContent = 'üìã Copy';
        }, 2000);
    });
}

// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchBox = document.getElementById('searchBox');
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const items = document.querySelectorAll('.item');
    const sections = document.querySelectorAll('.section');
    
    // Build file tree if files are present
    const fileTreeRoot = document.getElementById('file-tree-root');
    if (fileTreeRoot) {
        // Get all file-filter-link elements to extract file list
        const allFileLinks = document.querySelectorAll('#file-filter-list .file-filter-link[data-file]');
        const files = Array.from(allFileLinks)
            .map(link => link.dataset.file)
            .filter(file => file !== ''); // Exclude empty strings
        
        if (files.length > 0) {
            const tree = buildFileTree(files);
            fileTreeRoot.innerHTML = renderFileTree(tree, true);
            
            // Attach click handlers to all file links in the tree
            fileTreeRoot.querySelectorAll('.file-filter-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    filterByFile(this.dataset.file);
                });
            });
        }
    }
    
    // Attach click handler to "All Files" link
    const allFilesLink = document.getElementById('all-files-link');
    if (allFilesLink) {
        allFilesLink.addEventListener('click', function(e) {
            e.preventDefault();
            filterByFile('');
        });
    }
    
    // Function to clear search
    function clearSearch() {
        searchBox.value = '';
        performSearch();
        searchBox.focus();
    }
    
    // Update clear button visibility based on search input
    function updateClearButtonVisibility() {
        if (searchBox.value.trim() !== '') {
            clearSearchBtn.classList.add('visible');
        } else {
            clearSearchBtn.classList.remove('visible');
        }
    }
    
    // Function to perform search filtering
    function performSearch() {
        updateClearButtonVisibility();
        const searchTerm = searchBox.value.toLowerCase().trim();
        const indexItems = document.querySelectorAll('.index-item');
        const indexLetters = document.querySelectorAll('.index-letter');
        
        // Filter symbol index items by search term
        indexItems.forEach(item => {
            const codeElement = item.querySelector('code');
            if (!codeElement) return;
            
            const symbolName = codeElement.textContent.toLowerCase();
            
            if (searchTerm === '' || symbolName.includes(searchTerm)) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });
        
        // Hide/show index letter headers based on visible items
        indexLetters.forEach(letterHeader => {
            const letterDiv = letterHeader.nextElementSibling; // The index-items div
            if (letterDiv && letterDiv.classList.contains('index-items')) {
                const visibleItems = letterDiv.querySelectorAll('.index-item:not(.filtered):not(.hidden)');
                const letterId = letterHeader.id; // e.g., "index-A"
                const letter = letterId.replace('index-', '');
                const jumpLink = document.querySelector(`.jump-link[data-letter="${letter}"]`);
                
                if (visibleItems.length === 0) {
                    letterHeader.classList.add('hidden');
                    letterDiv.classList.add('hidden');
                    if (jumpLink) jumpLink.classList.add('hidden');
                } else {
                    letterHeader.classList.remove('hidden');
                    letterDiv.classList.remove('hidden');
                    if (jumpLink) jumpLink.classList.remove('hidden');
                }
            }
        });
        
        // Hide/show entire symbol index section if no items are visible
        const allVisibleIndexItems = document.querySelectorAll('.index-item:not(.filtered):not(.hidden)');
        const symbolIndexSection = document.getElementById('symbol-index-section');
        const symbolIndexSidebar = document.getElementById('sidebar-symbol-index');
        
        if (allVisibleIndexItems.length === 0) {
            if (symbolIndexSection) symbolIndexSection.style.display = 'none';
            if (symbolIndexSidebar) symbolIndexSidebar.style.display = 'none';
        } else {
            if (symbolIndexSection) symbolIndexSection.style.display = 'block';
            if (symbolIndexSidebar) symbolIndexSidebar.style.display = 'block';
        }
        
        sections.forEach(section => {
            // Skip symbol index section - it's handled above
            if (section.id === 'symbol-index-section') {
                return;
            }
            
            let visibleCount = 0;
            const sectionItems = section.querySelectorAll('.item');
            
            sectionItems.forEach(item => {
                // Skip if already filtered by file
                if (item.classList.contains('filtered')) {
                    return;
                }
                
                const title = item.querySelector('h4').textContent.toLowerCase();
                const content = item.textContent.toLowerCase();
                
                if (searchTerm === '' || title.includes(searchTerm) || content.includes(searchTerm)) {
                    item.classList.remove('hidden');
                    visibleCount++;
                } else {
                    item.classList.add('hidden');
                }
            });
            
            // Show/hide section based on whether it has visible items
            if (visibleCount === 0 && searchTerm !== '') {
                section.style.display = 'none';
            } else {
                section.style.display = 'block';
            }
        });
        
        // Check if any items are visible
        const visibleItems = document.querySelectorAll('.item:not(.hidden):not(.filtered)');
        const noResultsMsg = document.querySelector('.no-results');
        
        if (visibleItems.length === 0 && searchTerm !== '') {
            if (!noResultsMsg) {
                const msg = document.createElement('div');
                msg.className = 'no-results visible';
                msg.textContent = 'No results found for "' + searchTerm + '"';
                document.querySelector('.main-content').appendChild(msg);
            } else {
                noResultsMsg.textContent = 'No results found for "' + searchTerm + '"';
                noResultsMsg.classList.add('visible');
            }
        } else if (noResultsMsg) {
            noResultsMsg.classList.remove('visible');
        }
    }
    
    // Apply search on input
    searchBox.addEventListener('input', performSearch);
    
    // Clear search button click handler
    clearSearchBtn.addEventListener('click', clearSearch);
    
    // Apply search on page load if browser restored value
    if (searchBox.value.trim() !== '') {
        performSearch();
    }
    
    // Clear search when clicking sidebar links
    document.querySelectorAll('.sidebar-item a').forEach(function(link) {
        link.addEventListener('click', function() {
            clearSearch();
        });
    });
    
    // Note: Syntax highlighting is done server-side in Rust during HTML generation.
    // Code blocks are already highlighted with <span class="hljs-*"> tags.
    // We only need to mark them to track their state.
    document.querySelectorAll('pre code').forEach(function(codeBlock) {
        if (!codeBlock.dataset.highlighted) {
            codeBlock.dataset.highlighted = 'true';
        }
    });
    
    // Add copy buttons to all code blocks
    document.querySelectorAll('pre code').forEach(function(codeBlock) {
        const pre = codeBlock.parentElement;
        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.textContent = 'üìã Copy';
        button.onclick = function() {
            copyToClipboard(codeBlock.textContent, button);
        };
        pre.appendChild(button);
    });

});
</script>
    <script>
        // Normalize file names when filtering: some items use absolute paths
        // while file-filter links use workspace-relative paths. Wrap the
        // generated `filterByFile` to resolve a matching source-file when
        // necessary.
        (function() {
            if (typeof window.filterByFile !== 'function') return;
            const originalFilter = window.filterByFile;

            function resolveFileNameForFiltering(fileName) {
                if (!fileName) return '';
                console.debug('[doc] resolveFileNameForFiltering input', fileName);
                const items = document.querySelectorAll('.item[data-source-file]');
                const candidates = [];
                for (const it of items) {
                    const sf = it.dataset.sourceFile;
                    if (!sf) continue;
                    candidates.push(sf);
                    if (sf === fileName) {
                        console.debug('[doc] exact match', sf);
                        return sf;
                    }
                    if (sf.endsWith('/' + fileName)) {
                        console.debug('[doc] suffix match with /', sf);
                        return sf;
                    }
                    if (sf.endsWith(fileName)) {
                        console.debug('[doc] suffix match', sf);
                        return sf;
                    }
                }
                // Try looser matching by basename and by normalizing separators/case
                try {
                    const inputBasename = fileName.split('/').pop();
                    const normalizedInput = inputBasename.toLowerCase().replace(/[-\s]/g, '_');
                    for (const sf of candidates) {
                        const candBase = sf.split('/').pop();
                        if (!candBase) continue;
                        if (candBase === inputBasename) {
                            console.debug('[doc] basename exact match', sf);
                            return sf;
                        }
                        const normalizedCand = candBase.toLowerCase().replace(/[-\s]/g, '_');
                        if (normalizedCand === normalizedInput) {
                            console.debug('[doc] basename normalized match', sf);
                            return sf;
                        }
                        // also try removing extension variants (e.g., .asm vs .s)
                        const candNoExt = candBase.replace(/\.[^.]+$/, '');
                        const inputNoExt = inputBasename.replace(/\.[^.]+$/, '');
                        if (candNoExt === inputNoExt) {
                            console.debug('[doc] no-ext match', sf);
                            return sf;
                        }
                    }
                } catch (e) {
                    console.debug('[doc] resolver error', e);
                }
                console.debug('[doc] resolveFileNameForFiltering candidates', candidates.slice(0,20));
                return fileName;
            }

            window.filterByFile = function(fileName) {
                const resolved = resolveFileNameForFiltering(fileName);
                return originalFilter(resolved);
            };
        })();
    </script>
</body>
</html>